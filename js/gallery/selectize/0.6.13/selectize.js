define("gallery/selectize/0.6.13/selectize",["$"],function(a,b){!function(c){"object"==typeof b?c(a("$")):"function"==typeof define&&define.amd?define(["jquery"],c):c(jQuery)}(function(a){"use strict";var b=function(a,b){if("string"!=typeof b||b.length){var c="string"==typeof b?new RegExp(b,"i"):b,d=function(a){var b=0;if(3===a.nodeType){var e=a.data.search(c);if(e>=0&&a.data.length>0){var f=a.data.match(c),g=document.createElement("span");g.className="highlight";var h=a.splitText(e);h.splitText(f[0].length);var i=h.cloneNode(!0);g.appendChild(i),h.parentNode.replaceChild(g,h),b=1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(var j=0;j<a.childNodes.length;++j)j+=d(a.childNodes[j]);return b};return a.each(function(){d(this)})}},c=function(){};c.prototype={on:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},off:function(a,b){this._events=this._events||{},a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){if(this._events=this._events||{},a in this._events!=!1)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},c.mixin=function(a){for(var b=["on","off","trigger"],d=0;d<b.length;d++)a.prototype[b[d]]=c.prototype[b[d]]};var d=/Mac/.test(navigator.userAgent),e=65,f=13,g=27,h=37,i=38,j=39,k=40,l=8,m=46,n=16,o=d?91:17,p=d?18:17,q=9,r=1,s=2,t={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇç]",e:"[eÈÉÊËèéêë]",i:"[iÌÍÎÏìíîï]",n:"[nÑñ]",o:"[oÒÓÔÕÕÖØòóôõöø]",s:"[sŠš]",u:"[uÙÚÛÜùúûü]",y:"[yŸÿý]",z:"[zŽž]"},u={};u.mixin=function(b,c){b.plugins={},b.prototype.loadPlugins=function(b){var c,d,e;if(this.plugins=[],this.pluginSettings={},a.isArray(b))for(c=0,d=b.length;d>c;c++)this.loadPlugin(b[c]);else if(b){this.pluginSettings=a.extend({},b);for(e in b)b.hasOwnProperty(e)&&this.loadPlugin(e)}},b.prototype.loadPlugin=function(a){var d,e,f;if(-1===this.plugins.indexOf(a)){if(!b.plugins.hasOwnProperty(a))throw new Error(c+' unable to find "'+a+'" plugin');for(d=b.plugins[a],this.plugins.push(a),e=0,f=d.dependencies.length;f>e;e++)this.loadPlugin(d.dependencies[e]);d.fn.apply(this,[this.pluginSettings[a]||{}])}},b.registerPlugin=function(a){var c=arguments;b.plugins[a]={name:a,fn:c[c.length-1],dependencies:3===c.length?c[1]:[]}}};var v=function(a){return"undefined"!=typeof a},w=function(a){return"undefined"==typeof a||null===a?"":"boolean"==typeof a?a?"1":"0":a+""},x=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},y=function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},z=function(a){return a.replace(/(['"])/g,"\\$1")},A={};A.before=function(a,b,c){var d=a[b];a[b]=function(){return c.apply(a,arguments),d.apply(a,arguments)}},A.after=function(a,b,c){var d=a[b];a[b]=function(){var b=d.apply(a,arguments);return c.apply(a,arguments),b}};var B=function(b,c){if(!a.isArray(c))return c;var d,e,f={};for(d=0,e=c.length;e>d;d++)c[d].hasOwnProperty(b)&&(f[c[d][b]]=c[d]);return f},C=function(a){var b=!1;return function(){b||(b=!0,a.apply(this,arguments))}},D=function(a,b){var c;return function(){var d=this,e=arguments;window.clearTimeout(c),c=window.setTimeout(function(){a.apply(d,e)},b)}},E=function(a,b,c){var d,e=a.trigger,f={};a.trigger=function(){var c=arguments[0];return-1===b.indexOf(c)?e.apply(a,arguments):(f[c]=arguments,void 0)},c.apply(a,[]),a.trigger=e;for(d in f)f.hasOwnProperty(d)&&e.apply(a,f[d])},F=function(a,b,c,d){a.on(b,c,function(b){for(var c=b.target;c&&c.parentNode!==a[0];)c=c.parentNode;return b.currentTarget=c,d.apply(this,[b])})},G=function(a){var b={};if("selectionStart"in a)b.start=a.selectionStart,b.length=a.selectionEnd-b.start;else if(document.selection){a.focus();var c=document.selection.createRange(),d=document.selection.createRange().text.length;c.moveStart("character",-a.value.length),b.start=c.text.length-d,b.length=d}return b},H=function(a,b,c){var d,e,f={};if(c)for(d=0,e=c.length;e>d;d++)f[c[d]]=a.css(c[d]);else f=a.css();b.css(f)},I=function(b,c){var d=a("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"nowrap"}).text(b).appendTo("body");H(c,d,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var e=d.width();return d.remove(),e},J=function(a){var b=function(b){var c,d,e,f,g,h,i,j;b=b||window.event||{},b.metaKey||b.altKey||a.data("grow")!==!1&&(c=a.val(),b.type&&"keydown"===b.type.toLowerCase()&&(d=b.keyCode,e=d>=97&&122>=d||d>=65&&90>=d||d>=48&&57>=d||32==d,d===m||d===l?(j=G(a[0]),j.length?c=c.substring(0,j.start)+c.substring(j.start+j.length):d===l&&j.start?c=c.substring(0,j.start-1)+c.substring(j.start+1):d===m&&"undefined"!=typeof j.start&&(c=c.substring(0,j.start)+c.substring(j.start+1))):e&&(h=b.shiftKey,i=String.fromCharCode(b.keyCode),i=h?i.toUpperCase():i.toLowerCase(),c+=i)),f=a.attr("placeholder")||"",!c.length&&f.length&&(c=f),g=I(c,a)+4,g!==a.width()&&(a.width(g),a.triggerHandler("resize")))};a.on("keydown keyup update blur",b),b()},K=function(b,c){var d=this;b[0].selectize=d,a.extend(d,{settings:c,$input:b,tagType:"select"===b[0].tagName.toLowerCase()?r:s,highlightedValue:null,isOpen:!1,isDisabled:!1,isLocked:!1,isFocused:!1,isInputFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:D(d.onSearchChange,c.loadThrottle)}),a.extend(d.options,B(c.valueField,c.options)),delete d.settings.options,a.extend(d.optgroups,B(c.optgroupValueField,c.optgroups)),delete d.settings.optgroups,d.settings.mode=d.settings.mode||(1===d.settings.maxItems?"single":"multi"),"boolean"!=typeof d.settings.hideSelected&&(d.settings.hideSelected="multi"===d.settings.mode),d.loadPlugins(d.settings.plugins),d.setupCallbacks(),d.setup()};return c.mixin(K),u.mixin(K,"Selectize"),a.extend(K.prototype,{setup:function(){var b,c,e,f,g,h,i,j,k,l=this,m=l.settings;j=l.$input.attr("tabindex")||"",k=l.$input.attr("class")||"",b=a("<div>").addClass(m.theme).addClass(m.wrapperClass).addClass(k),c=a("<div>").addClass(m.inputClass).addClass("items").toggleClass("has-options",!a.isEmptyObject(l.options)).appendTo(b),e=a('<input type="text">').appendTo(c).attr("tabindex",j),h=a(m.dropdownParent||b),f=a("<div>").addClass(m.dropdownClass).hide().appendTo(h),g=a("<div>").addClass(m.dropdownContentClass).appendTo(f),b.css({width:l.$input[0].style.width,display:l.$input.css("display")}),l.plugins.length&&b.addClass("plugin-"+l.plugins.join(" plugin-")),i=l.settings.mode,b.toggleClass("single","single"===i),b.toggleClass("multi","multi"===i),(null===m.maxItems||m.maxItems>1)&&l.tagType===r&&l.$input.attr("multiple","multiple"),l.settings.placeholder&&e.attr("placeholder",m.placeholder),l.$wrapper=b,l.$control=c,l.$control_input=e,l.$dropdown=f,l.$dropdown_content=g,c.on("mousedown",function(a){a.isDefaultPrevented()||window.setTimeout(function(){l.focus(!0)},0)}),c.on("click",function(){l.isInputFocused||l.focus(!0)}),f.on("mouseenter","[data-selectable]",function(){return l.onOptionHover.apply(l,arguments)}),f.on("mousedown","[data-selectable]",function(){return l.onOptionSelect.apply(l,arguments)}),F(c,"mousedown","*:not(input)",function(){return l.onItemSelect.apply(l,arguments)}),J(e),e.on({mousedown:function(a){a.stopPropagation()},keydown:function(){return l.onKeyDown.apply(l,arguments)},keyup:function(){return l.onKeyUp.apply(l,arguments)},keypress:function(){return l.onKeyPress.apply(l,arguments)},resize:function(){l.positionDropdown.apply(l,[])},blur:function(){return l.onBlur.apply(l,arguments)},focus:function(){return l.onFocus.apply(l,arguments)}}),a(document).on({keydown:function(a){l.isCmdDown=a[d?"metaKey":"ctrlKey"],l.isCtrlDown=a[d?"altKey":"ctrlKey"],l.isShiftDown=a.shiftKey},keyup:function(a){a.keyCode===p&&(l.isCtrlDown=!1),a.keyCode===n&&(l.isShiftDown=!1),a.keyCode===o&&(l.isCmdDown=!1)},mousedown:function(a){if(l.isFocused){if(a.target===l.$dropdown[0]||a.target.parentNode===l.$dropdown[0]){var b=l.ignoreFocus;return l.ignoreFocus=!0,window.setTimeout(function(){l.ignoreFocus=b,l.focus(!1)},0),void 0}l.$control.has(a.target).length||a.target===l.$control[0]||l.blur()}}}),a(window).on({"scroll resize":function(){l.isOpen&&l.positionDropdown.apply(l,arguments)},mousemove:function(){l.ignoreHover=!1}}),l.$input.attr("tabindex",-1).hide().after(l.$wrapper),a.isArray(m.items)&&(l.setValue(m.items),delete m.items),l.updateOriginalInput(),l.refreshItems(),l.updatePlaceholder(),l.isSetup=!0,l.$input.is(":disabled")&&l.disable(),l.trigger("initialize"),m.preload&&l.onSearchChange("")},setupCallbacks:function(){var a,b,c={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(a in c)c.hasOwnProperty(a)&&(b=this.settings[c[a]],b&&this.on(a,b))},triggerCallback:function(a){var b;"function"==typeof this.settings[a]&&(b=Array.prototype.slice.apply(arguments,[1]),this.settings[a].apply(this,b))},onKeyPress:function(a){if(this.isLocked)return a&&a.preventDefault();var b=String.fromCharCode(a.keyCode||a.which);return this.settings.create&&b===this.settings.delimiter?(this.createItem(),a.preventDefault(),!1):void 0},onKeyDown:function(b){b.target===this.$control_input[0];var c=this;if(c.isLocked)return b.keyCode!==q&&b.preventDefault(),void 0;switch(b.keyCode){case e:if(c.isCmdDown)return c.selectAll(),void 0;break;case g:return c.blur(),void 0;case k:if(!c.isOpen&&c.hasOptions)c.open();else if(c.$activeOption){c.ignoreHover=!0;var d=c.getAdjacentOption(c.$activeOption,1);d.length&&c.setActiveOption(d,!0,!0)}return b.preventDefault(),void 0;case i:if(c.$activeOption){c.ignoreHover=!0;var n=c.getAdjacentOption(c.$activeOption,-1);n.length&&c.setActiveOption(n,!0,!0)}return b.preventDefault(),void 0;case f:return c.$activeOption&&c.onOptionSelect({currentTarget:c.$activeOption}),b.preventDefault(),void 0;case h:return c.advanceSelection(-1,b),void 0;case j:return c.advanceSelection(1,b),void 0;case q:return c.settings.create&&a.trim(c.$control_input.val()).length&&(c.createItem(),b.preventDefault()),void 0;case l:case m:return c.deleteSelection(b),void 0}return c.isFull()||c.isInputHidden?(b.preventDefault(),void 0):void 0},onKeyUp:function(a){var b=this;if(b.isLocked)return a&&a.preventDefault();var c=b.$control_input.val()||"";b.lastValue!==c&&(b.lastValue=c,b.onSearchChange(c),b.refreshOptions(),b.trigger("type",c))},onSearchChange:function(a){var b=this,c=b.settings.load;c&&(b.loadedSearches.hasOwnProperty(a)||(b.loadedSearches[a]=!0,b.load(function(d){c.apply(b,[a,d])})))},onFocus:function(a){var b=this;return b.isInputFocused=!0,b.isFocused=!0,b.isDisabled?(b.blur(),a.preventDefault(),!1):(b.ignoreFocus||("focus"===b.settings.preload&&b.onSearchChange(""),b.showInput(),b.setActiveItem(null),b.refreshOptions(!!b.settings.openOnFocus),b.refreshClasses()),void 0)},onBlur:function(){var a=this;a.isInputFocused=!1,a.ignoreFocus||(a.close(),a.setTextboxValue(""),a.setActiveItem(null),a.setActiveOption(null),a.setCaret(a.items.length),a.isFocused=!1,a.refreshClasses())},onOptionHover:function(a){this.ignoreHover||this.setActiveOption(a.currentTarget,!1)},onOptionSelect:function(b){var c,d,e=this;b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),e.focus(!1),d=a(b.currentTarget),d.hasClass("create")?e.createItem():(c=d.attr("data-value"),c&&(e.setTextboxValue(""),e.addItem(c),!e.settings.hideSelected&&b.type&&/mouse/.test(b.type)&&e.setActiveOption(e.getOption(c))))},onItemSelect:function(a){var b=this;"multi"===b.settings.mode&&(a.preventDefault(),b.setActiveItem(a.currentTarget,a),b.focus(!1),b.hideInput())},load:function(a){var b=this,c=b.$wrapper.addClass("loading");b.loading++,a.apply(b,[function(a){b.loading=Math.max(b.loading-1,0),a&&a.length&&(b.addOption(a),b.refreshOptions(!1),b.isInputFocused&&b.open()),b.loading||c.removeClass("loading"),b.trigger("load",a)}])},setTextboxValue:function(a){this.$control_input.val(a).triggerHandler("update"),this.lastValue=a},getValue:function(){return this.tagType===r&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(b){E(this,["change"],function(){this.clear();for(var c=a.isArray(b)?b:[b],d=0,e=c.length;e>d;d++)this.addItem(c[d])})},setActiveItem:function(b,c){var d,e,f,g,h,i,j,k,l=this;if(b=a(b),!b.length)return a(l.$activeItems).removeClass("active"),l.$activeItems=[],l.isFocused=l.isInputFocused,void 0;if(d=c&&c.type.toLowerCase(),"mousedown"===d&&l.isShiftDown&&l.$activeItems.length){for(k=l.$control.children(".active:last"),g=Array.prototype.indexOf.apply(l.$control[0].childNodes,[k[0]]),h=Array.prototype.indexOf.apply(l.$control[0].childNodes,[b[0]]),g>h&&(j=g,g=h,h=j),e=g;h>=e;e++)i=l.$control[0].childNodes[e],-1===l.$activeItems.indexOf(i)&&(a(i).addClass("active"),l.$activeItems.push(i));c.preventDefault()}else"mousedown"===d&&l.isCtrlDown||"keydown"===d&&this.isShiftDown?b.hasClass("active")?(f=l.$activeItems.indexOf(b[0]),l.$activeItems.splice(f,1),b.removeClass("active")):l.$activeItems.push(b.addClass("active")[0]):(a(l.$activeItems).removeClass("active"),l.$activeItems=[b.addClass("active")[0]]);l.isFocused=!!l.$activeItems.length||l.isInputFocused},setActiveOption:function(b,c,d){var e,f,g,h,i,j=this;j.$activeOption&&j.$activeOption.removeClass("active"),j.$activeOption=null,b=a(b),b.length&&(j.$activeOption=b.addClass("active"),(c||!v(c))&&(e=j.$dropdown_content.height(),f=j.$activeOption.outerHeight(!0),c=j.$dropdown_content.scrollTop()||0,g=j.$activeOption.offset().top-j.$dropdown_content.offset().top+c,h=g,i=g-e+f,g+f>e-c?j.$dropdown_content.stop().animate({scrollTop:i},d?j.settings.scrollDuration:0):c>g&&j.$dropdown_content.stop().animate({scrollTop:h},d?j.settings.scrollDuration:0)))},selectAll:function(){this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.isFocused=!0,this.$activeItems.length&&this.hideInput()},hideInput:function(){var a=this;a.close(),a.setTextboxValue(""),a.$control_input.css({opacity:0,position:"absolute",left:-1e4}),a.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(a){var b=this;b.isDisabled||(b.ignoreFocus=!0,b.$control_input[0].focus(),b.isInputFocused=!0,window.setTimeout(function(){b.ignoreFocus=!1,a&&b.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},parseSearchTokens:function(b){if(b=a.trim(String(b||"").toLowerCase()),!b||!b.length)return[];var c,d,e,f,g=[],h=b.split(/ +/);for(c=0,d=h.length;d>c;c++){if(e=y(h[c]),this.settings.diacritics)for(f in t)t.hasOwnProperty(f)&&(e=e.replace(new RegExp(f,"g"),t[f]));g.push({string:h[c],regex:new RegExp(e,"i")})}return g},getScoreFunction:function(a){var b=this,c=a.tokens,d=function(){return c.length?1===c.length?function(a){var b,d;return a=String(a||"").toLowerCase(),d=a.search(c[0].regex),-1===d?0:(b=c[0].string.length/a.length,0===d&&(b+=.5),b)}:function(a){var b,d,e,f;for(a=String(a||"").toLowerCase(),b=0,e=0,f=c.length;f>e;e++){if(d=a.search(c[e].regex),-1===d)return 0;0===d&&(b+=.5),b+=c[e].string.length/a.length}return b/c.length}:function(){return 0}}(),e=function(){var a=b.settings.searchField;if("string"==typeof a&&(a=[a]),a&&a.length){if(1===a.length){var c=a[0];return function(a){return a.hasOwnProperty(c)?d(a[c]):0}}return function(b){for(var c=0,e=0,f=0,g=a.length;g>f;f++)b.hasOwnProperty(a[f])&&(e+=d(b[a[f]]),c++);return e/c}}return function(){return 0}}();return e},search:function(b,c){var d,e,f,g,h=this;if(c=c||{},b=a.trim(String(b||"").toLowerCase()),b!==h.lastQuery){if(h.lastQuery=b,f={query:b,tokens:h.parseSearchTokens(b),total:0,items:[]},h.settings.score){if(g=h.settings.score.apply(this,[f]),"function"!=typeof g)throw new Error('Selectize "score" setting must be a function that returns a function')}else g=h.getScoreFunction(f);if(b.length){for(d in h.options)h.options.hasOwnProperty(d)&&(e=g(h.options[d]),e>0&&f.items.push({score:e,value:d}));f.items.sort(function(a,b){return b.score-a.score})}else{for(d in h.options)h.options.hasOwnProperty(d)&&f.items.push({score:1,value:d});h.settings.sortField&&f.items.sort(function(){var a=h.settings.sortField,b="desc"===h.settings.sortDirection?-1:1;return function(c,d){return c=c&&String(h.options[c.value][a]||"").toLowerCase(),d=d&&String(h.options[d.value][a]||"").toLowerCase(),c>d?1*b:d>c?-1*b:0}}())}h.currentResults=f}else f=a.extend(!0,{},h.currentResults);return h.prepareResults(f,c)},prepareResults:function(a,b){if(this.settings.hideSelected)for(var c=a.items.length-1;c>=0;c--)-1!==this.items.indexOf(String(a.items[c].value))&&a.items.splice(c,1);return a.total=a.items.length,"number"==typeof b.limit&&(a.items=a.items.slice(0,b.limit)),a},refreshOptions:function(c){"undefined"==typeof c&&(c=!0);var d,e,f,g,h,i,j,k,l,m,n,o=this,p=o.$control_input.val(),q=o.search(p,{}),r=o.$dropdown_content;if(e=q.items.length,"number"==typeof o.settings.maxOptions&&(e=Math.min(e,o.settings.maxOptions)),f={},o.settings.optgroupOrder)for(g=o.settings.optgroupOrder,d=0;d<g.length;d++)f[g[d]]=[];else g=[];for(d=0;e>d;d++)h=o.options[q.items[d].value],i=h[o.settings.optgroupField]||"",o.optgroups.hasOwnProperty(i)||(i=""),f.hasOwnProperty(i)||(f[i]=[],g.push(i)),f[i].push(o.render("option",h));for(j=[],d=0,e=g.length;e>d;d++)i=g[d],o.optgroups.hasOwnProperty(i)&&f[i].length?(k=o.render("optgroup_header",o.optgroups[i])||"",k+=f[i].join(""),j.push(o.render("optgroup",a.extend({},o.optgroups[i],{html:k})))):j.push(f[i].join(""));if(r.html(j.join("")),o.settings.highlight&&q.query.length&&q.tokens.length)for(d=0,e=q.tokens.length;e>d;d++)b(r,q.tokens[d].regex);if(!o.settings.hideSelected)for(d=0,e=o.items.length;e>d;d++)o.getOption(o.items[d]).addClass("selected");l=o.settings.create&&q.query.length,l&&(r.prepend(o.render("option_create",{input:p})),n=a(r[0].childNodes[0])),o.hasOptions=q.items.length>0||l,o.hasOptions?(m=q.items.length>0?n?o.getAdjacentOption(n,1):r.find("[data-selectable]").first():n,o.setActiveOption(m),c&&!o.isOpen&&o.open()):(o.setActiveOption(null),c&&o.isOpen&&o.close())},addOption:function(b,c){var d,e,f=this;if(a.isArray(b))for(d=0,e=b.length;e>d;d++)f.addOption(b[d][f.settings.valueField],b[d]);else b=w(b),f.options.hasOwnProperty(b)||(f.userOptions[b]=!0,f.options[b]=c,f.lastQuery=null,f.trigger("option_add",b,c))},addOptionGroup:function(a,b){this.optgroups[a]=b,this.trigger("optgroup_add",value,b)},updateOption:function(b,c){var d,e,f,g,h,i,j=this;if(b=w(b),f=w(c[j.settings.valueField]),j.options.hasOwnProperty(b)){if(!f)throw new Error("Value must be set in option data");f!==b&&(delete j.options[b],g=j.items.indexOf(b),-1!==g&&j.items.splice(g,1,f)),j.options[f]=c,h=j.renderCache.item,i=j.renderCache.option,v(h)&&(delete h[b],delete h[f]),v(i)&&(delete i[b],delete i[f]),-1!==j.items.indexOf(f)&&(d=j.getItem(b),e=a(j.render("item",c)),d.hasClass("active")&&e.addClass("active"),d.replaceWith(e)),j.isOpen&&j.refreshOptions(!1)}},removeOption:function(a){var b=this;a=w(a),delete b.userOptions[a],delete b.options[a],b.lastQuery=null,b.trigger("option_remove",a),b.removeItem(a)},clearOptions:function(){var a=this;a.loadedSearches={},a.userOptions={},a.options={},a.lastQuery=null,a.trigger("option_clear"),a.clear()},getOption:function(b){return b=w(b),b?this.$dropdown_content.find("[data-selectable]").filter('[data-value="'+z(b)+'"]:first'):a()},getAdjacentOption:function(b,c){var d=this.$dropdown.find("[data-selectable]"),e=d.index(b)+c;return e>=0&&e<d.length?d.eq(e):a()},getItem:function(a){return this.$control.children('[data-value="'+z(w(a))+'"]')},addItem:function(b){E(this,["change"],function(){var c,d,e,f,g=this,h=g.settings.mode;b=w(b),"single"===h&&g.clear(),"multi"===h&&g.isFull()||-1===g.items.indexOf(b)&&g.options.hasOwnProperty(b)&&(c=a(g.render("item",g.options[b])),g.items.splice(g.caretPos,0,b),g.insertAtCaret(c),g.refreshClasses(),g.isSetup&&(e=g.$dropdown_content.find("[data-selectable]"),d=g.getOption(b),f=g.getAdjacentOption(d,1).attr("data-value"),g.refreshOptions(g.isFocused&&"single"!==h),f&&g.setActiveOption(g.getOption(f)),!e.length||null!==g.settings.maxItems&&g.items.length>=g.settings.maxItems?g.close():g.positionDropdown(),g.isFocused&&window.setTimeout(function(){"single"===h?(g.blur(),g.focus(!1),g.hideInput()):g.focus(!1)},0),g.updatePlaceholder(),g.trigger("item_add",b,c),g.updateOriginalInput()))})},removeItem:function(a){var b,c,d,e=this;b="object"==typeof a?a:e.getItem(a),a=w(b.attr("data-value")),c=e.items.indexOf(a),-1!==c&&(b.remove(),b.hasClass("active")&&(d=e.$activeItems.indexOf(b[0]),e.$activeItems.splice(d,1)),e.items.splice(c,1),e.lastQuery=null,!e.settings.persist&&e.userOptions.hasOwnProperty(a)&&e.removeOption(a),c<e.caretPos&&e.setCaret(e.caretPos-1),e.refreshClasses(),e.updatePlaceholder(),e.updateOriginalInput(),e.positionDropdown(),e.trigger("item_remove",a))},createItem:function(){var b=this,c=a.trim(b.$control_input.val()||""),d=b.caretPos;if(c.length){b.lock();var e="function"==typeof b.settings.create?this.settings.create:function(a){var c={};return c[b.settings.labelField]=a,c[b.settings.valueField]=a,c},f=C(function(a){if(b.unlock(),b.focus(!1),a&&"object"==typeof a){var c=w(a[b.settings.valueField]);c&&(b.setTextboxValue(""),b.addOption(c,a),b.setCaret(d),b.addItem(c),b.refreshOptions("single"!==b.settings.mode),b.focus(!1))}}),g=e.apply(this,[c,f]);"undefined"!=typeof g&&f(g)}},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var a=0;a<this.items.length;a++)this.addItem(this.items);this.refreshClasses(),this.updateOriginalInput()},refreshClasses:function(){var a=this,b=a.isFull(),c=a.isLocked;this.$control.toggleClass("focus",a.isFocused).toggleClass("disabled",a.isDisabled).toggleClass("locked",c).toggleClass("full",b).toggleClass("not-full",!b).toggleClass("dropdown-active",a.isOpen).toggleClass("has-items",a.items.length>0),this.$control_input.data("grow",!b&&!c)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var a,b,c,d=this;if("select"===d.$input[0].tagName.toLowerCase()){for(c=[],a=0,b=d.items.length;b>a;a++)c.push('<option value="'+x(d.items[a])+'" selected="selected"></option>');c.length||this.$input.attr("multiple")||c.push('<option value="" selected="selected"></option>'),d.$input.html(c.join(""))}else d.$input.val(d.getValue());d.$input.trigger("change"),d.isSetup&&d.trigger("change",d.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var a=this.$control_input;this.items.length?a.removeAttr("placeholder"):a.attr("placeholder",this.settings.placeholder),a.triggerHandler("update")}},open:function(){var a=this;a.isLocked||a.isOpen||"multi"===a.settings.mode&&a.isFull()||(a.focus(!0),a.isOpen=!0,a.refreshClasses(),a.$dropdown.css({visibility:"hidden",display:"block"}),a.positionDropdown(),a.$dropdown.css({visibility:"visible"}),a.trigger("dropdown_open",this.$dropdown))},close:function(){var a=this;a.isOpen&&(a.$dropdown.hide(),a.setActiveOption(null),a.isOpen=!1,a.refreshClasses(),a.trigger("dropdown_close",a.$dropdown))},positionDropdown:function(){var a=this.$control,b="body"===this.settings.dropdownParent?a.offset():a.position();b.top+=a.outerHeight(!0),this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})},clear:function(){var a=this;a.items.length&&(a.$control.children(":not(input)").remove(),a.items=[],a.setCaret(0),a.updatePlaceholder(),a.updateOriginalInput(),a.refreshClasses(),a.showInput(),a.trigger("clear"))},insertAtCaret:function(b){var c=Math.min(this.caretPos,this.items.length);0===c?this.$control.prepend(b):a(this.$control[0].childNodes[c]).before(b),this.setCaret(c+1)},deleteSelection:function(b){var c,d,e,f,g,h,i,j,k,m=this;if(e=b&&b.keyCode===l?-1:1,f=G(m.$control_input[0]),m.$activeOption&&!m.settings.hideSelected&&(i=m.getAdjacentOption(m.$activeOption,-1).attr("data-value")),g=[],m.$activeItems.length){for(k=m.$control.children(".active:"+(e>0?"last":"first")),h=m.$control.children(":not(input)").index(k),e>0&&h++,c=0,d=m.$activeItems.length;d>c;c++)g.push(a(m.$activeItems[c]).attr("data-value"));b&&(b.preventDefault(),b.stopPropagation())}else(m.isFocused||"single"===m.settings.mode)&&m.items.length&&(0>e&&0===f.start&&0===f.length?g.push(m.items[m.caretPos-1]):e>0&&f.start===m.$control_input.val().length&&g.push(m.items[m.caretPos]));if(!g.length||"function"==typeof m.settings.onDelete&&m.settings.onDelete(g)===!1)return!1;for("undefined"!=typeof h&&m.setCaret(h);g.length;)m.removeItem(g.pop());return m.showInput(),m.refreshOptions(!0),i&&(j=m.getOption(i),j.length&&m.setActiveOption(j)),!0},advanceSelection:function(a,b){var c,d,e,f,g,h,i=this;0!==a&&(c=a>0?"last":"first",d=G(i.$control_input[0]),i.isInputFocused&&!i.isInputHidden?(f=i.$control_input.val().length,g=0>a?0===d.start&&0===d.length:d.start===f,g&&!f&&i.advanceCaret(a,b)):(h=i.$control.children(".active:"+c),h.length&&(e=i.$control.children(":not(input)").index(h),i.setActiveItem(null),i.setCaret(a>0?e+1:e),i.showInput())))},advanceCaret:function(a,b){if(0!==a){var c=this,d=a>0?"next":"prev";if(c.isShiftDown){var e=c.$control_input[d]();e.length&&(c.hideInput(),c.setActiveItem(e),b&&b.preventDefault())}else c.setCaret(c.caretPos+a)}},setCaret:function(b){var c=this;b="single"===c.settings.mode?c.items.length:Math.max(0,Math.min(c.items.length,b));var d,e,f,g;for(f=c.$control.children(":not(input)"),d=0,e=f.length;e>d;d++)g=a(f[d]).detach(),b>d?c.$control_input.before(g):c.$control.append(g);c.caretPos=b},lock:function(){this.close(),this.isLocked=!0,this.refreshClasses()},unlock:function(){this.isLocked=!1,this.refreshClasses()},disable:function(){this.isDisabled=!0,this.lock()},enable:function(){this.isDisabled=!1,this.unlock()},render:function(a,b){var c,d,e,f="",g=!1,h=this,i=/^[\	 ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(("option"===a||"item"===a)&&(c=w(b[h.settings.valueField]),g=!!c),g&&(v(h.renderCache[a])||(h.renderCache[a]={}),h.renderCache[a].hasOwnProperty(c)))return h.renderCache[a][c];if(h.settings.render&&"function"==typeof h.settings.render[a])f=h.settings.render[a].apply(this,[b,x]);else switch(e=b[h.settings.labelField],a){case"optgroup":f='<div class="optgroup">'+b.html+"</div>";break;case"optgroup_header":e=b[h.settings.optgroupLabelField],f='<div class="optgroup-header">'+x(e)+"</div>";break;case"option":f='<div class="option">'+x(e)+"</div>";break;case"item":f='<div class="item">'+x(e)+"</div>";break;case"option_create":f='<div class="create">Add <strong>'+x(b.input)+"</strong>&hellip;</div>"}return("option"===a||"option_create"===a)&&(f=f.replace(i,"<$1 data-selectable")),"optgroup"===a&&(d=b[h.settings.optgroupValueField]||"",f=f.replace(i,'<$1 data-group="'+x(d)+'"')),("option"===a||"item"===a)&&(f=f.replace(i,'<$1 data-value="'+x(c||"")+'"')),g&&(h.renderCache[a][c]=f),f}}),K.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",sortField:null,sortDirection:"asc",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,searchField:["text"],mode:null,theme:"default",wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},a.fn.selectize=function(b){b=b||{};var c=a.fn.selectize.defaults,d=b.dataAttr||c.dataAttr,e=function(d,e){var f,g,h,i=a.trim(d.val()||"");if(i.length){for(h=i.split(b.delimiter||c.delimiter),f=0,g=h.length;g>f;f++)e.options[h[f]]={text:h[f],value:h[f]};e.items=h}},f=function(b,c){var e,f,g,h;c.maxItems=b.attr("multiple")?null:1;var i=function(a){var b=d&&a.attr(d);return"string"==typeof b&&b.length?JSON.parse(b):null},j=function(b,d){b=a(b);var e=b.attr("value")||"";e.length&&(c.options[e]=i(b)||{text:b.html(),value:e,optgroup:d},b.is(":selected")&&c.items.push(e))},k=function(b){var d,e,f=a("option",b);b=a(b);var g=b.attr("label");for(g&&g.length&&(c.optgroups[g]=i(b)||{label:g}),d=0,e=f.length;e>d;d++)j(f[d],g)};for(h=b.children(),e=0,f=h.length;f>e;e++)g=h[e].tagName.toLowerCase(),"optgroup"===g?k(h[e]):"option"===g&&j(h[e])};return this.each(function(){var d,g=a(this),h=g[0].tagName.toLowerCase(),i={placeholder:g.attr("placeholder"),options:{},optgroups:{},items:[]};"select"===h?f(g,i):e(g,i),d=new K(g,a.extend(!0,{},c,i,b)),g.data("selectize",d),g.addClass("selectized")})},a.fn.selectize.defaults=K.defaults,K.registerPlugin("drag_drop",function(){if(!a.fn.sortable)throw new Error('The "drag_drop" Selectize plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var b=this;this.setup=function(){var c=b.setup;return function(){c.apply(this,arguments);var d=this.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,start:function(a,b){b.placeholder.css("width",b.helper.css("width")),d.css({overflow:"visible"})},stop:function(){d.css({overflow:"hidden"});var c=this.$activeItems?this.$activeItems.slice():null,e=[];d.children("[data-value]").each(function(){e.push(a(this).attr("data-value"))}),b.setValue(e),b.setActiveItem(c)}})}}()}}),K.registerPlugin("dropdown_header",function(b){var c=this;b=a.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(a){return'<div class="'+a.headerClass+'">'+'<div class="'+a.titleRowClass+'">'+'<span class="'+a.labelClass+'">'+a.title+"</span>"+'<a href="javascript:void(0)" class="'+a.closeClass+'">&times;</a>'+"</div>"+"</div>"}},b),c.setup=function(){var d=c.setup;return function(){d.apply(c,arguments),c.$dropdown_header=a(b.html(b)),c.$dropdown.prepend(c.$dropdown_header)}}()}),K.registerPlugin("optgroup_columns",function(b){var c=this;b=a.extend({equalizeWidth:!0,equalizeHeight:!0},b),this.getAdjacentOption=function(b,c){var d=b.closest("[data-group]").find("[data-selectable]"),e=d.index(b)+c;return e>=0&&e<d.length?d.eq(e):a()},this.onKeyDown=function(){var a=c.onKeyDown;return function(b){var d,e,f,g;return!this.isOpen||b.keyCode!==h&&b.keyCode!==j?a.apply(this,arguments):(c.ignoreHover=!0,g=this.$activeOption.closest("[data-group]"),d=g.find("[data-selectable]").index(this.$activeOption),g=b.keyCode===h?g.prev("[data-group]"):g.next("[data-group]"),f=g.find("[data-selectable]"),e=f.eq(Math.min(f.length-1,d)),e.length&&this.setActiveOption(e),void 0)}}();var d=function(){var d,e,f,g,h,i,j;if(j=a("[data-group]",c.$dropdown_content),e=j.length,e&&c.$dropdown_content.width()){if(b.equalizeHeight){for(f=0,d=0;e>d;d++)f=Math.max(f,j.eq(d).height());j.css({height:f})}b.equalizeWidth&&(i=c.$dropdown_content.innerWidth(),g=Math.round(i/e),j.css({width:g}),e>1&&(h=i-g*(e-1),j.eq(e-1).css({width:h})))}};(b.equalizeHeight||b.equalizeWidth)&&(A.after(this,"positionDropdown",d),A.after(this,"refreshOptions",d))}),K.registerPlugin("remove_button",function(){var b=this;this.settings.render.item=function(a){var c=a[b.settings.labelField];return'<div class="item">'+c+' <a href="javascript:void(0)" class="remove" tabindex="-1" title="Remove">&times;</a></div>'},this.setup=function(){var c=b.setup;return function(){c.apply(this,arguments),this.$control.on("click",".remove",function(c){c.preventDefault();var d=a(c.target).parent();b.setActiveItem(d),b.deleteSelection()&&b.setCaret(b.items.length)})}}()
}),K.registerPlugin("restore_on_backspace",function(a){var b=this;a.text=a.text||function(a){return a[this.settings.labelField]},this.onKeyDown=function(){var c=b.onKeyDown;return function(b){var d,e;return b.keyCode===l&&""===this.$control_input.val()&&!this.$activeItems.length&&(d=this.caretPos-1,d>=0&&d<this.items.length)?(e=this.options[this.items[d]],this.deleteSelection(b)&&(this.setTextboxValue(a.text.apply(this,[e])),this.refreshOptions(!0)),b.preventDefault(),void 0):c.apply(this,arguments)}}()}),K})});
