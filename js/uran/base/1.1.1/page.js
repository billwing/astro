define("uran/base/1.1.1/page",["$","lib/base/1.1.1/base","lib/class/1.1.0/class","lib/events/1.1.0/events","./path","./navigation","./history"],function(a){var b=a("$"),c=a("lib/base/1.1.1/base"),d=a("./path"),e=a("./navigation"),f=b(window),g=c.extend({attrs:{initPath:"",animate:!1,easeout:"page-slideoutleft",easein:"page-slideinright",easeoutreverse:"page-slideoutright",easeinreverse:"page-slideinleft"},init:function(a){this._initPages(a),this._initEvents()},_initPages:function(a){this.pages=[];for(var c in a){var e=b('[data-url="'+c+'"]');this.pages.push({url:d.parseUrl(d.makeUrlAbsolute(c)),dom:e,title:e.data("title"),control:a[c]})}var f=this.get("initPath");if(f){var c=d.parseUrl(d.squash(d.makeUrlAbsolute(f)));this.activePage=this.pages[this._getIndexByUrl(c)]}else this.activePage=this.pages[0];this.forward(this.activePage.url,this.get("data"))},_initEvents:function(){var a=this;f.on("navigate",function(b,c){var d=c.state;!d.url&&a.get("data").backUrl?window.location.href=a.get("data").backUrl:"forward"===d.direction?a.forward(d.url):a.backward(d.url)}),b(document).on("click","[data-transition]",function(b){b.preventDefault(),a.forward(this.href)}),b(document).on("click","[data-rel=back]",function(a){a.preventDefault(),window.history.back()})},forward:function(a,c,e){if(!this.transiting&&a){this.transiting=!0;var f,g="object"===b.type(a)?a:d.parseUrl(d.squash(d.makeUrlAbsolute(a)));(f=this._getIndexByUrl(g))<0?this._createPage({url:g,data:c,post:e}):this.transition(this.pages[f],!1,c)}},backward:function(a,c,e){if(!this.transiting)if(a){this.transiting=!0;var f,g="object"===b.type(a)?a:d.parseUrl(d.squash(d.makeUrlAbsolute(a)));(f=this._getIndexByUrl(g))<0?this._createPage({url:g,data:c,post:e},!0):this.transition(this.pages[f],!0,c)}else window.history.back()},transition:function(a,b,c){var d=this,f=a.url,g=a.dom,h=this.activePage,i=h.dom,j=h.url,k=b?this.get("easeoutreverse"):this.get("easeout"),l=b?this.get("easeinreverse"):this.get("easein");d.trigger("transiting"),a.title&&(document.title=a.title);var m=function(){i.removeClass("ui-page-active"),d.get("animate")&&i.removeClass(k).off("animationend webkitAnimationEnd",arguments.callee),i.data("cache")===!1&&(d.pages.splice(d._getIndexByUrl(j),1),i.remove())},n=function(){d.get("animate")&&g.removeClass(l).off("animationend webkitAnimationEnd",arguments.callee),d.activePage=a,d.transiting=!1,d.trigger("transition",a),window.scrollTo(0,0)};this.get("animate")?(i.on("animationend webkitAnimationEnd",m).addClass(k),g.on("animationend webkitAnimationEnd",n).addClass("ui-page-active "+l)):(m(),n(),g.addClass("ui-page-active")),e.go(f,b),a.control&&a.control(c)},_getIndexByUrl:function(a){for(var b=this.pages,c=0,d=b.length;d>c;c++)if(a.hrefNoHash===b[c].url.hrefNoHash)return c;return-1},_createPage:function(a,c){this.trigger("loading"),b.ajax(a.url.href,{type:a.post?"post":"get",data:a.data,context:this,success:function(d){var e,f,g,h,i=b("<div></div>"),j=this.pages;e=d.match(/<title[^>]*>([^<]*)/)&&RegExp.$1,f=d.match(/<body[^>]*>([\s\S]*)<\/body>/gim)&&RegExp.$1,i.get(0).innerHTML=f,g=i.find("[data-role=page]").eq(0),a.post&&g.data("cache",!1),this.activePage.dom.after(g),h={url:a.url,dom:g,title:e},this.trigger("load",h),c?(j.unshift(h),this.transition(h,!0)):(j.push(h),this.transition(h))},error:function(){this.trigger("error",a),this.transiting=!1}})}});return g}),define("uran/base/1.1.1/path",["$"],function(a){var b=a("$"),c=b("head").find("base"),d={urlParseRE:/^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,getLocation:function(a){var b=a?this.parseUrl(a):location,c=this.parseUrl(a||location.href).hash;return c="#"===c?"":c,b.protocol+"//"+b.host+b.pathname+b.search+c},parseLocation:function(){return this.parseUrl(this.getLocation())},parseUrl:function(a){if("object"===b.type(a))return a;var c=d.urlParseRE.exec(a||"")||[];return{href:c[0]||"",hrefNoHash:c[1]||"",hrefNoSearch:c[2]||"",domain:c[3]||"",protocol:c[4]||"",doubleSlash:c[5]||"",authority:c[6]||"",username:c[8]||"",password:c[9]||"",host:c[10]||"",hostname:c[11]||"",port:c[12]||"",pathname:c[13]||"",directory:c[14]||"",filename:c[15]||"",search:c[16]||"",hash:c[17]||""}},makePathAbsolute:function(a,b){if(a&&"/"===a.charAt(0))return a;a=a||"",b=b?b.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"";for(var c=b?b.split("/"):[],d=a.split("/"),e=0;e<d.length;e++){var f=d[e];switch(f){case".":break;case"..":c.length&&c.pop();break;default:c.push(f)}}return"/"+c.join("/")},isSameDomain:function(a,b){return d.parseUrl(a).domain===d.parseUrl(b).domain},isRelativeUrl:function(a){return""===d.parseUrl(a).protocol},isAbsoluteUrl:function(a){return""!==d.parseUrl(a).protocol},makeUrlAbsolute:function(a,b){if(!d.isRelativeUrl(a))return a;void 0===b&&(b=this.documentBase);var c=d.parseUrl(a),e=d.parseUrl(b),f=c.protocol||e.protocol,g=c.protocol?c.doubleSlash:c.doubleSlash||e.doubleSlash,h=c.authority||e.authority,i=""!==c.pathname,j=d.makePathAbsolute(c.pathname||e.filename,e.pathname),k=c.search||!i&&e.search||"",l=c.hash;return f+g+h+j+k+l},addSearchParams:function(a,c){var e=d.parseUrl(a),f="object"==typeof c?b.param(c):c,g=e.search||"?";return e.hrefNoSearch+g+("?"!==g.charAt(g.length-1)?"&":"")+f+(e.hash||"")},get:function(a){return void 0===a&&(a=d.parseLocation().hash),d.stripHash(a).replace(/[^\/]*\.[^\/*]+$/,"")},set:function(a){location.hash=a},isPath:function(a){return/\//.test(a)},clean:function(a){return a.replace(this.documentBase.domain,"")},stripHash:function(a){return a.replace(/^#/,"")},stripQueryParams:function(a){return a.replace(/\?.*$/,"")},cleanHash:function(a){return d.stripHash(a.replace(/\?.*$/,""))},isHashValid:function(a){return/^#[^#]+$/.test(a)},isExternal:function(a){var b=d.parseUrl(a);return b.protocol&&b.domain!==this.documentUrl.domain?!0:!1},hasProtocol:function(a){return/^(:?\w+:)/.test(a)},squash:function(a,b){var c,e,f,g=this.isPath(a),h=this.parseUrl(a),i=h.hash;return b=b||(d.isPath(a)?d.getLocation():d.getDocumentUrl()),e=g?d.stripHash(a):a,e=d.isPath(h.hash)?d.stripHash(h.hash):e,c=d.makeUrlAbsolute(e,b),f=this.parseUrl(c).search,g&&(d.isPath(i)&&(i=""),-1===i.indexOf("#")&&""!==i&&(i="#"+i),c=d.parseUrl(c),c=c.protocol+"//"+c.host+c.pathname+f+i),c}};return d.documentUrl=d.parseLocation(),d.documentBase=c.length?d.parseUrl(d.makeUrlAbsolute(c.attr("href"),d.documentUrl.href)):d.documentUrl,d.documentBaseDiffers=d.documentUrl.hrefNoHash!==d.documentBase.hrefNoHash,d.getDocumentUrl=function(a){return a?b.extend({},d.documentUrl):d.documentUrl.href},d.getDocumentBase=function(a){return a?b.extend({},d.documentBase):d.documentBase.href},d}),define("uran/base/1.1.1/navigation",["$","uran/base/1.1.1/path","uran/base/1.1.1/history"],function(a){var b=a("$"),c=a("uran/base/1.1.1/path"),d=a("uran/base/1.1.1/history"),e=b(window),f={currentHref:c.documentBase.hrefNoHash,go:function(a,b){var e=d.find(a.hrefNoHash);c.documentBase.hrefNoHash===a.hrefNoHash?c.set("#"):c.set("#"+a.pathname),0>e&&(b||d.clearForward(this.currentHref),d.add(a.hrefNoHash,b)),b&&d.clearForward(a.hrefNoHash),this.currentHref=a.hrefNoHash}};return e.on("hashchange",function(){var a=c.parseUrl(c.squash(location.href)),e=a.hrefNoHash;if(e!==f.currentHref){var g=d.find(f.currentHref),h=d.find(e);b(this).trigger("navigate",{state:{direction:h>-1||g>h?"backward":"forward",url:h>-1?a:null}})}}),f}),define("uran/base/1.1.1/history",["$"],function(a){function b(){this._stack=[]}var c=a("$");return window.undefined,c.extend(b.prototype,{add:function(a,b){this._stack[b?"unshift":"push"](a)},clearForward:function(a){this._stack=this._stack.slice(0,this.find(a)+1)},find:function(a){return this._stack.indexOf(a)}}),new b});
