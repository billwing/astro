/*!
 *@Name:JZ Web Chatting
 *@Autor:Billwing
 *@Version:3.0.0
 *@Date:2012-06-01
 *@Modify:2014-05-21
 */
var JZIM=window.JZIM||{};var ua=(window.navigator.userAgent||"").toLowerCase(),isIE=/\msie [678]\.0\b/.test(ua),isIE6=ua.indexOf("msie 6")!==-1,isIE7=ua.indexOf("msie 7")!==-1,isIE8=ua.indexOf("msie 8")!==-1;(function(j,o){var d=j.document,p=d.documentElement,w=function(){var m=d.body,s=isIE,q=isIE6,n=1,t="cache"+(+new Date+"").slice(-8),l={},e=function(){};e.prototype={getOptions:function(a){var b,c={},f={container:null,overlay:!0,drag:!0,fixed:!0,follow:null,followX:0,followY:0,autoClose:0,lock:!1,callback:null};for(b in f)c[b]=a[b]!==o?a[b]:f[b];e.data("options",c);return c},setBodyBg:function(){if(m.currentStyle.backgroundAttachment!=="fixed")m.style.backgroundImage="url(about:blank)",m.style.backgroundAttachment="fixed"},appendIframe:function(a){a.innerHTML='<iframe style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:-1;border:0 none;filter:alpha(opacity=0)"></iframe>'},setFollow:function(a,b,c,f){b=typeof b==="string"?d.getElementById(b):b;a=a.style;a.position="absolute";a.left=e.getOffset(b,"left")+c+"px";a.top=e.getOffset(b,"top")+f+"px"},setPosition:function(a,b){var c=a.style;c.position=q?"absolute":b?"fixed":"absolute";if(!isIE8){b?(q?c.setExpression("top",'fuckIE6=document.documentElement.scrollTop+document.documentElement.clientHeight/2+"px"'):c.top="50%",c.left="50%"):(q&&c.removeExpression("top"),c.top=p.clientHeight/2+e.getScroll("top")+"px",c.left=p.clientWidth/2+e.getScroll("left")+"px")}else{c.top=p.clientHeight/2+e.getScroll("top")+"px";c.left=p.clientWidth/2+e.getScroll("left")+"px"}},createOverlay:function(){var a=d.createElement("div"),b=a.style;b.cssText="margin:0;padding:0;border:none;width:100%;height:100%;background:#333;opacity:0.6;filter:alpha(opacity=60);z-index:9999;position:fixed;top:0;left:0;";if(q)m.style.height="100%",b.position="absolute",b.setExpression("top",'fuckIE6=document.documentElement.scrollTop+"px"');a.id="overlay";return a},createDialogBox:function(){var a=d.createElement("div");a.style.cssText="margin:0;padding:0;border:none;z-index:999;";a.id="chatBox";return a},createDialogWrap:function(a){var b=typeof a.yesFn==="function"?'<button class="chat_yes_btn" id="chatYesBtn">'+(typeof a.yesText==="string"?a.yesText:"\u786e\u5b9a")+"</button>":"",c=typeof a.noFn==="function"||a.noFn===!0?'<button class="chat_no_btn" id="chatNoBtn">'+(typeof a.noText==="string"?a.noText:"\u53d6\u6d88")+"</button>":"",a=['<div class="chat_cont">',a.header?'<h4 class="chat_tit" id="chatTit"><a href="javascript:void(0)" title="\u5173\u95ed\u7a97\u53e3" class="close_btn" id="chatCls">&times;</a>'+a.header+"</h4>":"",'<div class="chat_txt">'+a.content+"</div>",b===""&&c===""?"":'<div class="chat_footer">'+c+b+"</div>","</div>"].join(""),b=d.getElementById("sendMsg");if(!b)b=d.createElement("div"),b.id="sendMsg",b.className="chat_wrap";b.innerHTML=a.replace(/<[\/]*script[\s\S]*?>/ig,"");return b}};e.data=function(a,b,c){if(typeof a==="string")return b!==o&&(l[a]=b),l[a];else if(typeof a==="object")return a=a===j?0:a.nodeType===9?1:a[t]?a[t]:a[t]=++n,a=l[a]?l[a]:l[a]={},c!==o&&(a[b]=c),a[b]};e.removeData=function(a,b){if(typeof a==="string")delete l[a];else if(typeof a==="object"){var c=a===j?0:a.nodeType===9?1:a[t];if(c!==o){var e=function(a){for(var b in a)return!1;return!0},g=function(){delete l[c];if(!(c<=1))try{delete a[t]}catch(b){a.removeAttribute(t)}};b?(delete l[c][b],e(l[c])&&g()):g()}}};e.event={bind:function(a,b,c){var f=e.data(a,"e"+b)||e.data(a,"e"+b,[]);f.push(c);f.length===1&&(c=this.eventHandler(a),e.data(a,b+"Handler",c),a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))},unbind:function(a,b,c){var f=e.data(a,"e"+b);if(f){if(c)for(var g=f.length-1,d=f[g];g>=0;g--)d===c&&f.splice(g,1);else f=o;if(!f||!f.length)c=e.data(a,b+"Handler"),a.addEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c),e.removeData(a,b+"Handler"),e.removeData(a,"e"+b)}},eventHandler:function(a){return function(b){for(var b=e.event.fixEvent(b||j.event),c=e.data(a,"e"+b.type),f=0,g;g=c[f++];)g.call(a,b)===!1&&(b.preventDefault(),b.stopPropagation())}},fixEvent:function(a){if(a.target)return a;var b={},c;b.target=a.srcElement||document;b.preventDefault=function(){a.returnValue=!1};b.stopPropagation=function(){a.cancelBubble=!0};for(c in a)b[c]=a[c];return b}};e.capitalize=function(a){var b=a.charAt(0);return b.toUpperCase()+a.replace(b,"")};e.getScroll=function(a){a=this.capitalize(a);return p["scroll"+a]||m["scroll"+a]};e.getOffset=function(a,b){var c=this.capitalize(b),c=p["client"+c]||m["client"+c]||0,e=this.getScroll(b),g=a.getBoundingClientRect();return Math.round(g[b])+e-c};e.drag=function(a,b){var c="getSelection"in j?function(){j.getSelection().removeAllRanges()}:function(){try{d.selection.empty()}catch(a){}},f=this,g=f.event,i=!1,h=s?a:d,k=b.style.position==="fixed",m=e.data("options").fixed;g.bind(a,"mousedown",function(c){i=!0;var d=f.getScroll("top"),j=f.getScroll("left"),o=k?0:j,r=k?0:d;e.data("dragData",{x:c.clientX-f.getOffset(b,"left")+(k?j:0),y:c.clientY-f.getOffset(b,"top")+(k?d:0),el:o,et:r,er:o+p.clientWidth-b.offsetWidth,eb:r+p.clientHeight-b.offsetHeight});s&&(q&&m&&b.style.removeExpression("top"),a.setCapture());g.bind(h,"mousemove",l);g.bind(h,"mouseup",n);s&&g.bind(a,"losecapture",n);c.stopPropagation();c.preventDefault()});var l=function(a){if(i){c();var d=e.data("dragData"),f=a.clientX-d.x,g=a.clientY-d.y,h=d.et,k=d.er,m=d.eb,d=d.el,j=b.style;j.marginLeft=j.marginTop="0px";j.left=(f<=d?d:f>=k?k:f)+"px";j.top=(g<=h?h:g>=m?m:g)+"px";a.stopPropagation()}},n=function(c){i=!1;s&&g.unbind(a,"losecapture",arguments.callee);g.unbind(h,"mousemove",l);g.unbind(h,"mouseup",arguments.callee);if(s&&(a.releaseCapture(),q&&m)){var d=parseInt(b.style.top)-f.getScroll("top");b.style.setExpression("top","fuckIE6=document.documentElement.scrollTop+"+d+'+"px"')}c.stopPropagation()}};var r,u=function(a){a.keyCode===27&&v.close()},v={open:function(a){var b=new e,c=b.getOptions(a||{}),a=e.event,f=this,g,i,h,k;r&&(clearTimeout(r),r=o);if(c.overlay)g=d.getElementById("overlay"),g||(g=b.createOverlay(),m.appendChild(g),q&&b.appendIframe(g)),g.style.display="block";q&&b.setBodyBg();i=d.getElementById("chatBox");i||(i=b.createDialogBox(),m.appendChild(i));if(c.follow){b.setFollow(i,c.follow,c.followX,c.followY);if(g)g.style.display="none";c.fixed=!1}else b.setPosition(i,c.fixed);i.style.display="block";!c.follow&&!c.fixed&&(h=function(){b.setPosition(i,!1)},a.bind(j,"resize",h),e.data("resize",h));h=typeof c.container==="string"?d.getElementById(c.container):b.createDialogWrap(c.container);if(k=i.getElementsByTagName("*")[0]){if(k&&h!==k)k.style.display="none",m.appendChild(k),i.appendChild(h)}else i.appendChild(h);h.style.display="block";k=h.offsetWidth;var l=h.offsetHeight;h.style.marginTop=h.style.marginRight=h.style.marginBottom=h.style.marginLeft="0px";c.follow?i.style.marginLeft=i.style.marginTop="0px":(i.style.marginLeft="-"+k/2+"px",i.style.marginTop="-"+l/2+"px");if(q&&!c.overlay)i.style.width=k+"px",i.style.height=l+"px";h=d.getElementById("chatCls");k=d.getElementById("chatTit");var l=d.getElementById("chatYesBtn"),n=d.getElementById("chatNoBtn");l&&a.bind(l,"click",function(a){c.container.yesFn.call(f,a)!==!1&&f.close()});if(n){var p=function(a){(c.container.noFn===!0||c.container.noFn.call(f,a)!==!1)&&f.close()};a.bind(n,"click",p);h&&a.bind(h,"click",p)}else h&&a.bind(h,"click",f.close);c.lock||a.bind(d,"keyup",u);c.autoClose&&typeof c.autoClose==="number"&&(r=setTimeout(f.close,c.autoClose));if(c.drag&&k)k.style.cursor="move",e.drag(k,i);e.data("dialogElements",{overlay:g,dialogBox:i,chatCls:h,dialogTitle:k,dialogYesBtn:l,dialogNoBtn:n})},close:function(){var a=e.data("options"),b=e.data("dialogElements"),c=e.event;r&&(clearTimeout(r),r=o);if(a.overlay&&b.overlay)b.overlay.style.display="none";b.dialogBox.style.display="none";q&&b.dialogBox.style.removeExpression("top");b.chatCls&&c.unbind(b.chatCls,"click");b.dialogTitle&&c.unbind(b.dialogTitle,"mousedown");b.dialogYesBtn&&c.unbind(b.dialogYesBtn,"click");b.dialogNoBtn&&c.unbind(b.dialogNoBtn,"click");!a.follow&&!a.fixed&&(b=e.data("resize"),c.unbind(j,"resize",b),e.removeData("resize"));a.lock||c.unbind(d,"keyup",u);typeof a.callback==="function"&&a.callback.call(v);e.removeData("options");e.removeData("dialogElements")}};return v},n=function(){j.jzChat=w()},u=function(){if(!d.body){try{p.doScroll("left")}catch(j){setTimeout(u,1);return}n()}};(function(){if(d.body)n();else if(d.addEventListener)d.addEventListener("DOMContentLoaded",function(){d.removeEventListener("DOMContentLoaded",arguments.callee,!1);n()},!1),j.addEventListener("load",n,!1);else if(d.attachEvent){d.attachEvent("onreadystatechange",function(){d.readyState==="complete"&&(d.detachEvent("onreadystatechange",arguments.callee),n())});j.attachEvent("onload",n);var m=!1;try{m=j.frameElement==null}catch(o){}p.doScroll&&m&&u()}})()})(window,void 0);function placeCaretAtEnd(a){a.focus();if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var b=document.createRange();b.selectNodeContents(a);b.collapse(false);var c=window.getSelection();c.removeAllRanges();c.addRange(b)}else if(typeof document.body.createTextRange!="undefined"){var d=document.body.createTextRange();d.moveToElementText(a);d.collapse(false);d.select()}}(function($){$.fn.setCursorPosition=function(a){if(this.length==0)return this;return $(this).setSelection(a,a)};$.fn.setSelection=function(a,b){if(this.length==0)return this;input=this[0];if(input.createTextRange){var c=input.createTextRange();c.collapse(true);c.moveEnd('character',b);c.moveStart('character',a);c.select()}else if(input.setSelectionRange){input.focus();input.setSelectionRange(a,b)}return this};$.fn.focusEnd=function(){this.setCursorPosition(this.text().length)};$.expBlock={};var h='http://static.n8n8.cn/Public/Images/chatFace/';var k=[{name:'默认',icons:[{url:"1.gif",title:"0",alt:"微笑"},{url:"2.gif",title:"1",alt:"撇嘴"},{url:"3.gif",title:"2",alt:"色"},{url:"4.gif",title:"3",alt:"发呆"},{url:"5.gif",title:"4",alt:"得意"},{url:"6.gif",title:"5",alt:"流泪"},{url:"7.gif",title:"6",alt:"害羞"},{url:"8.gif",title:"7",alt:"闭嘴"},{url:"9.gif",title:"8",alt:"睡"},{url:"10.gif",title:"9",alt:"大哭"},{url:"11.gif",title:"10",alt:"尴尬"},{url:"12.gif",title:"11",alt:"发怒"},{url:"13.gif",title:"12",alt:"调皮"},{url:"14.gif",title:"13",alt:"呲牙"},{url:"15.gif",title:"14",alt:"惊讶"},{url:"16.gif",title:"15",alt:"难过"},{url:"17.gif",title:"16",alt:"酷"},{url:"18.gif",title:"17",alt:"冷汗"},{url:"19.gif",title:"18",alt:"抓狂"},{url:"20.gif",title:"19",alt:"吐"},{url:"21.gif",title:"20",alt:"偷笑"},{url:"22.gif",title:"21",alt:"可爱"},{url:"23.gif",title:"22",alt:"白眼"},{url:"24.gif",title:"23",alt:"傲慢"},{url:"25.gif",title:"24",alt:"饥饿"},{url:"26.gif",title:"25",alt:"困"},{url:"27.gif",title:"26",alt:"惊恐"},{url:"28.gif",title:"27",alt:"流汗"},{url:"29.gif",title:"28",alt:"憨笑"},{url:"30.gif",title:"29",alt:"大兵"},{url:"31.gif",title:"30",alt:"奋斗"},{url:"32.gif",title:"31",alt:"咒骂"},{url:"33.gif",title:"32",alt:"疑问"},{url:"34.gif",title:"33",alt:"嘘.."},{url:"35.gif",title:"34",alt:"晕"},{url:"36.gif",title:"35",alt:"折磨"},{url:"37.gif",title:"36",alt:"衰"},{url:"38.gif",title:"37",alt:"骷髅"},{url:"39.gif",title:"38",alt:"敲打"},{url:"40.gif",title:"39",alt:"再见"},{url:"41.gif",title:"40",alt:"擦汗"},{url:"42.gif",title:"41",alt:"抠鼻"},{url:"43.gif",title:"42",alt:"鼓掌"},{url:"44.gif",title:"43",alt:"糗大了"},{url:"45.gif",title:"44",alt:"坏笑"},{url:"46.gif",title:"45",alt:"左哼哼"},{url:"47.gif",title:"46",alt:"右哼哼"},{url:"48.gif",title:"47",alt:"哈欠"},{url:"49.gif",title:"48",alt:"鄙视"},{url:"50.gif",title:"49",alt:"委屈"},{url:"51.gif",title:"50",alt:"快哭了"},{url:"52.gif",title:"51",alt:"阴险"},{url:"53.gif",title:"52",alt:"亲亲"},{url:"54.gif",title:"53",alt:"吓"},{url:"55.gif",title:"54",alt:"可怜"},{url:"56.gif",title:"55",alt:"菜刀"},{url:"57.gif",title:"56",alt:"西瓜"},{url:"58.gif",title:"57",alt:"啤酒"},{url:"59.gif",title:"58",alt:"篮球"},{url:"60.gif",title:"59",alt:"乒乓"},{url:"61.gif",title:"60",alt:"咖啡"},{url:"62.gif",title:"61",alt:"饭"},{url:"63.gif",title:"62",alt:"猪头"},{url:"64.gif",title:"63",alt:"玫瑰"},{url:"65.gif",title:"64",alt:"凋谢"},{url:"66.gif",title:"65",alt:"示爱"},{url:"67.gif",title:"66",alt:"爱心"},{url:"68.gif",title:"67",alt:"心碎"},{url:"69.gif",title:"68",alt:"蛋糕"},{url:"70.gif",title:"69",alt:"闪电"},{url:"71.gif",title:"70",alt:"炸弹"},{url:"72.gif",title:"71",alt:"刀"},{url:"73.gif",title:"72",alt:"足球"},{url:"74.gif",title:"73",alt:"瓢虫"},{url:"75.gif",title:"74",alt:"便便"},{url:"76.gif",title:"75",alt:"月亮"},{url:"77.gif",title:"76",alt:"太阳"},{url:"78.gif",title:"77",alt:"礼物"},{url:"79.gif",title:"78",alt:"拥抱"},{url:"80.gif",title:"79",alt:"强"},{url:"81.gif",title:"80",alt:"弱"},{url:"82.gif",title:"81",alt:"握手"},{url:"83.gif",title:"82",alt:"胜利"},{url:"84.gif",title:"83",alt:"抱拳"},{url:"85.gif",title:"84",alt:"勾引"},{url:"86.gif",title:"85",alt:"拳头"},{url:"87.gif",title:"86",alt:"差劲"},{url:"88.gif",title:"87",alt:"爱你"},{url:"89.gif",title:"88",alt:"NO"},{url:"90.gif",title:"89",alt:"OK"},{url:"91.gif",title:"90",alt:"爱情"},{url:"92.gif",title:"91",alt:"飞吻"},{url:"93.gif",title:"92",alt:"跳跳"},{url:"94.gif",title:"93",alt:"发抖"},{url:"95.gif",title:"94",alt:"怄火"},{url:"96.gif",title:"95",alt:"转圈"},{url:"97.gif",title:"96",alt:"磕头"},{url:"98.gif",title:"97",alt:"回头"},{url:"99.gif",title:"98",alt:"跳绳"},{url:"100.gif",title:"99",alt:"挥手"},{url:"101.gif",title:"100",alt:"激动"},{url:"102.gif",title:"101",alt:"街舞"},{url:"103.gif",title:"102",alt:"献吻"},{url:"104.gif",title:"103",alt:"左太极"},{url:"105.gif",title:"104",alt:"右太极"}]}],IMGS_DATA=[],expEnable=true,config={expData:null,holder:'.exp-holder',textarea:'textarea',trigger:'.exp-block-trigger',grpNum:5,posType:'absolute',zIndex:'1000001'},pos_correct_left=30,exp_close_tri='.exp-close',grp_num_per_panel=1,win=window||document,bd='body';function init(f){$.extend(config,f);if(config.expData!=null)k=config.expData;_getImgData();var g=$(config.trigger);g.each(function(){$(this).unbind('click');$(this).bind('click',function(){var c=$(this),holder=$(c.parents(config.holder)[0]),ta=$(holder.find(config.textarea)[0]),exp=$(_genrt_html()),off=c.offset(),me_l=off.left-50,me_t=off.top,me_w=c.width(),me_h=c.height(),exp_t=me_t+me_h,exp_l=me_l+(me_w+pos_correct_left)/2,exp_close=exp.find(exp_close_tri),exp_sub_tab=exp.find('.exp-sub-tab'),sub_tab_items=exp_sub_tab.children('.group-name'),sub_tab_pre=exp_sub_tab.find('.pre'),sub_tab_next=exp_sub_tab.find('.next'),curGroup=null,grpCnt=k.length,grpPgCnt=(function(){var p=Math.floor(grpCnt/config.grpNum);if(grpCnt%config.grpNum!=0){return p+1}else{return p}})(),curGrpPg=1,expUl=exp.find('.exp-detail');var d=function(i){var b='',listDOM;if(curGroup!=null&&curGroup!=i){sub_tab_items.eq(curGroup).removeClass('slct');curGroup=i;sub_tab_items.eq(i).addClass('slct');sub_tab_items.eq(i).addClass('slct');for(var j=0;j<k[i].icons.length;j++){b+='<li action-data="[:){'+k[i].icons[j].title+'}(:]"><img title="'+k[i].icons[j].alt+'" alt="'+k[i].icons[j].alt+'" src="'+h+k[i].icons[j].url+'"></li>'}listDOM=$(b);listDOM.each(function(){$(this).click(function(){var a=$(this),actData=a.attr('action-data'),taVal=ta.val();ta.val(taVal+actData);$(bd).unbind('click');a.unbind('mouseout');$(win).unbind('resize');exp.remove()})});expUl.children().remove();expUl.append(listDOM)}else if(curGroup==null){curGroup=i;sub_tab_items.eq(i).addClass('slct');for(var j=0;j<k[i].icons.length;j++){b+='<li action-data="[:){'+k[i].icons[j].title+'}(:]"><img title="'+k[i].icons[j].alt+'" alt="'+k[i].icons[j].alt+'" src="'+h+k[i].icons[j].url+'" data-name="[:){'+k[i].icons[j].title+'}(:]" data-val="'+k[i].icons[j].title+'"></li>'}listDOM=$(b);listDOM.each(function(){$(this).click(function(){var a=$(this),actData=a.attr('action-data'),taVal=ta.text();if(isIE8){ta.append(a.html()+"&nbsp;")}else{ta.append(a.html())}$(bd).unbind('click');a.unbind('mouseout');$(win).unbind('resize');exp.remove();ta.focusEnd();placeCaretAtEnd(document.getElementById('chatInp'))})});expUl.children().remove();expUl.append(listDOM)}else if(curGroup!=null&&curGroup==i){}},showGrp=function(i){var a={};a.left=(i-1)*config.grpNum;a.left=Math.max(0,a.left);a.right=(i)*config.grpNum-1;a.right=Math.min(a.right,grpCnt-1);sub_tab_items.hide();for(var j=a.left;j<=a.right;j++){sub_tab_items.eq(j).show()}curGrpPg=i;if(curGrpPg==1){sub_tab_pre.addClass('pre-disable')}else{sub_tab_pre.removeClass('pre-disable')}if(curGrpPg>=grpPgCnt){sub_tab_next.addClass('next-disalbe')}else{sub_tab_next.removeClass('next-disalbe')}};if(config.posType=='fixed'){me_t=off.top-$(win).scrollTop();exp_t=me_t+me_h}if(expEnable){exp.css({position:config.posType,zIndex:config.zIndex,left:'-200px',top:'57px'});$(win).resize(function(){off=c.offset(),me_l=off.left-50,me_t=off.top;exp_t=me_t+me_h,exp_l=me_l+(me_w+pos_correct_left)/2;exp.css({left:exp_l+'px',top:exp_t+'px'})});exp_close.click(function(){$(bd).unbind('click');c.unbind('mouseout');$(win).unbind('resize');exp.remove()});c.mouseout(function(){$(bd).click(function(e){var b=$(e.target);var a=b.parents('.exp-layer');if(!a.hasClass('exp-layer')){exp.remove();$(bd).unbind('click');c.unbind('mouseout');$(win).unbind('resize')}})});showGrp(1);sub_tab_pre.click(function(){var p=curGrpPg-1,rg;p=(p<1)?1:p;showGrp(p)});sub_tab_next.click(function(){var p=curGrpPg+1,rg;p=(p>grpPgCnt)?curGrpPg:p;showGrp(p)});d(0);sub_tab_items.each(function(){$(this).click(function(){var a=$(this),groupIndex=a.attr('grp-index');d(groupIndex)})});$('#chatBox').append(exp);exp.show()}})})}function disableExp(){expEnable=false}function enableExp(){expEnable=true}function getRemoteNewExp(b){$.ajax({url:b,success:function(a){k=eval(a);_getImgData()},error:function(){('传入的url错误')}})}function textFormat(a){var b=/\[\:\)\{(\d+)\}\(\:\]/g,src=a,rslt,temp;_getImgData();while(temp=b.exec(src)){var s=_switchImg(temp[1]),creg,t="\\[\\:\\)\\{"+temp[1]+"\\}\\(\\:\\]";creg=new RegExp(t,"g");if(src.match(temp[0])&&s!=temp[1]){src=src.replace(creg,s)}}return src}function _genrt_html(){var a='<div class="exp-layer"><div class="holder"><div class="content"><div class="exp-tab clearfix"><a href="javascript:;">常用表情</a></div><div class="exp-sub-tab clearfix">';a+='<div class="sub-tab-pagination"><a class="pre"></a><a class="next"></a></div></div><ul class="exp-detail clearfix">';a+='</ul></div><a class="exp-close" href="javascript:;" target="_self" title="关闭"></a></div><a class="exp-tri" href="javascript:;"></a></div>';return a}function _switchImg(a){for(var i=0;i<IMGS_DATA.length;i++){if(IMGS_DATA[i].title==a){return'<img src="'+h+IMGS_DATA[i].url+'" width="24" height="24" />'}}return a}function _getImgData(){for(var i=0;i<k.length;i++){IMGS_DATA.push(k[i].icons);for(var j=0;j<k[i].icons.length;j++){IMGS_DATA.push(k[i].icons[j])}}}$.expBlock={initExp:init,disableExp:disableExp,enableExp:enableExp,getRemoteExp:getRemoteNewExp,textFormat:textFormat}})(jQuery);$(function(){var a="http://static.n8n8.cn/Public/Images/ucenter/";var b='<style type="text/css">ul,dl{list-style:none;margin:0;padding:0;}h4,p{margin:0;}.msg_wrap{display:none;width:400px;font-family:Arial;color:#444;border:3px solid rgba(0,0,0,0);-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;-webkit-box-shadow:0 0 10px rgba(0,0,0,0.4);-moz-box-shadow:0 0 10px rgba(0,0,0,0.4);box-shadow:0 0 10px rgba(0,0,0,0.4)}.chat{margin:0;background:#FFF;}.msg_wrap .msg_tit{overflow:hidden;height:30px;padding:0 10px;line-height:30px;font-size:14px;color:#666;border-bottom:1px solid #e5e5e5;border-radius:4px 4px 0 0;background:#f7f7f7}#chatBtn{display:none;position:fixed;_position:absolute;*+cursor:pointer;top:230px;right:50px;width:75px;height:85px;background:url('+a+'u_chat_sprites.png) no-repeat -670px -468px}#chatBtn .sc_lnk{display:block;cursor:pointer;width:75px;height:85px;font-size:13px;}#chatBtn a.sc_lnk{text-decoration:none;color:#000;}#chatBtn .sc_txt{display:block;width:74px;padding:62px 0 0 1px;text-align:center}.chat{display:none;position:relative;width:542px;font:13px/1.5 Arial,sans-serif;text-align:left;border:0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.chat .msg_cont{border:0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.chat .msg_tit{height:25px;padding-left:30px;font-weight:normal;font-size:13px;line-height:25px;color:#070707;border:0;background:url('+a+'u_chat_sprites.png) no-repeat -2px -13px}.chat .msg_tit .minimize{float:right;width:12px;height:25px;margin-right:5px;background:url('+a+'u_chat_sprites.png) no-repeat -733px -290px}.chat .msg_tit .maximize{float:right;width:12px;height:25px;margin-right:5px;background:url('+a+'u_chat_sprites.png) no-repeat -733px -379px}.chat .msg_tit .close_btn{float:right;width:13px;height:25px;text-indent:-9999px;background:url('+a+'u_chat_sprites.png) no-repeat -732px -244px}.chat .ann{height:32px;margin-top:2px;padding-left:10px;line-height:32px;color:#666;background:url('+a+'u_chat_sprites.png) no-repeat -2px -40px}.chat .ann .p1{height:25px;line-height:25px}.chat .record{overflow-y:scroll;height:240px;margin:0 0 1px 1px;padding:10px;background:url('+a+'chat_c_bg.jpg) repeat-x 0 0}.chat .record .rec_c{padding-bottom:10px;}.chat .record .rec_c .rec_l dt{height:25px;line-height:25px;color:#018ddd}.chat .record .rec_c .rec_l dt.own{color:#008040;}.chat .record .rec_c .rec_l dd.rec_t{line-height:1.4;margin:0;padding-left:1em;word-wrap:break-word;}.chat .record .rec_c .rec_l dd.rec_t img{vertical-align:middle;}.chat .record .rec_c .rec_l dd.rec_t .lnk{color:#0000FF;text-decoration:underline;}.chat .tool{height:25px;line-height:25px;border-bottom:1px solid #ced5e0;background:#d7ebf6}.chat .tool .t_btn{padding:2px 0 0 1px}.chat .tool .t_btn li{float:left;height:21px;margin-left:2px;background:url('+a+'u_chat_sprites.png) no-repeat}.chat .tool .t_btn li a{display:block;height:21px}.chat .tool .t_btn .txt,.chat .tool .t_btn .txt .txt_a{width:23px}.chat .tool .t_btn .txt{background-position:-722px -14px}.chat .tool .t_btn .exp,.chat .tool .t_btn .exp .exp_a{width:22px}.chat .tool .t_btn .exp{background-position:-723px -193px;}.de-emoticons{z-index:10001!important}.chat .tool .t_btn .img,.chat .tool .t_btn .img .img_a{width:24px}.chat .tool .t_btn .img{background-position:-719px -117px}.chat .tool .t_btn .scr,.chat .tool .t_btn .scr .scr_a{width:22px}.chat .tool .t_btn .scr{background-position:-721px -57px}.chat .area{height:80px}.chat .area .c_inp{overflow:auto;width:532px;height:80px;padding:5px;font-size:13px;resize:none;border:0}.chat .area .c_inp img{vertical-align:bottom;}.chat .area .c_inp:focus{outline:0}.chat .btm{height:65px;background:url('+a+'u_chat_sprites.png) no-repeat -2px -303px}.chat .btm .sub{float:right;width:120px;height:22px;margin:25px 20px 0 0;_margin-right:10px;line-height:22px}.chat .btm .sub input{cursor:pointer;height:22px;line-height:18px;color:#666;border:0}.chat .btm .sub .c_clo{width:41px;background:url('+a+'u_chat_sprites.png) no-repeat -2px -203px}.chat .btm .sub .c_sub{float:right;width:70px;height:22px;background:url('+a+'u_chat_sprites.png) no-repeat -2px -260px}.chat .btm .sub .c_sub .c_s_btn{float:left;width:57px;background:0}.chat .btm .sub .c_sub .c_s_help .c_s_h_a{display:block;float:left;width:13px;height:22px}.exp-layer{display:none;position:absolute;left:200px;top:200px;z-index:10;width:457px;border-radius:4px;padding:4px;background:url('+a+'exp/layer_bg.png)}.exp-layer .holder{position:relative;z-index:30;border:1px solid #c3c3c3;border-radius:4px;background:#fff}.exp-layer .exp-tri{display:none;position:absolute;left:30px;top:-7px;z-index:40;width:16px;height:12px;background:url('+a+'exp/layer_arrow.png)}.exp-layer .exp-close{display:block;position:absolute;right:5px;top:5px;z-index:20;width:20px;height:20px;background:url('+a+'exp/ico.png) 5px -250px no-repeat}.exp-layer .exp-close:hover{background-position:0 -1954px}.exp-layer .exp-tab{padding:4px 4px 0 6px;background:#f0f0f0}.exp-layer .exp-tab a{display:block;float:left;height:25px;margin:0 3px;padding:0 10px;border:1px solid #e8e8e8;border-bottom:0;border-radius:4px 4px 0 0;background:#fff;font-size:12px;font-weight:400;text-overflow:clip;color:#666;text-decoration:none;line-height:25px}.exp-layer .exp-sub-tab{position:relative;margin:10px 0 0 16px;padding-right:60px;overflow:hidden}.exp-layer .exp-sub-tab a{display:block;float:left;height:23px;padding:0 7px;color:#9abbc8;font-size:12px;font-weight:400;text-decoration:none;line-height:23px}.exp-layer .exp-sub-tab a.slct{background:none repeat scroll 0 0 #f0f0f0;border-radius:3px 3px 3px 3px;cursor:default;position:relative;text-decoration:none;z-index:2}.exp-layer .exp-sub-tab span{float:left;margin:0 5px;color:#9abbc8}.exp-layer .sub-tab-pagination{position:absolute;right:10px;top:0;height:100%}.exp-layer .sub-tab-pagination a{display:none;width:17px;height:17px;margin:0 2px;padding:0;background:url('+a+'exp/ico.png) no-repeat;cursor:pointer;display:inline;line-height:17px}.exp-layer .sub-tab-pagination .pre{background-position:0 -1290px}.exp-layer .sub-tab-pagination .next{background-position:0 -1176px}.exp-layer .sub-tab-pagination a.pre-disable{background-position:0 -1367px;cursor:default}.exp-layer .sub-tab-pagination a.next-disalbe{background-position:0 -1253px;cursor:default}.exp-layer .exp-detail{margin:0 10px 10px 10px;}.exp-detail li{overflow:hidden;display:block;float:left;width:28px;height:28px;margin:-1px 0 0 -1px;line-height:28px;border:1px solid #e8e8e8;padding:0;text-align:center;cursor:pointer}.exp-detail li:hover{position:relative;border:1px solid #0095cd;background:#fff9ec;z-index:50}.clearfix:after{visibility:hidden;display:block;font-size:0;content:" ";clear:both;height:0}* html .clearfix{zoom:1}*:first-child+html .clearfix{zoom:1}</style>';$("head").append(b)});JZIM.chatPopUp=function(){jzChat.open({container:'chat',overlay:false});placeCaretAtEnd(document.getElementById('chatInp'));$("#chatCls").live("click",function(){$("body").unbind("mouseover")});$("#chatCls2").live("click",function(){$("#chatBox").css("display","none");$("body").unbind("mouseover")});$("#minimize").live("click",function(){$("#chatBox").css("display","none");$("body").unbind("mouseover")});$.expBlock.initExp({textarea:'#chatInp'});$.expBlock.disableExp();$.expBlock.enableExp()};function urlToLnk(a){return(a.replace(/((https?|ftp|file):\/\/[-a-zA-Z0-9+&@#\/%?=~_|!:,.;]*)/g,'<a class="lnk" href="$1" title="点击查看">$1</a>'))}function expToImg(){var a=$("#chatCon dl:last").find('.rec_t');var s,val=a.html();s=$.expBlock.textFormat(val);a.html(s)}var onceObj={};onceObj.triggerOnce=function(a){return function(){try{a.apply(this,arguments)}catch(e){}finally{a=null}}};JZIM.CPS_NAME=JZIM.CPS_NAME||'经传-客服中心';JZIM.GREETING=JZIM.GREETING||'您好，这里是经传软件全国客服在线服务中心，请问有什么能够帮到您？';var BOSH_SERVICE='http://im.jingzhuan.cn/im/proxy.php';var XMPP_SERVICE='http://im.jingzhuan.cn/xmpp-service/cpsImSelector/status';var XMPP_DOMAIN='im.jingzhuan.cn';var LOG_FLAG=false;var CPS_JID=null;var ANONYMOUS_NAME='我';var connection=null;var userID=$("#UserNick").attr("val");function log(a){if(LOG_FLAG){$('#log').append('<div></div>').append(document.createTextNode(a))}}function rawInput(a){log('RECV: '+a)}function rawOutput(a){log('SENT: '+a)}function onConnect(a){if(a==Strophe.Status.CONNECTING){log('Strophe is connecting.')}else if(a==Strophe.Status.CONNFAIL){log('Strophe failed to connect.');$('#connect').get(0).value='connect'}else if(a==Strophe.Status.DISCONNECTING){log('Strophe is disconnecting.')}else if(a==Strophe.Status.DISCONNECTED){log('Strophe is disconnected.');$('#connect').get(0).value='connect'}else if(a==Strophe.Status.CONNECTED){log('Strophe is connected.');openChat();connection.addHandler(onMessage,null,'message',null,null,null);connection.send($pres().tree())}}function onMessage(a){to=a.getAttribute('to');from=a.getAttribute('from');var b=MD5.hexdigest(from.split('/')[0]);var c=a.getAttribute('type');var d=a.getElementsByTagName('body');var e=null;var f=new Date();var g=f.toLocaleTimeString();if(document.getElementById("chatBox").style.display=="none"){document.getElementById("chatBox").style.display="block"}if(c=="chat"&&d.length>0){var h=d[0];e=Strophe.getText(h);log(new Date().toLocaleTimeString()+'  '+from+' say: '+e);var i=$("#"+b);if(i.length==0){openChat()}i=$("#"+b);e=urlToLnk(e);i.find("#chatCon").append("<dl class='rec_l'><dt>"+JZIM.CPS_NAME+"&nbsp;&nbsp;<span class='rec_d'>"+g+"</span></dt>"+"<dd class='rec_t'>"+e+"</dd></dl>")}expToImg();$("#chatRec").scrollTop(99999);return true}function setCookieVal(a,b,c){var d=new Date();d.setTime(d.getTime()+c*24*3600*1000);document.cookie=a+'='+b+'; expires='+d.toGMTString()}function getCookieVal(a){var b=document.cookie.split('; ');for(var i=0;i<b.length;i++){var c=b[i].split('=');if(a==c[0]){if(c.length>1){return unescape(c[1])}else{return 0}}}return 0}$(function(){var b=JZIM.cpsId||getCookieVal("VisitorCpsid");userID=isNaN(userID)?0:0;request=$.ajax({url:XMPP_SERVICE,type:"GET",cache:false,data:{cpsid:b,userid:userID},dataType:"jsonp",success:function(a){if(a.jid===undefined||a.online===false){return}connection=new Strophe.Connection(BOSH_SERVICE);connection.rawInput=rawInput;connection.rawOutput=rawOutput;connection.connect(XMPP_DOMAIN,null,onConnect);JZIM.imPeerJid=JZIM.imPeerJid||a.jid}})});function openChat(){var i=JZIM.imPeerJid;var j=MD5.hexdigest(i);var k=$("<div id='chat' class='msg_wrap chat'><div id='"+j+"' class='msg_cont exp-holder'><h4 class='msg_tit' id='chatTit'><a href='javascript:void(0)' target='_self' title='关闭窗口' class='close_btn' id='chatCls'>&times;</a><a id='maximize' class='maximize' href='javascript:;' target='_self' title='最大化'></a><a id='minimize' class='minimize' href='javascript:;' target='_self' title='最小化'></a><span id='chatTitTxt'>"+JZIM.CPS_NAME+"</span></h4><div id='chatAnn' class='ann'><p class='p1'>经过我们的努力，把知识与财富传递到你的手中</p></div><div id='chatRec' class='record'><div id='chatCon' class='rec_c'></div></div><div class='tool'><ul class='t_btn'><!--<li class='txt'><a class='txt_a' href='javascript:;' target='_self'></a></li>--><li class='exp'><a id='insertExpBtn2' class='exp_a exp-block-trigger' href='javascript:;' target='_self'></a></li><!--<li class='img'><a class='img_a' href='javascript:;' target='_self'></a></li><li class='scr'><a class='scr_a' href='javascript:;' target='_self'></a></li></ul>--></div><div class='area'><div id='chatInp' class='c_inp' name='chatInp' contenteditable='true'></div></div><div class='btm'><div class='sub'><input id='chatCls2' class='c_clo' type='button' title='关闭窗口' value='关闭' /><p class='c_sub'><input id='chatSub' class='c_s_btn' type='submit' title='按Enter键发送消息' value='发送' /><span class='c_s_help'><a class='c_s_h_a' href='javascript:;' target='_self'></a></span></p></div></div></div></div><div id='chatBtn' title='客服中心'><a class='sc_lnk' href='javascript:;' target='_self'><span class='sc_txt'>客服中心</span></a></div>");var l=k.find("#chatInp");var m=k.find("#chatSub");var n=k.find("#chatCon");var o=new Date();var p=o.toLocaleTimeString();function autSend(){var a=window.location.href;var b=$("title").html();var c=/^\s*|\s*$/g;var b=b.replace(c,"");var d=connection.sid+'@'+XMPP_DOMAIN;var e='来源地址：'+a+'\n'+'网页标题：'+b+'\r';var f=$msg({to:i,from:d,type:'chat'}).cnode(Strophe.xmlElement('body','',e));connection.send(f.tree())}var q=onceObj.triggerOnce(autSend);function chatSend(){var c=new Date();var d=c.toLocaleTimeString();var e=connection.sid+'@'+XMPP_DOMAIN;l.find("img").each(function(){var a=$(this).attr("data-name");var b=$(this).attr("data-val");$(this).replaceWith("&lt;BitMap Index='"+b+"'/&gt;"+a)});var f=l.text();var g="<Message id='inpValMsg' FontName='新宋体' FontSize='200' FontColr='0' FontBold='0'>"+f+"</Message>";f=f.replace(/\<br>/gi,"\r\n");f=f.replace(/\&nbsp;/gi," ");var h=$msg({to:i,from:e,type:'chat'}).cnode(Strophe.xmlElement('body','',g));connection.send(h.tree());inpVal2=urlToLnk(l.text());n.append("<dl class='rec_l'><dt class='own'>"+ANONYMOUS_NAME+"&nbsp;&nbsp;<span class='rec_d'>"+d+"</span></dt>"+"<dd class='rec_t'>"+inpVal2+"</dd></dl>");l.html("");expToImg();$("#chatRec").scrollTop(99999)}function chatCheck(){var a=l.text();var b=/^\s*|\s*$/g;a=a.replace(b,"");a=a.replace(/<br>/g,"");a=a.replace(/[ | ]*\n/g,"");a=a.replace(/&nbsp;/g,"");if(a.length||l.find("img").length>0){chatSend()}else{alert("发送内容不能为空，请重新输入");l.html("");return false}}$("#chatSub").live("click",function(){chatCheck()});var r=0;$('#chatInp').live('focus',function(){if(!r){q(1);r=1}});$("#chatInp").live("keyup",function(e){$(this).scrollTop(99999)});$("#chatInp").live("keydown",function(e){e=e||event;if(e.ctrlKey&&e.keyCode==13){$(this).html($(this).html()+"<br>&nbsp;");placeCaretAtEnd(document.getElementById('chatInp'));return}if(e.keyCode==13){e.preventDefault();chatCheck()}});n.append("<dl class='rec_l'><dt>"+JZIM.CPS_NAME+"&nbsp;&nbsp;<span class='rec_d'>"+p+"</span></dt>"+"<dd class='rec_t'>"+JZIM.GREETING+"</dd></dl>");$("body").append(k);if($("#chatBtn2").length<=0){$("#chatBtn").show()}if($("#chatBtn3").length>0){$("#chatBtn").show()}if($('#chatAuto').length){JZIM.chatPopUp();if(!$('#chatAuto').data('btn')){$("#chatBtn").hide()}}}var Base64=(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var f={encode:function(a){var b="";var c,chr2,chr3;var d,enc2,enc3,enc4;var i=0;do{c=a.charCodeAt(i++);chr2=a.charCodeAt(i++);chr3=a.charCodeAt(i++);d=c>>2;enc2=((c&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}b=b+e.charAt(d)+e.charAt(enc2)+e.charAt(enc3)+e.charAt(enc4)}while(i<a.length);return b},decode:function(a){var b="";var c,chr2,chr3;var d,enc2,enc3,enc4;var i=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{d=e.indexOf(a.charAt(i++));enc2=e.indexOf(a.charAt(i++));enc3=e.indexOf(a.charAt(i++));enc4=e.indexOf(a.charAt(i++));c=(d<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;b=b+String.fromCharCode(c);if(enc3!=64){b=b+String.fromCharCode(chr2)}if(enc4!=64){b=b+String.fromCharCode(chr3)}}while(i<a.length);return b}};return f})();var MD5=(function(){var g=0;var h="";var k=8;var l=function(x,y){var a=(x&0xFFFF)+(y&0xFFFF);var b=(x>>16)+(y>>16)+(a>>16);return(b<<16)|(a&0xFFFF)};var m=function(a,b){return(a<<b)|(a>>>(32-b))};var n=function(a){var b=[];var c=(1<<k)-1;for(var i=0;i<a.length*k;i+=k){b[i>>5]|=(a.charCodeAt(i/k)&c)<<(i%32)}return b};var o=function(a){var b="";var c=(1<<k)-1;for(var i=0;i<a.length*32;i+=k){b+=String.fromCharCode((a[i>>5]>>>(i%32))&c)}return b};var p=function(a){var b=g?"0123456789ABCDEF":"0123456789abcdef";var c="";for(var i=0;i<a.length*4;i++){c+=b.charAt((a[i>>2]>>((i%4)*8+4))&0xF)+b.charAt((a[i>>2]>>((i%4)*8))&0xF)}return c};var r=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c="";var d,j;for(var i=0;i<a.length*4;i+=3){d=(((a[i>>2]>>8*(i%4))&0xFF)<<16)|(((a[i+1>>2]>>8*((i+1)%4))&0xFF)<<8)|((a[i+2>>2]>>8*((i+2)%4))&0xFF);for(j=0;j<4;j++){if(i*8+j*6>a.length*32){c+=h}else{c+=b.charAt((d>>6*(3-j))&0x3F)}}}return c};var u=function(q,a,b,x,s,t){return l(m(l(l(a,q),l(x,t)),s),b)};var v=function(a,b,c,d,x,s,t){return u((b&c)|((~b)&d),a,b,x,s,t)};var w=function(a,b,c,d,x,s,t){return u((b&d)|(c&(~d)),a,b,x,s,t)};var z=function(a,b,c,d,x,s,t){return u(b^c^d,a,b,x,s,t)};var A=function(a,b,c,d,x,s,t){return u(c^(b|(~d)),a,b,x,s,t)};var B=function(x,e){x[e>>5]|=0x80<<((e)%32);x[(((e+64)>>>9)<<4)+14]=e;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var f,oldb,oldc,oldd;for(var i=0;i<x.length;i+=16){f=a;oldb=b;oldc=c;oldd=d;a=v(a,b,c,d,x[i+0],7,-680876936);d=v(d,a,b,c,x[i+1],12,-389564586);c=v(c,d,a,b,x[i+2],17,606105819);b=v(b,c,d,a,x[i+3],22,-1044525330);a=v(a,b,c,d,x[i+4],7,-176418897);d=v(d,a,b,c,x[i+5],12,1200080426);c=v(c,d,a,b,x[i+6],17,-1473231341);b=v(b,c,d,a,x[i+7],22,-45705983);a=v(a,b,c,d,x[i+8],7,1770035416);d=v(d,a,b,c,x[i+9],12,-1958414417);c=v(c,d,a,b,x[i+10],17,-42063);b=v(b,c,d,a,x[i+11],22,-1990404162);a=v(a,b,c,d,x[i+12],7,1804603682);d=v(d,a,b,c,x[i+13],12,-40341101);c=v(c,d,a,b,x[i+14],17,-1502002290);b=v(b,c,d,a,x[i+15],22,1236535329);a=w(a,b,c,d,x[i+1],5,-165796510);d=w(d,a,b,c,x[i+6],9,-1069501632);c=w(c,d,a,b,x[i+11],14,643717713);b=w(b,c,d,a,x[i+0],20,-373897302);a=w(a,b,c,d,x[i+5],5,-701558691);d=w(d,a,b,c,x[i+10],9,38016083);c=w(c,d,a,b,x[i+15],14,-660478335);b=w(b,c,d,a,x[i+4],20,-405537848);a=w(a,b,c,d,x[i+9],5,568446438);d=w(d,a,b,c,x[i+14],9,-1019803690);c=w(c,d,a,b,x[i+3],14,-187363961);b=w(b,c,d,a,x[i+8],20,1163531501);a=w(a,b,c,d,x[i+13],5,-1444681467);d=w(d,a,b,c,x[i+2],9,-51403784);c=w(c,d,a,b,x[i+7],14,1735328473);b=w(b,c,d,a,x[i+12],20,-1926607734);a=z(a,b,c,d,x[i+5],4,-378558);d=z(d,a,b,c,x[i+8],11,-2022574463);c=z(c,d,a,b,x[i+11],16,1839030562);b=z(b,c,d,a,x[i+14],23,-35309556);a=z(a,b,c,d,x[i+1],4,-1530992060);d=z(d,a,b,c,x[i+4],11,1272893353);c=z(c,d,a,b,x[i+7],16,-155497632);b=z(b,c,d,a,x[i+10],23,-1094730640);a=z(a,b,c,d,x[i+13],4,681279174);d=z(d,a,b,c,x[i+0],11,-358537222);c=z(c,d,a,b,x[i+3],16,-722521979);b=z(b,c,d,a,x[i+6],23,76029189);a=z(a,b,c,d,x[i+9],4,-640364487);d=z(d,a,b,c,x[i+12],11,-421815835);c=z(c,d,a,b,x[i+15],16,530742520);b=z(b,c,d,a,x[i+2],23,-995338651);a=A(a,b,c,d,x[i+0],6,-198630844);d=A(d,a,b,c,x[i+7],10,1126891415);c=A(c,d,a,b,x[i+14],15,-1416354905);b=A(b,c,d,a,x[i+5],21,-57434055);a=A(a,b,c,d,x[i+12],6,1700485571);d=A(d,a,b,c,x[i+3],10,-1894986606);c=A(c,d,a,b,x[i+10],15,-1051523);b=A(b,c,d,a,x[i+1],21,-2054922799);a=A(a,b,c,d,x[i+8],6,1873313359);d=A(d,a,b,c,x[i+15],10,-30611744);c=A(c,d,a,b,x[i+6],15,-1560198380);b=A(b,c,d,a,x[i+13],21,1309151649);a=A(a,b,c,d,x[i+4],6,-145523070);d=A(d,a,b,c,x[i+11],10,-1120210379);c=A(c,d,a,b,x[i+2],15,718787259);b=A(b,c,d,a,x[i+9],21,-343485551);a=l(a,f);b=l(b,oldb);c=l(c,oldc);d=l(d,oldd)}return[a,b,c,d]};var C=function(a,b){var c=n(a);if(c.length>16){c=B(c,a.length*k)}var d=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){d[i]=c[i]^0x36363636;opad[i]=c[i]^0x5C5C5C5C}var e=B(d.concat(n(b)),512+b.length*k);return B(opad.concat(e),512+128)};var D={hexdigest:function(s){return p(B(n(s),s.length*k))},b64digest:function(s){return r(B(n(s),s.length*k))},hash:function(s){return o(B(n(s),s.length*k))},hmac_hexdigest:function(a,b){return p(C(a,b))},hmac_b64digest:function(a,b){return r(C(a,b))},hmac_hash:function(a,b){return o(C(a,b))},test:function(){return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72"}};return D})();if(!Function.prototype.bind){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}}}if(!Function.prototype.prependArg){Function.prototype.prependArg=function(b){var c=this;return function(){var a=[b];for(var i=0;i<arguments.length;i++){a.push(arguments[i])}return c.apply(this,a)}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(a){var b=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=b}for(;c<b;c++){if(c in this&&this[c]===a){return c}}return-1}}(function(n){var o;function $build(a,b){return new o.Builder(a,b)}function $msg(a){return new o.Builder("message",a)}function $iq(a){return new o.Builder("iq",a)}function $pres(a){return new o.Builder("presence",a)}o={VERSION:"1.0.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(a,b){o.NS[a]=b},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(a,b,c){var i,childNode;for(i=0;i<a.childNodes.length;i++){childNode=a.childNodes[i];if(childNode.nodeType==o.ElementType.NORMAL&&(!b||this.isTagEqual(childNode,b))){c(childNode)}}},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var a;if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.appendChild(a.createElement('strophe'))}else{a=document.implementation.createDocument('jabber:client','strophe',null)}return a},xmlElement:function(b){if(!b){return null}var c=null;if(!o._xmlGenerator){o._xmlGenerator=o._makeGenerator()}c=o._xmlGenerator.createElement(b);var a,i,k;for(a=1;a<arguments.length;a++){if(!arguments[a]){continue}if(typeof(arguments[a])=="string"||typeof(arguments[a])=="number"){c.appendChild(o.xmlTextNode(arguments[a]))}else if(typeof(arguments[a])=="object"&&typeof(arguments[a].sort)=="function"){for(i=0;i<arguments[a].length;i++){if(typeof(arguments[a][i])=="object"&&typeof(arguments[a][i].sort)=="function"){c.setAttribute(arguments[a][i][0],arguments[a][i][1])}}}else if(typeof(arguments[a])=="object"){for(k in arguments[a]){if(arguments[a].hasOwnProperty(k)){c.setAttribute(k,arguments[a][k])}}}}return c},xmlescape:function(a){a=a.replace(/\&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a},xmlTextNode:function(a){a=o.xmlescape(a);if(!o._xmlGenerator){o._xmlGenerator=o._makeGenerator()}return o._xmlGenerator.createTextNode(a)},getText:function(a){if(!a){return null}var b="";if(a.childNodes.length===0&&a.nodeType==o.ElementType.TEXT){b+=a.nodeValue}for(var i=0;i<a.childNodes.length;i++){if(a.childNodes[i].nodeType==o.ElementType.TEXT){b+=a.childNodes[i].nodeValue}}return b},copyElement:function(a){var i,el;if(a.nodeType==o.ElementType.NORMAL){el=o.xmlElement(a.tagName);for(i=0;i<a.attributes.length;i++){el.setAttribute(a.attributes[i].nodeName.toLowerCase(),a.attributes[i].value)}for(i=0;i<a.childNodes.length;i++){el.appendChild(o.copyElement(a.childNodes[i]))}}else if(a.nodeType==o.ElementType.TEXT){el=o.xmlTextNode(a.nodeValue)}return el},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,'').replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){if(a.indexOf("@")<0){return null}return a.split("@")[0]},getDomainFromJid:function(a){var b=o.getBareJidFromJid(a);if(b.indexOf("@")<0){return b}else{var c=b.split("@");c.splice(0,1);return c.join('@')}},getResourceFromJid:function(a){var s=a.split("/");if(s.length<2){return null}s.splice(0,1);return s.join('/')},getBareJidFromJid:function(a){return a.split("/")[0]},log:function(a,b){return},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a){return null}if(typeof(a.tree)==="function"){a=a.tree()}var c=a.nodeName;var i,child;if(a.getAttribute("_realname")){c=a.getAttribute("_realname")}b="<"+c;for(i=0;i<a.attributes.length;i++){if(a.attributes[i].nodeName!="_realname"){b+=" "+a.attributes[i].nodeName.toLowerCase()+"='"+a.attributes[i].value.replace("&","&amp;").replace("'","&apos;").replace("<","&lt;")+"'"}}if(a.childNodes.length>0){b+=">";for(i=0;i<a.childNodes.length;i++){child=a.childNodes[i];if(child.nodeType==o.ElementType.NORMAL){b+=o.serialize(child)}else if(child.nodeType==o.ElementType.TEXT){b+=child.nodeValue}}b+="</"+c+">"}else{b+="/>"}return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){o._connectionPlugins[a]=b}};o.Builder=function(a,b){if(a=="presence"||a=="message"||a=="iq"){if(b&&!b.xmlns){b.xmlns=o.NS.CLIENT}else if(!b){b={xmlns:o.NS.CLIENT}}}this.nodeTree=o.xmlElement(a,b);this.node=this.nodeTree};o.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return o.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(a){for(var k in a){if(a.hasOwnProperty(k)){this.node.setAttribute(k,a[k])}}return this},c:function(a,b){var c=o.xmlElement(a,b);this.node.appendChild(c);this.node=c;return this},cnode:function(a){this.node.appendChild(a);this.node=a;return this},t:function(a){var b=o.xmlTextNode(a);this.node.appendChild(b);return this}};o.Handler=function(a,b,c,d,e,f,g){this.handler=a;this.ns=b;this.name=c;this.type=d;this.id=e;this.options=g||{matchbare:false};if(!this.options.matchBare){this.options.matchBare=false}if(this.options.matchBare){this.from=o.getBareJidFromJid(f)}else{this.from=f}this.user=true};o.Handler.prototype={isMatch:function(b){var c;var d=null;if(this.options.matchBare){d=o.getBareJidFromJid(b.getAttribute('from'))}else{d=b.getAttribute('from')}c=false;if(!this.ns){c=true}else{var e=this;o.forEachChild(b,null,function(a){if(a.getAttribute("xmlns")==e.ns){c=true}});c=c||b.getAttribute("xmlns")==this.ns}if(c&&(!this.name||o.isTagEqual(b,this.name))&&(!this.type||b.getAttribute("type")===this.type)&&(!this.id||b.getAttribute("id")===this.id)&&(!this.from||d===this.from)){return true}return false},run:function(a){var b=null;try{b=this.handler(a)}catch(e){if(e.sourceURL){o.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message)}else if(e.fileName){if(typeof(console)!="undefined"){console.trace();console.error(this.handler," - error - ",e,e.message)}o.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message)}else{o.fatal("error: "+this.handler)}throw e}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};o.TimedHandler=function(a,b){this.period=a;this.handler=b;this.lastCalled=new Date().getTime();this.user=true};o.TimedHandler.prototype={run:function(){this.lastCalled=new Date().getTime();return this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};o.Request=function(b,c,d,e){this.id=++o._requestId;this.xmlData=b;this.data=o.serialize(b);this.origFunc=c;this.func=c;this.rid=d;this.date=NaN;this.sends=e||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date){return 0}var a=new Date();return(a-this.date)/1000};this.timeDead=function(){if(!this.dead){return 0}var a=new Date();return(a-this.dead)/1000};this.xhr=this._newXHR()};o.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){a=this.xhr.responseXML.documentElement;if(a.tagName=="parsererror"){o.error("invalid response received");o.error("responseText: "+this.xhr.responseText);o.error("responseXML: "+o.serialize(this.xhr.responseXML));throw"parsererror"}}else if(this.xhr.responseText){o.error("invalid response received");o.error("responseText: "+this.xhr.responseText);o.error("responseXML: "+o.serialize(this.xhr.responseXML))}return a},_newXHR:function(){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest();if(a.overrideMimeType){a.overrideMimeType("text/xml")}}else if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}a.onreadystatechange=this.func.prependArg(this);return a}};o.Connection=function(a){this.service=a;this.jid="";this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._idleTimeout=null;this._disconnectTimeout=null;this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this.paused=false;this.hold=1;this.wait=1800;this.window=5;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*10000);this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var k in o._connectionPlugins){if(o._connectionPlugins.hasOwnProperty(k)){var b=o._connectionPlugins[k];var F=function(){};F.prototype=b;this[k]=new F();this[k].init(this)}}};o.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*10000)},pause:function(){this.paused=true},resume:function(){this.paused=false},getUniqueId:function(a){if(typeof(a)=="string"||typeof(a)=="number"){return++this._uniqueId+":"+a}else{return++this._uniqueId+""}},connect:function(a,b,c,d,e){this.jid=a;this.pass=b;this.connect_callback=c;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.wait=d||this.wait;this.hold=e||this.hold;this.domain=o.getDomainFromJid(this.jid);var f=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":o.NS.BOSH});this._changeConnectStatus(o.Status.CONNECTING,null);this._requests.push(new o.Request(f.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),f.tree().getAttribute("rid")));this._throttledRequestHandler()},attach:function(a,b,c,d,e,f,g){this.jid=a;this.sid=b;this.rid=c;this.connect_callback=d;this.domain=o.getDomainFromJid(this.jid);this.authenticated=true;this.connected=true;this.wait=e||this.wait;this.hold=f||this.hold;this.window=g||this.window;this._changeConnectStatus(o.Status.ATTACHED,null)},xmlInput:function(a){return},xmlOutput:function(a){return},rawInput:function(a){return},rawOutput:function(a){return},send:function(a){if(a===null){return}if(typeof(a.sort)==="function"){for(var i=0;i<a.length;i++){this._queueData(a[i])}}else if(typeof(a.tree)==="function"){this._queueData(a.tree())}else{this._queueData(a)}this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(c,d,e,f){var g=null;var h=this;if(typeof(c.tree)==="function"){c=c.tree()}var i=c.getAttribute('id');if(!i){i=this.getUniqueId("sendIQ");c.setAttribute("id",i)}var j=this.addHandler(function(a){if(g){h.deleteTimedHandler(g)}var b=a.getAttribute('type');if(b==='result'){if(d){d(a)}}else if(b==='error'){if(e){e(a)}}else{throw{name:"StropheError",message:"Got bad IQ type of "+b}}},null,'iq',null,i);if(f){g=this.addTimedHandler(f,function(){h.deleteHandler(j);if(e){e(null)}return false})}this.send(c);return i},_queueData:function(a){if(a===null||!a.tagName||!a.childNodes){throw{name:"StropheError",message:"Cannot queue non-DOMElement."}}this._data.push(a)},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new o.TimedHandler(a,b);this.addTimeds.push(c);return c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,f,g){var h=new o.Handler(a,b,c,d,e,f,g);this.addHandlers.push(h);return h},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){this._changeConnectStatus(o.Status.DISCONNECTING,a);o.info("Disconnect was called because: "+a);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3000,this._onDisconnectTimeout.bind(this));this._sendTerminate()}},_changeConnectStatus:function(a,b){for(var k in o._connectionPlugins){if(o._connectionPlugins.hasOwnProperty(k)){var c=this[k];if(c.statusChanged){try{c.statusChanged(a,b)}catch(err){o.error(""+k+" plugin caused an exception "+"changing status: "+err)}}}}if(this.connect_callback){try{this.connect_callback(a,b)}catch(e){o.error("User connection callback caused an "+"exception: "+e)}}},_buildBody:function(){var a=$build('body',{rid:this.rid++,xmlns:o.NS.HTTPBIND});if(this.sid!==null){a.attrs({sid:this.sid})}return a},_removeRequest:function(a){o.debug("removing request");var i;for(i=this._requests.length-1;i>=0;i--){if(a==this._requests[i]){this._requests.splice(i,1)}}a.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(i){var a=this._requests[i];if(a.dead===null){a.dead=new Date()}this._processRequest(i)},_processRequest:function(i){var a=this._requests[i];var b=-1;try{if(a.xhr.readyState==4){b=a.xhr.status}}catch(e){o.error("caught an error in _requests["+i+"], reqStatus: "+b)}if(typeof(b)=="undefined"){b=-1}var c=a.age();var d=(!isNaN(c)&&c>Math.floor(o.TIMEOUT*this.wait));var f=(a.dead!==null&&a.timeDead()>Math.floor(o.SECONDARY_TIMEOUT*this.wait));var g=(a.xhr.readyState==4&&(b<1||b>=500));if(d||f||g){if(f){o.error("Request "+this._requests[i].id+" timed out (secondary), restarting")}a.abort=true;a.xhr.abort();a.xhr.onreadystatechange=function(){};this._requests[i]=new o.Request(a.xmlData,a.origFunc,a.rid,a.sends);a=this._requests[i]}if(a.xhr.readyState===0){o.debug("request id "+a.id+"."+a.sends+" posting");a.date=new Date();try{a.xhr.open("POST",this.service,true)}catch(e2){o.error("XHR open failed.");if(!this.connected){this._changeConnectStatus(o.Status.CONNFAIL,"bad-service")}this.disconnect();return}var h=function(){a.xhr.send(a.data)};if(a.sends>1){var j=Math.pow(a.sends,3)*1000;setTimeout(h,j)}else{h()}a.sends++;this.xmlOutput(a.xmlData);this.rawOutput(a.data)}else{o.debug("_processRequest: "+(i===0?"first":"second")+" request has readyState of "+a.xhr.readyState)}},_throttledRequestHandler:function(){if(!this._requests){o.debug("_throttledRequestHandler called with "+"undefined requests")}else{o.debug("_throttledRequestHandler called with "+this._requests.length+" requests")}if(!this._requests||this._requests.length===0){return}if(this._requests.length>0){this._processRequest(0)}if(this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window-1){this._processRequest(1)}},_onRequestStateChange:function(a,b){o.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState);if(b.abort){b.abort=false;return}var c;if(b.xhr.readyState==4){c=0;try{c=b.xhr.status}catch(e){}if(typeof(c)=="undefined"){c=0}if(this.disconnecting){if(c>=400){this._hitError(c);return}}var d=(this._requests[0]==b);var f=(this._requests[1]==b);if((c>0&&c<500)||b.sends>5){this._removeRequest(b);o.debug("request id "+b.id+" should now be removed")}if(c==200){if(f||(d&&this._requests.length>0&&this._requests[0].age()>Math.floor(o.SECONDARY_TIMEOUT*this.wait))){this._restartRequest(0)}o.debug("request id "+b.id+"."+b.sends+" got 200");a(b);this.errors=0}else{o.error("request id "+b.id+"."+b.sends+" error "+c+" happened");if(c===0||(c>=400&&c<600)||c>=12000){this._hitError(c);if(c>=400&&c<500){this._changeConnectStatus(o.Status.DISCONNECTING,null);this._doDisconnect()}}}if(!((c>0&&c<10000)||b.sends>5)){this._throttledRequestHandler()}}},_hitError:function(a){this.errors++;o.warn("request errored, status: "+a+", number of errors: "+this.errors);if(this.errors>4){this._onDisconnectTimeout()}},_doDisconnect:function(){o.info("_doDisconnect was called");this.authenticated=false;this.disconnecting=false;this.sid=null;this.streamId=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(o.Status.DISCONNECTED,null);this.connected=false}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[]},_dataRecv:function(c){try{var d=c.getResponse()}catch(e){if(e!="parsererror"){throw e}this.disconnect("strophe-parsererror")}if(d===null){return}this.xmlInput(d);this.rawInput(o.serialize(d));var i,hand;while(this.removeHandlers.length>0){hand=this.removeHandlers.pop();i=this.handlers.indexOf(hand);if(i>=0){this.handlers.splice(i,1)}}while(this.addHandlers.length>0){this.handlers.push(this.addHandlers.pop())}if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect();return}var f=d.getAttribute("type");var g,conflict;if(f!==null&&f=="terminate"){g=d.getAttribute("condition");conflict=d.getElementsByTagName("conflict");if(g!==null){if(g=="remote-stream-error"&&conflict.length>0){g="conflict"}this._changeConnectStatus(o.Status.CONNFAIL,g)}else{this._changeConnectStatus(o.Status.CONNFAIL,"unknown")}this.disconnect();return}var h=this;o.forEachChild(d,null,function(a){var i,newList;newList=h.handlers;h.handlers=[];for(i=0;i<newList.length;i++){var b=newList[i];if(b.isMatch(a)&&(h.authenticated||!b.user)){if(b.run(a)){h.handlers.push(b)}}else{h.handlers.push(b)}}})},_sendTerminate:function(){o.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});if(this.authenticated){a.c('presence',{xmlns:o.NS.CLIENT,type:'unavailable'})}this.disconnecting=true;var b=new o.Request(a.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),a.tree().getAttribute("rid"));this._requests.push(b);this._throttledRequestHandler()},_connect_cb:function(a){o.info("_connect_cb was called");this.connected=true;var b=a.getResponse();if(!b){return}this.xmlInput(b);this.rawInput(o.serialize(b));var c=b.getAttribute("type");var d,conflict;if(c!==null&&c=="terminate"){d=b.getAttribute("condition");conflict=b.getElementsByTagName("conflict");if(d!==null){if(d=="remote-stream-error"&&conflict.length>0){d="conflict"}this._changeConnectStatus(o.Status.CONNFAIL,d)}else{this._changeConnectStatus(o.Status.CONNFAIL,"unknown")}return}if(!this.sid){this.sid=b.getAttribute("sid")}if(!this.stream_id){this.stream_id=b.getAttribute("authid")}var e=b.getAttribute('requests');if(e){this.window=parseInt(e,10)}var f=b.getAttribute('hold');if(f){this.hold=parseInt(f,10)}var g=b.getAttribute('wait');if(g){this.wait=parseInt(g,10)}var h=false;var j=false;var k=false;var l=b.getElementsByTagName("mechanism");var i,mech,auth_str,hashed_auth_str;if(l.length>0){for(i=0;i<l.length;i++){mech=o.getText(l[i]);if(mech=='DIGEST-MD5'){j=true}else if(mech=='PLAIN'){h=true}else if(mech=='ANONYMOUS'){k=true}}}else{var m=this._buildBody();this._requests.push(new o.Request(m.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),m.tree().getAttribute("rid")));this._throttledRequestHandler();return}if(o.getNodeFromJid(this.jid)===null&&k){this._changeConnectStatus(o.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:o.NS.SASL,mechanism:"ANONYMOUS"}).tree())}else if(o.getNodeFromJid(this.jid)===null){this._changeConnectStatus(o.Status.CONNFAIL,'x-strophe-bad-non-anon-jid');this.disconnect()}else if(j){this._changeConnectStatus(o.Status.AUTHENTICATING,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:o.NS.SASL,mechanism:"DIGEST-MD5"}).tree())}else if(h){auth_str=o.getBareJidFromJid(this.jid);auth_str=auth_str+"\u0000";auth_str=auth_str+o.getNodeFromJid(this.jid);auth_str=auth_str+"\u0000";auth_str=auth_str+this.pass;this._changeConnectStatus(o.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);hashed_auth_str=Base64.encode(auth_str);this.send($build("auth",{xmlns:o.NS.SASL,mechanism:"PLAIN"}).t(hashed_auth_str).tree())}else{this._changeConnectStatus(o.Status.AUTHENTICATING,null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send($iq({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:o.NS.AUTH}).c("username",{}).t(o.getNodeFromJid(this.jid)).tree())}},_sasl_challenge1_cb:function(a){var b=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;var c=Base64.decode(o.getText(a));var d=MD5.hexdigest(Math.random()*1234567890);var e="";var f=null;var g="";var h="";var i;this.deleteHandler(this._sasl_failure_handler);while(c.match(b)){i=c.match(b);c=c.replace(i[0],"");i[2]=i[2].replace(/^"(.+)"$/,"$1");switch(i[1]){case"realm":e=i[2];break;case"nonce":g=i[2];break;case"qop":h=i[2];break;case"host":f=i[2];break}}var j="xmpp/"+this.domain;if(f!==null){j=j+"/"+f}var k=MD5.hash(o.getNodeFromJid(this.jid)+":"+e+":"+this.pass)+":"+g+":"+d;var l='AUTHENTICATE:'+j;var m="";m+='username='+this._quote(o.getNodeFromJid(this.jid))+',';m+='realm='+this._quote(e)+',';m+='nonce='+this._quote(g)+',';m+='cnonce='+this._quote(d)+',';m+='nc="00000001",';m+='qop="auth",';m+='digest-uri='+this._quote(j)+',';m+='response='+this._quote(MD5.hexdigest(MD5.hexdigest(k)+":"+g+":00000001:"+d+":auth:"+MD5.hexdigest(l)))+',';m+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build('response',{xmlns:o.NS.SASL}).t(Base64.encode(m)).tree());return false},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(a){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build('response',{xmlns:o.NS.SASL}).tree());return false},_auth1_cb:function(a){var b=$iq({type:"set",id:"_auth_2"}).c('query',{xmlns:o.NS.AUTH}).c('username',{}).t(o.getNodeFromJid(this.jid)).up().c('password').t(this.pass);if(!o.getResourceFromJid(this.jid)){this.jid=o.getBareJidFromJid(this.jid)+'/strophe'}b.up().c('resource',{}).t(o.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(b.tree());return false},_sasl_success_cb:function(a){o.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this._sendRestart();return false},_sasl_auth1_cb:function(a){var i,child;for(i=0;i<a.childNodes.length;i++){child=a.childNodes[i];if(child.nodeName=='bind'){this.do_bind=true}if(child.nodeName=='session'){this.do_session=true}}if(!this.do_bind){this._changeConnectStatus(o.Status.AUTHFAIL,null);return false}else{this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var b=o.getResourceFromJid(this.jid);if(b){this.send($iq({type:"set",id:"_bind_auth_2"}).c('bind',{xmlns:o.NS.BIND}).c('resource',{}).t(b).tree())}else{this.send($iq({type:"set",id:"_bind_auth_2"}).c('bind',{xmlns:o.NS.BIND}).tree())}}return false},_sasl_bind_cb:function(a){if(a.getAttribute("type")=="error"){o.info("SASL binding failed.");this._changeConnectStatus(o.Status.AUTHFAIL,null);return false}var b=a.getElementsByTagName("bind");var c;if(b.length>0){c=b[0].getElementsByTagName("jid");if(c.length>0){this.jid=o.getText(c[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send($iq({type:"set",id:"_session_auth_2"}).c('session',{xmlns:o.NS.SESSION}).tree())}else{this.authenticated=true;this._changeConnectStatus(o.Status.CONNECTED,null)}}}else{o.info("SASL binding failed.");this._changeConnectStatus(o.Status.AUTHFAIL,null);return false}},_sasl_session_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(o.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){o.info("Session creation failed.");this._changeConnectStatus(o.Status.AUTHFAIL,null);return false}return false},_sasl_failure_cb:function(a){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._changeConnectStatus(o.Status.AUTHFAIL,null);return false},_auth2_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(o.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){this._changeConnectStatus(o.Status.AUTHFAIL,null);this.disconnect()}return false},_addSysTimedHandler:function(a,b){var c=new o.TimedHandler(a,b);c.user=false;this.addTimeds.push(c);return c},_addSysHandler:function(a,b,c,d,e){var f=new o.Handler(a,b,c,d,e);f.user=false;this.addHandlers.push(f);return f},_onDisconnectTimeout:function(){o.info("_onDisconnectTimeout was called");var a;while(this._requests.length>0){a=this._requests.pop();a.abort=true;a.xhr.abort();a.xhr.onreadystatechange=function(){}}this._doDisconnect();return false},_onIdle:function(){var i,thand,since,newList;while(this.removeTimeds.length>0){thand=this.removeTimeds.pop();i=this.timedHandlers.indexOf(thand);if(i>=0){this.timedHandlers.splice(i,1)}}while(this.addTimeds.length>0){this.timedHandlers.push(this.addTimeds.pop())}var a=new Date().getTime();newList=[];for(i=0;i<this.timedHandlers.length;i++){thand=this.timedHandlers[i];if(this.authenticated||!thand.user){since=thand.lastCalled+thand.period;if(since-a<=0){if(thand.run()){newList.push(thand)}}else{newList.push(thand)}}}this.timedHandlers=newList;var b,time_elapsed;if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){o.info("no requests during idle cycle, sending "+"blank request");this._data.push(null)}if(this._requests.length<2&&this._data.length>0&&!this.paused){b=this._buildBody();for(i=0;i<this._data.length;i++){if(this._data[i]!==null){if(this._data[i]==="restart"){b.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":o.NS.BOSH})}else{b.cnode(this._data[i]).up()}}}delete this._data;this._data=[];this._requests.push(new o.Request(b.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),b.tree().getAttribute("rid")));this._processRequest(this._requests.length-1)}if(this._requests.length>0){time_elapsed=this._requests[0].age();if(this._requests[0].dead!==null){if(this._requests[0].timeDead()>Math.floor(o.SECONDARY_TIMEOUT*this.wait)){this._throttledRequestHandler()}}if(time_elapsed>Math.floor(o.TIMEOUT*this.wait)){o.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(o.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler()}}clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}};if(n){n(o,$build,$msg,$iq,$pres)}})(function(){window.Strophe=arguments[0];window.$build=arguments[1];window.$msg=arguments[2];window.$iq=arguments[3];window.$pres=arguments[4]});(function(f){var g=f.setTimeout,doc=f.document,callback_counter=0;f.jXHR=function(){var e,script_loaded,jsonp_callback,scriptElem,publicAPI=null;function removeScript(){try{scriptElem.parentNode.removeChild(scriptElem)}catch(err){}}function reset(){script_loaded=false;e="";removeScript();scriptElem=null;fireReadyStateChange(0)}function ThrowError(a){try{publicAPI.onerror.call(publicAPI,a,e)}catch(err){}}function handleScriptLoad(){if((this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded")||script_loaded){return}this.onload=this.onreadystatechange=null;script_loaded=true;if(publicAPI.readyState!==4)ThrowError("handleScriptLoad: Script failed to load ["+e+"].");removeScript()}function parseXMLString(a){var b=null;if(window.DOMParser){var c=new DOMParser();b=c.parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a)}return b}function fireReadyStateChange(a,b){b=b||[];publicAPI.readyState=a;if(a==4){publicAPI.responseText=b[0].reply;publicAPI.responseXML=parseXMLString(b[0].reply)}if(typeof publicAPI.onreadystatechange==="function")publicAPI.onreadystatechange.apply(publicAPI,b)}publicAPI={onerror:null,onreadystatechange:null,readyState:0,status:200,responseBody:null,responseText:null,responseXML:null,open:function(b,c){reset();var d="cb"+(callback_counter++);(function(a){f.jXHR[a]=function(){try{fireReadyStateChange.call(publicAPI,4,arguments)}catch(err){publicAPI.readyState=-1;ThrowError("Script failed to run ["+e+"].")}f.jXHR[a]=null}})(d);e=c+'?callback=?jXHR&data=';e=e.replace(/=\?jXHR/,"=jXHR."+d);fireReadyStateChange(1)},send:function(a){e=e+encodeURIComponent(a);g(function(){scriptElem=doc.createElement("script");scriptElem.setAttribute("type","text/javascript");scriptElem.onload=scriptElem.onreadystatechange=function(){handleScriptLoad.call(scriptElem)};scriptElem.setAttribute("src",e);doc.getElementsByTagName("head")[0].appendChild(scriptElem)},0);fireReadyStateChange(2)},abort:function(){},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}};reset();return publicAPI}})(window);Strophe.addConnectionPlugin('jxhr',{init:function(s){if(jXHR){Strophe.Request.prototype._newXHR=function(){var a=new jXHR();a.onreadystatechange=this.func.prependArg(this);return a}}else{Strophe.error("jXHR plugin loaded, but jXHR not found."+"  Falling back to native XHR implementation.")}}});$(function(){if($("#chatBtn4").length>0){var a=getCookieVal("popUpNo");if(a<1){var b=60000;setTimeout(function(){JZIM.chatPopUp()},b);setCookieVal("popUpNo",1,1)}}$("#chatBtn").live("click",function(){JZIM.chatPopUp()});$("#chatBtn2").live("click",function(){JZIM.chatPopUp()});$("#chatBtn3").live("click",function(){JZIM.chatPopUp()});$("#chatBtn4").live("click",function(){JZIM.chatPopUp()})});