define("common/jzim/3.0.0/jzim", ["$"], function(require, exports, module) {
	var $ = require('$');

	var JZIM=window.JZIM||{};var ua=(window.navigator.userAgent||"").toLowerCase(),isIE=/\msie [678]\.0\b/.test(ua),isIE6=ua.indexOf("msie 6")!==-1,isIE7=ua.indexOf("msie 7")!==-1,isIE8=ua.indexOf("msie 8")!==-1;(function(c,g){var f=c.document,e=f.documentElement,a=function(){var k=f.body,z=isIE,i=isIE6,j=1,y="cache"+(+new Date+"").slice(-8),o={},p=function(){};p.prototype={getOptions:function(m){var l,q={},n={container:null,overlay:!0,drag:!0,fixed:!0,follow:null,followX:0,followY:0,autoClose:0,lock:!1,callback:null};for(l in n){q[l]=m[l]!==g?m[l]:n[l]}p.data("options",q);return q},setBodyBg:function(){if(k.currentStyle.backgroundAttachment!=="fixed"){k.style.backgroundImage="url(about:blank)",k.style.backgroundAttachment="fixed"}},appendIframe:function(l){l.innerHTML='<iframe style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:-1;border:0 none;filter:alpha(opacity=0)"></iframe>'},setFollow:function(m,l,q,n){l=typeof l==="string"?f.getElementById(l):l;m=m.style;m.position="absolute";m.left=p.getOffset(l,"left")+q+"px";m.top=p.getOffset(l,"top")+n+"px"},setPosition:function(m,l){var n=m.style;n.position=i?"absolute":l?"fixed":"absolute";if(!isIE8){l?(i?n.setExpression("top",'fuckIE6=document.documentElement.scrollTop+document.documentElement.clientHeight/2+"px"'):n.top="50%",n.left="50%"):(i&&n.removeExpression("top"),n.top=e.clientHeight/2+p.getScroll("top")+"px",n.left=e.clientWidth/2+p.getScroll("left")+"px")}else{n.top=e.clientHeight/2+p.getScroll("top")+"px";n.left=e.clientWidth/2+p.getScroll("left")+"px"}},createOverlay:function(){var m=f.createElement("div"),l=m.style;l.cssText="margin:0;padding:0;border:none;width:100%;height:100%;background:#333;opacity:0.6;filter:alpha(opacity=60);z-index:9999;position:fixed;top:0;left:0;";if(i){k.style.height="100%",l.position="absolute",l.setExpression("top",'fuckIE6=document.documentElement.scrollTop+"px"')}m.id="overlay";return m},createDialogBox:function(){var l=f.createElement("div");l.style.cssText="margin:0;padding:0;border:none;z-index:999;";l.id="chatBox";return l},createDialogWrap:function(m){var l=typeof m.yesFn==="function"?'<button class="chat_yes_btn" id="chatYesBtn">'+(typeof m.yesText==="string"?m.yesText:"\u786e\u5b9a")+"</button>":"",n=typeof m.noFn==="function"||m.noFn===!0?'<button class="chat_no_btn" id="chatNoBtn">'+(typeof m.noText==="string"?m.noText:"\u53d6\u6d88")+"</button>":"",m=['<div class="chat_cont">',m.header?'<h4 class="chat_tit" id="chatTit"><a href="javascript:void(0)" title="\u5173\u95ed\u7a97\u53e3" class="close_btn" id="chatCls">&times;</a>'+m.header+"</h4>":"",'<div class="chat_txt">'+m.content+"</div>",l===""&&n===""?"":'<div class="chat_footer">'+n+l+"</div>","</div>"].join(""),l=f.getElementById("sendMsg");if(!l){l=f.createElement("div"),l.id="sendMsg",l.className="chat_wrap"}l.innerHTML=m.replace(/<[\/]*script[\s\S]*?>/ig,"");return l}};p.data=function(m,l,n){if(typeof m==="string"){return l!==g&&(o[m]=l),o[m]}else{if(typeof m==="object"){return m=m===c?0:m.nodeType===9?1:m[y]?m[y]:m[y]=++j,m=o[m]?o[m]:o[m]={},n!==g&&(m[l]=n),m[l]}}};p.removeData=function(m,l){if(typeof m==="string"){delete o[m]}else{if(typeof m==="object"){var r=m===c?0:m.nodeType===9?1:m[y];if(r!==g){var q=function(t){for(var s in t){return !1}return !0},n=function(){delete o[r];if(!(r<=1)){try{delete m[y]}catch(s){m.removeAttribute(y)}}};l?(delete o[r][l],q(o[r])&&n()):n()}}}};p.event={bind:function(m,l,q){var n=p.data(m,"e"+l)||p.data(m,"e"+l,[]);n.push(q);n.length===1&&(q=this.eventHandler(m),p.data(m,l+"Handler",q),m.addEventListener?m.addEventListener(l,q,!1):m.attachEvent&&m.attachEvent("on"+l,q))},unbind:function(m,l,s){var q=p.data(m,"e"+l);if(q){if(s){for(var n=q.length-1,r=q[n];n>=0;n--){r===s&&q.splice(n,1)}}else{q=g}if(!q||!q.length){s=p.data(m,l+"Handler"),m.addEventListener?m.removeEventListener(l,s,!1):m.attachEvent&&m.detachEvent("on"+l,s),p.removeData(m,l+"Handler"),p.removeData(m,"e"+l)}}},eventHandler:function(l){return function(m){for(var m=p.event.fixEvent(m||c.event),r=p.data(l,"e"+m.type),q=0,n;n=r[q++];){n.call(l,m)===!1&&(m.preventDefault(),m.stopPropagation())}}},fixEvent:function(m){if(m.target){return m}var l={},n;l.target=m.srcElement||document;l.preventDefault=function(){m.returnValue=!1};l.stopPropagation=function(){m.cancelBubble=!0};for(n in m){l[n]=m[n]}return l}};p.capitalize=function(m){var l=m.charAt(0);return l.toUpperCase()+m.replace(l,"")};p.getScroll=function(l){l=this.capitalize(l);return e["scroll"+l]||k["scroll"+l]};p.getOffset=function(m,l){var r=this.capitalize(l),r=e["client"+r]||k["client"+r]||0,q=this.getScroll(l),n=m.getBoundingClientRect();return Math.round(n[l])+q-r};p.drag=function(E,D){var C="getSelection" in c?function(){c.getSelection().removeAllRanges()}:function(){try{f.selection.empty()}catch(l){}},B=this,A=B.event,u=!1,v=z?E:f,t=D.style.position==="fixed",r=p.data("options").fixed;A.bind(E,"mousedown",function(G){u=!0;var F=B.getScroll("top"),l=B.getScroll("left"),n=t?0:l,m=t?0:F;p.data("dragData",{x:G.clientX-B.getOffset(D,"left")+(t?l:0),y:G.clientY-B.getOffset(D,"top")+(t?F:0),el:n,et:m,er:n+e.clientWidth-D.offsetWidth,eb:m+e.clientHeight-D.offsetHeight});z&&(i&&r&&D.style.removeExpression("top"),E.setCapture());A.bind(v,"mousemove",s);A.bind(v,"mouseup",q);z&&A.bind(E,"losecapture",q);G.stopPropagation();G.preventDefault()});var s=function(n){if(u){C();var K=p.data("dragData"),J=n.clientX-K.x,I=n.clientY-K.y,H=K.et,F=K.er,l=K.eb,K=K.el,G=D.style;G.marginLeft=G.marginTop="0px";G.left=(J<=K?K:J>=F?F:J)+"px";G.top=(I<=H?H:I>=l?l:I)+"px";n.stopPropagation()}},q=function(m){u=!1;z&&A.unbind(E,"losecapture",arguments.callee);A.unbind(v,"mousemove",s);A.unbind(v,"mouseup",arguments.callee);if(z&&(E.releaseCapture(),i&&r)){var l=parseInt(D.style.top)-B.getScroll("top");D.style.setExpression("top","fuckIE6=document.documentElement.scrollTop+"+l+'+"px"')}m.stopPropagation()}};var d,x=function(l){l.keyCode===27&&w.close()},w={open:function(D){var C=new p,B=C.getOptions(D||{}),D=p.event,A=this,v,t,u,s;d&&(clearTimeout(d),d=g);if(B.overlay){v=f.getElementById("overlay"),v||(v=C.createOverlay(),k.appendChild(v),i&&C.appendIframe(v)),v.style.display="block"}i&&C.setBodyBg();t=f.getElementById("chatBox");t||(t=C.createDialogBox(),k.appendChild(t));if(B.follow){C.setFollow(t,B.follow,B.followX,B.followY);if(v){v.style.display="none"}B.fixed=!1}else{C.setPosition(t,B.fixed)}t.style.display="block";!B.follow&&!B.fixed&&(u=function(){C.setPosition(t,!1)},D.bind(c,"resize",u),p.data("resize",u));u=typeof B.container==="string"?f.getElementById(B.container):C.createDialogWrap(B.container);if(s=t.getElementsByTagName("*")[0]){if(s&&u!==s){s.style.display="none",k.appendChild(s),t.appendChild(u)}}else{t.appendChild(u)}u.style.display="block";s=u.offsetWidth;var r=u.offsetHeight;u.style.marginTop=u.style.marginRight=u.style.marginBottom=u.style.marginLeft="0px";B.follow?t.style.marginLeft=t.style.marginTop="0px":(t.style.marginLeft="-"+s/2+"px",t.style.marginTop="-"+r/2+"px");if(i&&!B.overlay){t.style.width=s+"px",t.style.height=r+"px"}u=f.getElementById("chatCls");s=f.getElementById("chatTit");var r=f.getElementById("chatYesBtn"),q=f.getElementById("chatNoBtn");r&&D.bind(r,"click",function(l){B.container.yesFn.call(A,l)!==!1&&A.close()});if(q){var m=function(l){(B.container.noFn===!0||B.container.noFn.call(A,l)!==!1)&&A.close()};D.bind(q,"click",m);u&&D.bind(u,"click",m)}else{u&&D.bind(u,"click",A.close)}B.lock||D.bind(f,"keyup",x);B.autoClose&&typeof B.autoClose==="number"&&(d=setTimeout(A.close,B.autoClose));if(B.drag&&s){s.style.cursor="move",p.drag(s,t)}p.data("dialogElements",{overlay:v,dialogBox:t,chatCls:u,dialogTitle:s,dialogYesBtn:r,dialogNoBtn:q})},close:function(){var m=p.data("options"),l=p.data("dialogElements"),n=p.event;d&&(clearTimeout(d),d=g);if(m.overlay&&l.overlay){l.overlay.style.display="none"}l.dialogBox.style.display="none";i&&l.dialogBox.style.removeExpression("top");l.chatCls&&n.unbind(l.chatCls,"click");l.dialogTitle&&n.unbind(l.dialogTitle,"mousedown");l.dialogYesBtn&&n.unbind(l.dialogYesBtn,"click");l.dialogNoBtn&&n.unbind(l.dialogNoBtn,"click");!m.follow&&!m.fixed&&(l=p.data("resize"),n.unbind(c,"resize",l),p.removeData("resize"));m.lock||n.unbind(f,"keyup",x);typeof m.callback==="function"&&m.callback.call(w);p.removeData("options");p.removeData("dialogElements")}};return w},h=function(){c.jzChat=a()},b=function(){if(!f.body){try{e.doScroll("left")}catch(d){setTimeout(b,1);return}h()}};(function(){if(f.body){h()}else{if(f.addEventListener){f.addEventListener("DOMContentLoaded",function(){f.removeEventListener("DOMContentLoaded",arguments.callee,!1);h()},!1),c.addEventListener("load",h,!1)}else{if(f.attachEvent){f.attachEvent("onreadystatechange",function(){f.readyState==="complete"&&(f.detachEvent("onreadystatechange",arguments.callee),h())});c.attachEvent("onload",h);var d=!1;try{d=c.frameElement==null}catch(i){}e.doScroll&&d&&b()}}}})()})(window,void 0);function placeCaretAtEnd(b){b.focus();if(typeof window.getSelection!="undefined"&&typeof document.createRange!="undefined"){var a=document.createRange();a.selectNodeContents(b);a.collapse(false);var d=window.getSelection();d.removeAllRanges();d.addRange(a)}else{if(typeof document.body.createTextRange!="undefined"){var c=document.body.createTextRange();c.moveToElementText(b);c.collapse(false);c.select()}}}(function($){$.fn.setCursorPosition=function(position){if(this.length==0){return this}return $(this).setSelection(position,position)};$.fn.setSelection=function(selectionStart,selectionEnd){if(this.length==0){return this}input=this[0];if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd("character",selectionEnd);range.moveStart("character",selectionStart);range.select()}else{if(input.setSelectionRange){input.focus();input.setSelectionRange(selectionStart,selectionEnd)}}return this};$.fn.focusEnd=function(){this.setCursorPosition(this.text().length)};$.expBlock={};var faceAdd="http://static.n8n8.cn/Public/Images/chatFace/";var EXP_DATA=[{name:"\u9ed8\u8ba4",icons:[{url:"1.gif",title:"0",alt:"\u5fae\u7b11"},{url:"2.gif",title:"1",alt:"\u6487\u5634"},{url:"3.gif",title:"2",alt:"\u8272"},{url:"4.gif",title:"3",alt:"\u53d1\u5446"},{url:"5.gif",title:"4",alt:"\u5f97\u610f"},{url:"6.gif",title:"5",alt:"\u6d41\u6cea"},{url:"7.gif",title:"6",alt:"\u5bb3\u7f9e"},{url:"8.gif",title:"7",alt:"\u95ed\u5634"},{url:"9.gif",title:"8",alt:"\u7761"},{url:"10.gif",title:"9",alt:"\u5927\u54ed"},{url:"11.gif",title:"10",alt:"\u5c34\u5c2c"},{url:"12.gif",title:"11",alt:"\u53d1\u6012"},{url:"13.gif",title:"12",alt:"\u8c03\u76ae"},{url:"14.gif",title:"13",alt:"\u5472\u7259"},{url:"15.gif",title:"14",alt:"\u60ca\u8bb6"},{url:"16.gif",title:"15",alt:"\u96be\u8fc7"},{url:"17.gif",title:"16",alt:"\u9177"},{url:"18.gif",title:"17",alt:"\u51b7\u6c57"},{url:"19.gif",title:"18",alt:"\u6293\u72c2"},{url:"20.gif",title:"19",alt:"\u5410"},{url:"21.gif",title:"20",alt:"\u5077\u7b11"},{url:"22.gif",title:"21",alt:"\u53ef\u7231"},{url:"23.gif",title:"22",alt:"\u767d\u773c"},{url:"24.gif",title:"23",alt:"\u50b2\u6162"},{url:"25.gif",title:"24",alt:"\u9965\u997f"},{url:"26.gif",title:"25",alt:"\u56f0"},{url:"27.gif",title:"26",alt:"\u60ca\u6050"},{url:"28.gif",title:"27",alt:"\u6d41\u6c57"},{url:"29.gif",title:"28",alt:"\u61a8\u7b11"},{url:"30.gif",title:"29",alt:"\u5927\u5175"},{url:"31.gif",title:"30",alt:"\u594b\u6597"},{url:"32.gif",title:"31",alt:"\u5492\u9a82"},{url:"33.gif",title:"32",alt:"\u7591\u95ee"},{url:"34.gif",title:"33",alt:"\u5618.."},{url:"35.gif",title:"34",alt:"\u6655"},{url:"36.gif",title:"35",alt:"\u6298\u78e8"},{url:"37.gif",title:"36",alt:"\u8870"},{url:"38.gif",title:"37",alt:"\u9ab7\u9ac5"},{url:"39.gif",title:"38",alt:"\u6572\u6253"},{url:"40.gif",title:"39",alt:"\u518d\u89c1"},{url:"41.gif",title:"40",alt:"\u64e6\u6c57"},{url:"42.gif",title:"41",alt:"\u62a0\u9f3b"},{url:"43.gif",title:"42",alt:"\u9f13\u638c"},{url:"44.gif",title:"43",alt:"\u7cd7\u5927\u4e86"},{url:"45.gif",title:"44",alt:"\u574f\u7b11"},{url:"46.gif",title:"45",alt:"\u5de6\u54fc\u54fc"},{url:"47.gif",title:"46",alt:"\u53f3\u54fc\u54fc"},{url:"48.gif",title:"47",alt:"\u54c8\u6b20"},{url:"49.gif",title:"48",alt:"\u9119\u89c6"},{url:"50.gif",title:"49",alt:"\u59d4\u5c48"},{url:"51.gif",title:"50",alt:"\u5feb\u54ed\u4e86"},{url:"52.gif",title:"51",alt:"\u9634\u9669"},{url:"53.gif",title:"52",alt:"\u4eb2\u4eb2"},{url:"54.gif",title:"53",alt:"\u5413"},{url:"55.gif",title:"54",alt:"\u53ef\u601c"},{url:"56.gif",title:"55",alt:"\u83dc\u5200"},{url:"57.gif",title:"56",alt:"\u897f\u74dc"},{url:"58.gif",title:"57",alt:"\u5564\u9152"},{url:"59.gif",title:"58",alt:"\u7bee\u7403"},{url:"60.gif",title:"59",alt:"\u4e52\u4e53"},{url:"61.gif",title:"60",alt:"\u5496\u5561"},{url:"62.gif",title:"61",alt:"\u996d"},{url:"63.gif",title:"62",alt:"\u732a\u5934"},{url:"64.gif",title:"63",alt:"\u73ab\u7470"},{url:"65.gif",title:"64",alt:"\u51cb\u8c22"},{url:"66.gif",title:"65",alt:"\u793a\u7231"},{url:"67.gif",title:"66",alt:"\u7231\u5fc3"},{url:"68.gif",title:"67",alt:"\u5fc3\u788e"},{url:"69.gif",title:"68",alt:"\u86cb\u7cd5"},{url:"70.gif",title:"69",alt:"\u95ea\u7535"},{url:"71.gif",title:"70",alt:"\u70b8\u5f39"},{url:"72.gif",title:"71",alt:"\u5200"},{url:"73.gif",title:"72",alt:"\u8db3\u7403"},{url:"74.gif",title:"73",alt:"\u74e2\u866b"},{url:"75.gif",title:"74",alt:"\u4fbf\u4fbf"},{url:"76.gif",title:"75",alt:"\u6708\u4eae"},{url:"77.gif",title:"76",alt:"\u592a\u9633"},{url:"78.gif",title:"77",alt:"\u793c\u7269"},{url:"79.gif",title:"78",alt:"\u62e5\u62b1"},{url:"80.gif",title:"79",alt:"\u5f3a"},{url:"81.gif",title:"80",alt:"\u5f31"},{url:"82.gif",title:"81",alt:"\u63e1\u624b"},{url:"83.gif",title:"82",alt:"\u80dc\u5229"},{url:"84.gif",title:"83",alt:"\u62b1\u62f3"},{url:"85.gif",title:"84",alt:"\u52fe\u5f15"},{url:"86.gif",title:"85",alt:"\u62f3\u5934"},{url:"87.gif",title:"86",alt:"\u5dee\u52b2"},{url:"88.gif",title:"87",alt:"\u7231\u4f60"},{url:"89.gif",title:"88",alt:"NO"},{url:"90.gif",title:"89",alt:"OK"},{url:"91.gif",title:"90",alt:"\u7231\u60c5"},{url:"92.gif",title:"91",alt:"\u98de\u543b"},{url:"93.gif",title:"92",alt:"\u8df3\u8df3"},{url:"94.gif",title:"93",alt:"\u53d1\u6296"},{url:"95.gif",title:"94",alt:"\u6004\u706b"},{url:"96.gif",title:"95",alt:"\u8f6c\u5708"},{url:"97.gif",title:"96",alt:"\u78d5\u5934"},{url:"98.gif",title:"97",alt:"\u56de\u5934"},{url:"99.gif",title:"98",alt:"\u8df3\u7ef3"},{url:"100.gif",title:"99",alt:"\u6325\u624b"},{url:"101.gif",title:"100",alt:"\u6fc0\u52a8"},{url:"102.gif",title:"101",alt:"\u8857\u821e"},{url:"103.gif",title:"102",alt:"\u732e\u543b"},{url:"104.gif",title:"103",alt:"\u5de6\u592a\u6781"},{url:"105.gif",title:"104",alt:"\u53f3\u592a\u6781"}]}],IMGS_DATA=[],expEnable=true,config={expData:null,holder:".exp-holder",textarea:"textarea",trigger:".exp-block-trigger",grpNum:5,posType:"absolute",zIndex:"1000001"},pos_correct_left=30,exp_close_tri=".exp-close",grp_num_per_panel=1,win=window||document,bd="body";function init(cfg){$.extend(config,cfg);if(config.expData!=null){EXP_DATA=config.expData}_getImgData();var triggers=$(config.trigger);triggers.each(function(){$(this).unbind("click");$(this).bind("click",function(){var me=$(this),holder=$(me.parents(config.holder)[0]),ta=$(holder.find(config.textarea)[0]),exp=$(_genrt_html()),off=me.offset(),me_l=off.left-50,me_t=off.top,me_w=me.width(),me_h=me.height(),exp_t=me_t+me_h,exp_l=me_l+(me_w+pos_correct_left)/2,exp_close=exp.find(exp_close_tri),exp_sub_tab=exp.find(".exp-sub-tab"),sub_tab_items=exp_sub_tab.children(".group-name"),sub_tab_pre=exp_sub_tab.find(".pre"),sub_tab_next=exp_sub_tab.find(".next"),curGroup=null,grpCnt=EXP_DATA.length,grpPgCnt=(function(){var p=Math.floor(grpCnt/config.grpNum);if(grpCnt%config.grpNum!=0){return p+1}else{return p}})(),curGrpPg=1,expUl=exp.find(".exp-detail");var showXGroupExp=function(i){var expList="",listDOM;if(curGroup!=null&&curGroup!=i){sub_tab_items.eq(curGroup).removeClass("slct");curGroup=i;sub_tab_items.eq(i).addClass("slct");sub_tab_items.eq(i).addClass("slct");for(var j=0;j<EXP_DATA[i].icons.length;j++){expList+='<li action-data="[:){'+EXP_DATA[i].icons[j].title+'}(:]"><img title="'+EXP_DATA[i].icons[j].alt+'" alt="'+EXP_DATA[i].icons[j].alt+'" src="'+faceAdd+EXP_DATA[i].icons[j].url+'"></li>'}listDOM=$(expList);listDOM.each(function(){$(this).click(function(){var me=$(this),actData=me.attr("action-data"),taVal=ta.val();ta.val(taVal+actData);$(bd).unbind("click");me.unbind("mouseout");$(win).unbind("resize");exp.remove()})});expUl.children().remove();expUl.append(listDOM)}else{if(curGroup==null){curGroup=i;sub_tab_items.eq(i).addClass("slct");for(var j=0;j<EXP_DATA[i].icons.length;j++){expList+='<li action-data="[:){'+EXP_DATA[i].icons[j].title+'}(:]"><img title="'+EXP_DATA[i].icons[j].alt+'" alt="'+EXP_DATA[i].icons[j].alt+'" src="'+faceAdd+EXP_DATA[i].icons[j].url+'" data-name="[:){'+EXP_DATA[i].icons[j].title+'}(:]" data-val="'+EXP_DATA[i].icons[j].title+'"></li>'}listDOM=$(expList);listDOM.each(function(){$(this).click(function(){var me=$(this),actData=me.attr("action-data"),taVal=ta.text();if(isIE8){ta.append(me.html()+"&nbsp;")}else{ta.append(me.html())}$(bd).unbind("click");me.unbind("mouseout");$(win).unbind("resize");exp.remove();ta.focusEnd();placeCaretAtEnd(document.getElementById("chatInp"))})});expUl.children().remove();expUl.append(listDOM)}else{if(curGroup!=null&&curGroup==i){}}}},showGrp=function(i){var range={};range.left=(i-1)*config.grpNum;range.left=Math.max(0,range.left);range.right=(i)*config.grpNum-1;range.right=Math.min(range.right,grpCnt-1);sub_tab_items.hide();for(var j=range.left;j<=range.right;j++){sub_tab_items.eq(j).show()}curGrpPg=i;if(curGrpPg==1){sub_tab_pre.addClass("pre-disable")}else{sub_tab_pre.removeClass("pre-disable")}if(curGrpPg>=grpPgCnt){sub_tab_next.addClass("next-disalbe")}else{sub_tab_next.removeClass("next-disalbe")}};if(config.posType=="fixed"){me_t=off.top-$(win).scrollTop();exp_t=me_t+me_h}if(expEnable){exp.css({position:config.posType,zIndex:config.zIndex,left:"-200px",top:"57px"});$(win).resize(function(){off=me.offset(),me_l=off.left-50,me_t=off.top;exp_t=me_t+me_h,exp_l=me_l+(me_w+pos_correct_left)/2;exp.css({left:exp_l+"px",top:exp_t+"px"})});exp_close.click(function(){$(bd).unbind("click");me.unbind("mouseout");$(win).unbind("resize");exp.remove()});me.mouseout(function(){$(bd).click(function(e){var clickDOM=$(e.target);var a=clickDOM.parents(".exp-layer");if(!a.hasClass("exp-layer")){exp.remove();$(bd).unbind("click");me.unbind("mouseout");$(win).unbind("resize")}})});showGrp(1);sub_tab_pre.click(function(){var p=curGrpPg-1,rg;p=(p<1)?1:p;showGrp(p)});sub_tab_next.click(function(){var p=curGrpPg+1,rg;p=(p>grpPgCnt)?curGrpPg:p;showGrp(p)});showXGroupExp(0);sub_tab_items.each(function(){$(this).click(function(){var me=$(this),groupIndex=me.attr("grp-index");showXGroupExp(groupIndex)})});$("#chatBox").append(exp);exp.show()}})})}function disableExp(){expEnable=false}function enableExp(){expEnable=true}function getRemoteNewExp(data_url){$.ajax({url:data_url,success:function(data){EXP_DATA=eval(data);_getImgData()},error:function(){("\u4f20\u5165\u7684url\u9519\u8bef")}})}function textFormat(str){var reg=/\[\:\)\{(\d+)\}\(\:\]/g,src=str,rslt,temp;_getImgData();while(temp=reg.exec(src)){var s=_switchImg(temp[1]),creg,t="\\[\\:\\)\\{"+temp[1]+"\\}\\(\\:\\]";creg=new RegExp(t,"g");if(src.match(temp[0])&&s!=temp[1]){src=src.replace(creg,s)}}return src}function _genrt_html(){var html='<div class="exp-layer"><div class="holder"><div class="content"><div class="exp-tab clearfix"><a href="javascript:;">\u5e38\u7528\u8868\u60c5</a></div><div class="exp-sub-tab clearfix">';html+='<div class="sub-tab-pagination"><a class="pre"></a><a class="next"></a></div></div><ul class="exp-detail clearfix">';html+='</ul></div><a class="exp-close" href="javascript:;" target="_self" title="\u5173\u95ed"></a></div><a class="exp-tri" href="javascript:;"></a></div>';return html}function _switchImg(str){for(var i=0;i<IMGS_DATA.length;i++){if(IMGS_DATA[i].title==str){return'<img src="'+faceAdd+IMGS_DATA[i].url+'" width="24" height="24" />'}}return str}function _getImgData(){for(var i=0;i<EXP_DATA.length;i++){IMGS_DATA.push(EXP_DATA[i].icons);for(var j=0;j<EXP_DATA[i].icons.length;j++){IMGS_DATA.push(EXP_DATA[i].icons[j])}}}$.expBlock={initExp:init,disableExp:disableExp,enableExp:enableExp,getRemoteExp:getRemoteNewExp,textFormat:textFormat}})(jQuery);$(function(){var a="http://static.n8n8.cn/Public/Images/ucenter/";var b='<style type="text/css">ul,dl{list-style:none;margin:0;padding:0;}h4,p{margin:0;}.msg_wrap{display:none;width:400px;font-family:Arial;color:#444;border:3px solid rgba(0,0,0,0);-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;-webkit-box-shadow:0 0 10px rgba(0,0,0,0.4);-moz-box-shadow:0 0 10px rgba(0,0,0,0.4);box-shadow:0 0 10px rgba(0,0,0,0.4)}.chat{margin:0;background:#FFF;}.msg_wrap .msg_tit{overflow:hidden;height:30px;padding:0 10px;line-height:30px;font-size:14px;color:#666;border-bottom:1px solid #e5e5e5;border-radius:4px 4px 0 0;background:#f7f7f7}#chatBtn{display:none;position:fixed;_position:absolute;*+cursor:pointer;top:230px;right:50px;width:75px;height:85px;background:url('+a+"u_chat_sprites.png) no-repeat -670px -468px}#chatBtn .sc_lnk{display:block;cursor:pointer;width:75px;height:85px;font-size:13px;}#chatBtn a.sc_lnk{text-decoration:none;color:#000;}#chatBtn .sc_txt{display:block;width:74px;padding:62px 0 0 1px;text-align:center}.chat{display:none;position:relative;width:542px;font:13px/1.5 Arial,sans-serif;text-align:left;border:0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.chat .msg_cont{border:0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.chat .msg_tit{height:25px;padding-left:30px;font-weight:normal;font-size:13px;line-height:25px;color:#070707;border:0;background:url("+a+"u_chat_sprites.png) no-repeat -2px -13px}.chat .msg_tit .minimize{float:right;width:12px;height:25px;margin-right:5px;background:url("+a+"u_chat_sprites.png) no-repeat -733px -290px}.chat .msg_tit .maximize{float:right;width:12px;height:25px;margin-right:5px;background:url("+a+"u_chat_sprites.png) no-repeat -733px -379px}.chat .msg_tit .close_btn{float:right;width:13px;height:25px;text-indent:-9999px;background:url("+a+"u_chat_sprites.png) no-repeat -732px -244px}.chat .ann{height:32px;margin-top:2px;padding-left:10px;line-height:32px;color:#666;background:url("+a+"u_chat_sprites.png) no-repeat -2px -40px}.chat .ann .p1{height:25px;line-height:25px}.chat .record{overflow-y:scroll;height:240px;margin:0 0 1px 1px;padding:10px;background:url("+a+"chat_c_bg.jpg) repeat-x 0 0}.chat .record .rec_c{padding-bottom:10px;}.chat .record .rec_c .rec_l dt{height:25px;line-height:25px;color:#018ddd}.chat .record .rec_c .rec_l dt.own{color:#008040;}.chat .record .rec_c .rec_l dd.rec_t{line-height:1.4;margin:0;padding-left:1em;word-wrap:break-word;}.chat .record .rec_c .rec_l dd.rec_t img{vertical-align:middle;}.chat .record .rec_c .rec_l dd.rec_t .lnk{color:#0000FF;text-decoration:underline;}.chat .tool{height:25px;line-height:25px;border-bottom:1px solid #ced5e0;background:#d7ebf6}.chat .tool .t_btn{padding:2px 0 0 1px}.chat .tool .t_btn li{float:left;height:21px;margin-left:2px;background:url("+a+"u_chat_sprites.png) no-repeat}.chat .tool .t_btn li a{display:block;height:21px}.chat .tool .t_btn .txt,.chat .tool .t_btn .txt .txt_a{width:23px}.chat .tool .t_btn .txt{background-position:-722px -14px}.chat .tool .t_btn .exp,.chat .tool .t_btn .exp .exp_a{width:22px}.chat .tool .t_btn .exp{background-position:-723px -193px;}.de-emoticons{z-index:10001!important}.chat .tool .t_btn .img,.chat .tool .t_btn .img .img_a{width:24px}.chat .tool .t_btn .img{background-position:-719px -117px}.chat .tool .t_btn .scr,.chat .tool .t_btn .scr .scr_a{width:22px}.chat .tool .t_btn .scr{background-position:-721px -57px}.chat .area{height:80px}.chat .area .c_inp{overflow:auto;width:532px;height:80px;padding:5px;font-size:13px;resize:none;border:0}.chat .area .c_inp img{vertical-align:bottom;}.chat .area .c_inp:focus{outline:0}.chat .btm{height:65px;background:url("+a+"u_chat_sprites.png) no-repeat -2px -303px}.chat .btm .sub{float:right;width:120px;height:22px;margin:25px 20px 0 0;_margin-right:10px;line-height:22px}.chat .btm .sub input{cursor:pointer;height:22px;line-height:18px;color:#666;border:0}.chat .btm .sub .c_clo{width:41px;background:url("+a+"u_chat_sprites.png) no-repeat -2px -203px}.chat .btm .sub .c_sub{float:right;width:70px;height:22px;background:url("+a+"u_chat_sprites.png) no-repeat -2px -260px}.chat .btm .sub .c_sub .c_s_btn{float:left;width:57px;background:0}.chat .btm .sub .c_sub .c_s_help .c_s_h_a{display:block;float:left;width:13px;height:22px}.exp-layer{display:none;position:absolute;left:200px;top:200px;z-index:10;width:457px;border-radius:4px;padding:4px;background:url("+a+"exp/layer_bg.png)}.exp-layer .holder{position:relative;z-index:30;border:1px solid #c3c3c3;border-radius:4px;background:#fff}.exp-layer .exp-tri{display:none;position:absolute;left:30px;top:-7px;z-index:40;width:16px;height:12px;background:url("+a+"exp/layer_arrow.png)}.exp-layer .exp-close{display:block;position:absolute;right:5px;top:5px;z-index:20;width:20px;height:20px;background:url("+a+"exp/ico.png) 5px -250px no-repeat}.exp-layer .exp-close:hover{background-position:0 -1954px}.exp-layer .exp-tab{padding:4px 4px 0 6px;background:#f0f0f0}.exp-layer .exp-tab a{display:block;float:left;height:25px;margin:0 3px;padding:0 10px;border:1px solid #e8e8e8;border-bottom:0;border-radius:4px 4px 0 0;background:#fff;font-size:12px;font-weight:400;text-overflow:clip;color:#666;text-decoration:none;line-height:25px}.exp-layer .exp-sub-tab{position:relative;margin:10px 0 0 16px;padding-right:60px;overflow:hidden}.exp-layer .exp-sub-tab a{display:block;float:left;height:23px;padding:0 7px;color:#9abbc8;font-size:12px;font-weight:400;text-decoration:none;line-height:23px}.exp-layer .exp-sub-tab a.slct{background:none repeat scroll 0 0 #f0f0f0;border-radius:3px 3px 3px 3px;cursor:default;position:relative;text-decoration:none;z-index:2}.exp-layer .exp-sub-tab span{float:left;margin:0 5px;color:#9abbc8}.exp-layer .sub-tab-pagination{position:absolute;right:10px;top:0;height:100%}.exp-layer .sub-tab-pagination a{display:none;width:17px;height:17px;margin:0 2px;padding:0;background:url("+a+'exp/ico.png) no-repeat;cursor:pointer;display:inline;line-height:17px}.exp-layer .sub-tab-pagination .pre{background-position:0 -1290px}.exp-layer .sub-tab-pagination .next{background-position:0 -1176px}.exp-layer .sub-tab-pagination a.pre-disable{background-position:0 -1367px;cursor:default}.exp-layer .sub-tab-pagination a.next-disalbe{background-position:0 -1253px;cursor:default}.exp-layer .exp-detail{margin:0 10px 10px 10px;}.exp-detail li{overflow:hidden;display:block;float:left;width:28px;height:28px;margin:-1px 0 0 -1px;line-height:28px;border:1px solid #e8e8e8;padding:0;text-align:center;cursor:pointer}.exp-detail li:hover{position:relative;border:1px solid #0095cd;background:#fff9ec;z-index:50}.clearfix:after{visibility:hidden;display:block;font-size:0;content:" ";clear:both;height:0}* html .clearfix{zoom:1}*:first-child+html .clearfix{zoom:1}</style>';$("head").append(b)});JZIM.chatPopUp=function(){jzChat.open({container:"chat",overlay:false});placeCaretAtEnd(document.getElementById("chatInp"));$("#chatCls").live("click",function(){$("body").unbind("mouseover")});$("#chatCls2").live("click",function(){$("#chatBox").css("display","none");$("body").unbind("mouseover")});$("#minimize").live("click",function(){$("#chatBox").css("display","none");$("body").unbind("mouseover")});$.expBlock.initExp({textarea:"#chatInp"});$.expBlock.disableExp();$.expBlock.enableExp()};function urlToLnk(a){return(a.replace(/((https?|ftp|file):\/\/[-a-zA-Z0-9+&@#\/%?=~_|!:,.;]*)/g,'<a class="lnk" href="$1" title="\u70b9\u51fb\u67e5\u770b">$1</a>'))}function expToImg(){var a=$("#chatCon dl:last").find(".rec_t");var b,c=a.html();b=$.expBlock.textFormat(c);a.html(b)}var onceObj={};onceObj.triggerOnce=function(a){return function(){try{a.apply(this,arguments)}catch(b){}finally{a=null}}};JZIM.CPS_NAME=JZIM.CPS_NAME||"\u7ecf\u4f20-\u5ba2\u670d\u4e2d\u5fc3";JZIM.GREETING=JZIM.GREETING||"\u60a8\u597d\uff0c\u8fd9\u91cc\u662f\u7ecf\u4f20\u8f6f\u4ef6\u5168\u56fd\u5ba2\u670d\u5728\u7ebf\u670d\u52a1\u4e2d\u5fc3\uff0c\u8bf7\u95ee\u6709\u4ec0\u4e48\u80fd\u591f\u5e2e\u5230\u60a8\uff1f";var BOSH_SERVICE="http://im.jingzhuan.cn/im/proxy.php";var XMPP_SERVICE="http://im.jingzhuan.cn/xmpp-service/cpsImSelector/status";var XMPP_DOMAIN="im.jingzhuan.cn";var LOG_FLAG=false;var CPS_JID=null;var ANONYMOUS_NAME="\u6211";var connection=null;var userID=$("#UserNick").attr("val");function log(a){if(LOG_FLAG){$("#log").append("<div></div>").append(document.createTextNode(a))}}function rawInput(a){log("RECV: "+a)}function rawOutput(a){log("SENT: "+a)}function onConnect(a){if(a==Strophe.Status.CONNECTING){log("Strophe is connecting.")}else{if(a==Strophe.Status.CONNFAIL){log("Strophe failed to connect.");$("#connect").get(0).value="connect"}else{if(a==Strophe.Status.DISCONNECTING){log("Strophe is disconnecting.")}else{if(a==Strophe.Status.DISCONNECTED){log("Strophe is disconnected.");$("#connect").get(0).value="connect"}else{if(a==Strophe.Status.CONNECTED){log("Strophe is connected.");openChat();connection.addHandler(onMessage,null,"message",null,null,null);connection.send($pres().tree())}}}}}}function onMessage(d){to=d.getAttribute("to");from=d.getAttribute("from");var c=MD5.hexdigest(from.split("/")[0]);var g=d.getAttribute("type");var b=d.getElementsByTagName("body");var i=null;var h=new Date();var a=h.toLocaleTimeString();if(document.getElementById("chatBox").style.display=="none"){document.getElementById("chatBox").style.display="block"}if(g=="chat"&&b.length>0){var e=b[0];i=Strophe.getText(e);log(new Date().toLocaleTimeString()+"  "+from+" say: "+i);var f=$("#"+c);if(f.length==0){openChat()}f=$("#"+c);i=urlToLnk(i);f.find("#chatCon").append("<dl class='rec_l'><dt>"+JZIM.CPS_NAME+"&nbsp;&nbsp;<span class='rec_d'>"+a+"</span></dt><dd class='rec_t'>"+i+"</dd></dl>")}expToImg();$("#chatRec").scrollTop(99999);return true}function setCookieVal(c,d,b){var a=new Date();a.setTime(a.getTime()+b*24*3600*1000);document.cookie=c+"="+d+"; expires="+a.toGMTString()}function getCookieVal(c){var b=document.cookie.split("; ");for(var d=0;d<b.length;d++){var a=b[d].split("=");if(c==a[0]){if(a.length>1){return unescape(a[1])}else{return 0}}}return 0}$(function(){var a=JZIM.cpsId||getCookieVal("VisitorCpsid");userID=isNaN(userID)?0:0;request=$.ajax({url:XMPP_SERVICE,type:"GET",cache:false,data:{cpsid:a,userid:userID},dataType:"jsonp",success:function(b){if(b.jid===undefined||b.online===false){return}connection=new Strophe.Connection(BOSH_SERVICE);connection.rawInput=rawInput;connection.rawOutput=rawOutput;connection.connect(XMPP_DOMAIN,null,onConnect);JZIM.imPeerJid=JZIM.imPeerJid||b.jid}})});function openChat(){var k=JZIM.imPeerJid;var b=MD5.hexdigest(k);var m=$("<div id='chat' class='msg_wrap chat'><div id='"+b+"' class='msg_cont exp-holder'><h4 class='msg_tit' id='chatTit'><a href='javascript:void(0)' target='_self' title='\u5173\u95ed\u7a97\u53e3' class='close_btn' id='chatCls'>&times;</a><a id='maximize' class='maximize' href='javascript:;' target='_self' title='\u6700\u5927\u5316'></a><a id='minimize' class='minimize' href='javascript:;' target='_self' title='\u6700\u5c0f\u5316'></a><span id='chatTitTxt'>"+JZIM.CPS_NAME+"</span></h4><div id='chatAnn' class='ann'><p class='p1'>\u7ecf\u8fc7\u6211\u4eec\u7684\u52aa\u529b\uff0c\u628a\u77e5\u8bc6\u4e0e\u8d22\u5bcc\u4f20\u9012\u5230\u4f60\u7684\u624b\u4e2d</p></div><div id='chatRec' class='record'><div id='chatCon' class='rec_c'></div></div><div class='tool'><ul class='t_btn'><!--<li class='txt'><a class='txt_a' href='javascript:;' target='_self'></a></li>--><li class='exp'><a id='insertExpBtn2' class='exp_a exp-block-trigger' href='javascript:;' target='_self'></a></li><!--<li class='img'><a class='img_a' href='javascript:;' target='_self'></a></li><li class='scr'><a class='scr_a' href='javascript:;' target='_self'></a></li></ul>--></div><div class='area'><div id='chatInp' class='c_inp' name='chatInp' contenteditable='true'></div></div><div class='btm'><div class='sub'><input id='chatCls2' class='c_clo' type='button' title='\u5173\u95ed\u7a97\u53e3' value='\u5173\u95ed' /><p class='c_sub'><input id='chatSub' class='c_s_btn' type='submit' title='\u6309Enter\u952e\u53d1\u9001\u6d88\u606f' value='\u53d1\u9001' /><span class='c_s_help'><a class='c_s_h_a' href='javascript:;' target='_self'></a></span></p></div></div></div></div><div id='chatBtn' title='\u5ba2\u670d\u4e2d\u5fc3'><a class='sc_lnk' href='javascript:;' target='_self'><span class='sc_txt'>\u5ba2\u670d\u4e2d\u5fc3</span></a></div>");var j=m.find("#chatInp");var e=m.find("#chatSub");var h=m.find("#chatCon");var g=new Date();var c=g.toLocaleTimeString();function a(){var r=window.location.href;var q=$("title").html();var s=/^\s*|\s*$/g;var q=q.replace(s,"");var o=connection.sid+"@"+XMPP_DOMAIN;var n="\u6765\u6e90\u5730\u5740\uff1a"+r+"\n\u7f51\u9875\u6807\u9898\uff1a"+q+"\r";var p=$msg({to:k,from:o,type:"chat"}).cnode(Strophe.xmlElement("body","",n));connection.send(p.tree())}var f=onceObj.triggerOnce(a);function l(){var n=new Date();var s=n.toLocaleTimeString();var r=connection.sid+"@"+XMPP_DOMAIN;j.find("img").each(function(){var u=$(this).attr("data-name");var t=$(this).attr("data-val");$(this).replaceWith("&lt;BitMap Index='"+t+"'/&gt;"+u)});var p=j.text();var q="<Message id='inpValMsg' FontName='\u65b0\u5b8b\u4f53' FontSize='200' FontColr='0' FontBold='0'>"+p+"</Message>";p=p.replace(/\<br>/gi,"\r\n");p=p.replace(/\&nbsp;/gi," ");var o=$msg({to:k,from:r,type:"chat"}).cnode(Strophe.xmlElement("body","",q));connection.send(o.tree());inpVal2=urlToLnk(j.text());h.append("<dl class='rec_l'><dt class='own'>"+ANONYMOUS_NAME+"&nbsp;&nbsp;<span class='rec_d'>"+s+"</span></dt><dd class='rec_t'>"+inpVal2+"</dd></dl>");j.html("");expToImg();$("#chatRec").scrollTop(99999)}function d(){var n=j.text();var o=/^\s*|\s*$/g;n=n.replace(o,"");n=n.replace(/<br>/g,"");n=n.replace(/[ | ]*\n/g,"");n=n.replace(/&nbsp;/g,"");if(n.length||j.find("img").length>0){l()}else{alert("\u53d1\u9001\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");j.html("");return false}}$("#chatSub").live("click",function(){d()});var i=0;$("#chatInp").live("focus",function(){if(!i){f(1);i=1}});$("#chatInp").live("keyup",function(n){$(this).scrollTop(99999)});$("#chatInp").live("keydown",function(n){n=n||event;if(n.ctrlKey&&n.keyCode==13){$(this).html($(this).html()+"<br>&nbsp;");placeCaretAtEnd(document.getElementById("chatInp"));return}if(n.keyCode==13){n.preventDefault();d()}});h.append("<dl class='rec_l'><dt>"+JZIM.CPS_NAME+"&nbsp;&nbsp;<span class='rec_d'>"+c+"</span></dt><dd class='rec_t'>"+JZIM.GREETING+"</dd></dl>");$("body").append(m);if($("#chatBtn2").length<=0){$("#chatBtn").show()}if($("#chatBtn3").length>0){$("#chatBtn").show()}if($("#chatAuto").length){JZIM.chatPopUp();if(!$("#chatAuto").data("btn")){$("#chatBtn").hide()}}}var Base64=(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var b={encode:function(e){var c="";var m,k,h;var l,j,g,f;var d=0;do{m=e.charCodeAt(d++);k=e.charCodeAt(d++);h=e.charCodeAt(d++);l=m>>2;j=((m&3)<<4)|(k>>4);g=((k&15)<<2)|(h>>6);f=h&63;if(isNaN(k)){g=f=64}else{if(isNaN(h)){f=64}}c=c+a.charAt(l)+a.charAt(j)+a.charAt(g)+a.charAt(f)}while(d<e.length);return c},decode:function(e){var c="";var m,k,h;var l,j,g,f;var d=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{l=a.indexOf(e.charAt(d++));j=a.indexOf(e.charAt(d++));g=a.indexOf(e.charAt(d++));f=a.indexOf(e.charAt(d++));m=(l<<2)|(j>>4);k=((j&15)<<4)|(g>>2);h=((g&3)<<6)|f;c=c+String.fromCharCode(m);if(g!=64){c=c+String.fromCharCode(k)}if(f!=64){c=c+String.fromCharCode(h)}}while(d<e.length);return c}};return b})();var MD5=(function(){var o=0;var a="";var l=8;var j=function(r,u){var t=(r&65535)+(u&65535);var s=(r>>16)+(u>>16)+(t>>16);return(s<<16)|(t&65535)};var n=function(r,s){return(r<<s)|(r>>>(32-s))};var b=function(u){var t=[];var r=(1<<l)-1;for(var s=0;s<u.length*l;s+=l){t[s>>5]|=(u.charCodeAt(s/l)&r)<<(s%32)}return t};var g=function(t){var u="";var r=(1<<l)-1;for(var s=0;s<t.length*32;s+=l){u+=String.fromCharCode((t[s>>5]>>>(s%32))&r)}return u};var q=function(t){var s=o?"0123456789ABCDEF":"0123456789abcdef";var u="";for(var r=0;r<t.length*4;r++){u+=s.charAt((t[r>>2]>>((r%4)*8+4))&15)+s.charAt((t[r>>2]>>((r%4)*8))&15)}return u};var p=function(u){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var w="";var v,r;for(var s=0;s<u.length*4;s+=3){v=(((u[s>>2]>>8*(s%4))&255)<<16)|(((u[s+1>>2]>>8*((s+1)%4))&255)<<8)|((u[s+2>>2]>>8*((s+2)%4))&255);for(r=0;r<4;r++){if(s*8+r*6>u.length*32){w+=a}else{w+=t.charAt((v>>6*(3-r))&63)}}}return w};var d=function(z,v,u,r,y,w){return j(n(j(j(v,z),j(r,w)),y),u)};var k=function(v,u,A,z,r,y,w){return d((u&A)|((~u)&z),v,u,r,y,w)};var c=function(v,u,A,z,r,y,w){return d((u&z)|(A&(~z)),v,u,r,y,w)};var m=function(v,u,A,z,r,y,w){return d(u^A^z,v,u,r,y,w)};var i=function(v,u,A,z,r,y,w){return d(A^(u|(~z)),v,u,r,y,w)};var f=function(C,w){C[w>>5]|=128<<((w)%32);C[(((w+64)>>>9)<<4)+14]=w;var B=1732584193;var A=-271733879;var z=-1732584194;var y=271733878;var v,u,t,r;for(var s=0;s<C.length;s+=16){v=B;u=A;t=z;r=y;B=k(B,A,z,y,C[s+0],7,-680876936);y=k(y,B,A,z,C[s+1],12,-389564586);z=k(z,y,B,A,C[s+2],17,606105819);A=k(A,z,y,B,C[s+3],22,-1044525330);B=k(B,A,z,y,C[s+4],7,-176418897);y=k(y,B,A,z,C[s+5],12,1200080426);z=k(z,y,B,A,C[s+6],17,-1473231341);A=k(A,z,y,B,C[s+7],22,-45705983);B=k(B,A,z,y,C[s+8],7,1770035416);y=k(y,B,A,z,C[s+9],12,-1958414417);z=k(z,y,B,A,C[s+10],17,-42063);A=k(A,z,y,B,C[s+11],22,-1990404162);B=k(B,A,z,y,C[s+12],7,1804603682);y=k(y,B,A,z,C[s+13],12,-40341101);z=k(z,y,B,A,C[s+14],17,-1502002290);A=k(A,z,y,B,C[s+15],22,1236535329);B=c(B,A,z,y,C[s+1],5,-165796510);y=c(y,B,A,z,C[s+6],9,-1069501632);z=c(z,y,B,A,C[s+11],14,643717713);A=c(A,z,y,B,C[s+0],20,-373897302);B=c(B,A,z,y,C[s+5],5,-701558691);y=c(y,B,A,z,C[s+10],9,38016083);z=c(z,y,B,A,C[s+15],14,-660478335);A=c(A,z,y,B,C[s+4],20,-405537848);B=c(B,A,z,y,C[s+9],5,568446438);y=c(y,B,A,z,C[s+14],9,-1019803690);z=c(z,y,B,A,C[s+3],14,-187363961);A=c(A,z,y,B,C[s+8],20,1163531501);B=c(B,A,z,y,C[s+13],5,-1444681467);y=c(y,B,A,z,C[s+2],9,-51403784);z=c(z,y,B,A,C[s+7],14,1735328473);A=c(A,z,y,B,C[s+12],20,-1926607734);B=m(B,A,z,y,C[s+5],4,-378558);y=m(y,B,A,z,C[s+8],11,-2022574463);z=m(z,y,B,A,C[s+11],16,1839030562);A=m(A,z,y,B,C[s+14],23,-35309556);B=m(B,A,z,y,C[s+1],4,-1530992060);y=m(y,B,A,z,C[s+4],11,1272893353);z=m(z,y,B,A,C[s+7],16,-155497632);A=m(A,z,y,B,C[s+10],23,-1094730640);B=m(B,A,z,y,C[s+13],4,681279174);y=m(y,B,A,z,C[s+0],11,-358537222);z=m(z,y,B,A,C[s+3],16,-722521979);A=m(A,z,y,B,C[s+6],23,76029189);B=m(B,A,z,y,C[s+9],4,-640364487);y=m(y,B,A,z,C[s+12],11,-421815835);z=m(z,y,B,A,C[s+15],16,530742520);A=m(A,z,y,B,C[s+2],23,-995338651);B=i(B,A,z,y,C[s+0],6,-198630844);y=i(y,B,A,z,C[s+7],10,1126891415);z=i(z,y,B,A,C[s+14],15,-1416354905);A=i(A,z,y,B,C[s+5],21,-57434055);B=i(B,A,z,y,C[s+12],6,1700485571);y=i(y,B,A,z,C[s+3],10,-1894986606);z=i(z,y,B,A,C[s+10],15,-1051523);A=i(A,z,y,B,C[s+1],21,-2054922799);B=i(B,A,z,y,C[s+8],6,1873313359);y=i(y,B,A,z,C[s+15],10,-30611744);z=i(z,y,B,A,C[s+6],15,-1560198380);A=i(A,z,y,B,C[s+13],21,1309151649);B=i(B,A,z,y,C[s+4],6,-145523070);y=i(y,B,A,z,C[s+11],10,-1120210379);z=i(z,y,B,A,C[s+2],15,718787259);A=i(A,z,y,B,C[s+9],21,-343485551);B=j(B,v);A=j(A,u);z=j(z,t);y=j(y,r)}return[B,A,z,y]};var e=function(t,w){var v=b(t);if(v.length>16){v=f(v,t.length*l)}var r=new Array(16),u=new Array(16);for(var s=0;s<16;s++){r[s]=v[s]^909522486;u[s]=v[s]^1549556828}var x=f(r.concat(b(w)),512+w.length*l);return f(u.concat(x),512+128)};var h={hexdigest:function(r){return q(f(b(r),r.length*l))},b64digest:function(r){return p(f(b(r),r.length*l))},hash:function(r){return g(f(b(r),r.length*l))},hmac_hexdigest:function(r,s){return q(e(r,s))},hmac_b64digest:function(r,s){return p(e(r,s))},hmac_hash:function(r,s){return g(e(r,s))},test:function(){return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72"}};return h})();if(!Function.prototype.bind){Function.prototype.bind=function(b){var a=this;return function(){return a.apply(b,arguments)}}}if(!Function.prototype.prependArg){Function.prototype.prependArg=function(a){var b=this;return function(){var d=[a];for(var c=0;c<arguments.length;c++){d.push(arguments[c])}return b.apply(this,d)}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}(function(f){var e;function c(h,g){return new e.Builder(h,g)}function a(g){return new e.Builder("message",g)}function d(g){return new e.Builder("iq",g)}function b(g){return new e.Builder("presence",g)}e={VERSION:"1.0.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(g,h){e.NS[g]=h},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(k,l,j){var h,g;for(h=0;h<k.childNodes.length;h++){g=k.childNodes[h];if(g.nodeType==e.ElementType.NORMAL&&(!l||this.isTagEqual(g,l))){j(g)}}},isTagEqual:function(h,g){return h.tagName.toLowerCase()==g.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var g;if(window.ActiveXObject){g=new ActiveXObject("Microsoft.XMLDOM");g.appendChild(g.createElement("strophe"))}else{g=document.implementation.createDocument("jabber:client","strophe",null)}return g},xmlElement:function(j){if(!j){return null}var m=null;if(!e._xmlGenerator){e._xmlGenerator=e._makeGenerator()}m=e._xmlGenerator.createElement(j);var g,l,h;for(g=1;g<arguments.length;g++){if(!arguments[g]){continue}if(typeof(arguments[g])=="string"||typeof(arguments[g])=="number"){m.appendChild(e.xmlTextNode(arguments[g]))}else{if(typeof(arguments[g])=="object"&&typeof(arguments[g].sort)=="function"){for(l=0;l<arguments[g].length;l++){if(typeof(arguments[g][l])=="object"&&typeof(arguments[g][l].sort)=="function"){m.setAttribute(arguments[g][l][0],arguments[g][l][1])}}}else{if(typeof(arguments[g])=="object"){for(h in arguments[g]){if(arguments[g].hasOwnProperty(h)){m.setAttribute(h,arguments[g][h])}}}}}}return m},xmlescape:function(g){g=g.replace(/\&/g,"&amp;");g=g.replace(/</g,"&lt;");g=g.replace(/>/g,"&gt;");return g},xmlTextNode:function(g){g=e.xmlescape(g);if(!e._xmlGenerator){e._xmlGenerator=e._makeGenerator()}return e._xmlGenerator.createTextNode(g)},getText:function(h){if(!h){return null}var j="";if(h.childNodes.length===0&&h.nodeType==e.ElementType.TEXT){j+=h.nodeValue}for(var g=0;g<h.childNodes.length;g++){if(h.childNodes[g].nodeType==e.ElementType.TEXT){j+=h.childNodes[g].nodeValue}}return j},copyElement:function(j){var g,h;if(j.nodeType==e.ElementType.NORMAL){h=e.xmlElement(j.tagName);for(g=0;g<j.attributes.length;g++){h.setAttribute(j.attributes[g].nodeName.toLowerCase(),j.attributes[g].value)}for(g=0;g<j.childNodes.length;g++){h.appendChild(e.copyElement(j.childNodes[g]))}}else{if(j.nodeType==e.ElementType.TEXT){h=e.xmlTextNode(j.nodeValue)}}return h},escapeNode:function(g){return g.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(g){return g.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(g){if(g.indexOf("@")<0){return null}return g.split("@")[0]},getDomainFromJid:function(g){var h=e.getBareJidFromJid(g);if(h.indexOf("@")<0){return h}else{var i=h.split("@");i.splice(0,1);return i.join("@")}},getResourceFromJid:function(g){var h=g.split("/");if(h.length<2){return null}h.splice(0,1);return h.join("/")},getBareJidFromJid:function(g){return g.split("/")[0]},log:function(h,g){return},debug:function(g){this.log(this.LogLevel.DEBUG,g)},info:function(g){this.log(this.LogLevel.INFO,g)},warn:function(g){this.log(this.LogLevel.WARN,g)},error:function(g){this.log(this.LogLevel.ERROR,g)},fatal:function(g){this.log(this.LogLevel.FATAL,g)},serialize:function(j){var g;if(!j){return null}if(typeof(j.tree)==="function"){j=j.tree()}var l=j.nodeName;var h,k;if(j.getAttribute("_realname")){l=j.getAttribute("_realname")}g="<"+l;for(h=0;h<j.attributes.length;h++){if(j.attributes[h].nodeName!="_realname"){g+=" "+j.attributes[h].nodeName.toLowerCase()+"='"+j.attributes[h].value.replace("&","&amp;").replace("'","&apos;").replace("<","&lt;")+"'"}}if(j.childNodes.length>0){g+=">";for(h=0;h<j.childNodes.length;h++){k=j.childNodes[h];if(k.nodeType==e.ElementType.NORMAL){g+=e.serialize(k)}else{if(k.nodeType==e.ElementType.TEXT){g+=k.nodeValue}}}g+="</"+l+">"}else{g+="/>"}return g},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(g,h){e._connectionPlugins[g]=h}};e.Builder=function(h,g){if(h=="presence"||h=="message"||h=="iq"){if(g&&!g.xmlns){g.xmlns=e.NS.CLIENT}else{if(!g){g={xmlns:e.NS.CLIENT}}}}this.nodeTree=e.xmlElement(h,g);this.node=this.nodeTree};e.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return e.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(h){for(var g in h){if(h.hasOwnProperty(g)){this.node.setAttribute(g,h[g])}}return this},c:function(h,g){var i=e.xmlElement(h,g);this.node.appendChild(i);this.node=i;return this},cnode:function(g){this.node.appendChild(g);this.node=g;return this},t:function(g){var h=e.xmlTextNode(g);this.node.appendChild(h);return this}};e.Handler=function(k,j,h,i,m,l,g){this.handler=k;this.ns=j;this.name=h;this.type=i;this.id=m;this.options=g||{matchbare:false};if(!this.options.matchBare){this.options.matchBare=false}if(this.options.matchBare){this.from=e.getBareJidFromJid(l)}else{this.from=l}this.user=true};e.Handler.prototype={isMatch:function(h){var j;var i=null;if(this.options.matchBare){i=e.getBareJidFromJid(h.getAttribute("from"))}else{i=h.getAttribute("from")}j=false;if(!this.ns){j=true}else{var g=this;e.forEachChild(h,null,function(k){if(k.getAttribute("xmlns")==g.ns){j=true}});j=j||h.getAttribute("xmlns")==this.ns}if(j&&(!this.name||e.isTagEqual(h,this.name))&&(!this.type||h.getAttribute("type")===this.type)&&(!this.id||h.getAttribute("id")===this.id)&&(!this.from||i===this.from)){return true}return false},run:function(h){var g=null;try{g=this.handler(h)}catch(i){if(i.sourceURL){e.fatal("error: "+this.handler+" "+i.sourceURL+":"+i.line+" - "+i.name+": "+i.message)}else{if(i.fileName){if(typeof(console)!="undefined"){console.trace();console.error(this.handler," - error - ",i,i.message)}e.fatal("error: "+this.handler+" "+i.fileName+":"+i.lineNumber+" - "+i.name+": "+i.message)}else{e.fatal("error: "+this.handler)}}throw i}return g},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};e.TimedHandler=function(h,g){this.period=h;this.handler=g;this.lastCalled=new Date().getTime();this.user=true};e.TimedHandler.prototype={run:function(){this.lastCalled=new Date().getTime();return this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};e.Request=function(i,h,g,j){this.id=++e._requestId;this.xmlData=i;this.data=e.serialize(i);this.origFunc=h;this.func=h;this.rid=g;this.date=NaN;this.sends=j||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date){return 0}var k=new Date();return(k-this.date)/1000};this.timeDead=function(){if(!this.dead){return 0}var k=new Date();return(k-this.dead)/1000};this.xhr=this._newXHR()};e.Request.prototype={getResponse:function(){var g=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){g=this.xhr.responseXML.documentElement;if(g.tagName=="parsererror"){e.error("invalid response received");e.error("responseText: "+this.xhr.responseText);e.error("responseXML: "+e.serialize(this.xhr.responseXML));throw"parsererror"}}else{if(this.xhr.responseText){e.error("invalid response received");e.error("responseText: "+this.xhr.responseText);e.error("responseXML: "+e.serialize(this.xhr.responseXML))}}return g},_newXHR:function(){var g=null;if(window.XMLHttpRequest){g=new XMLHttpRequest();if(g.overrideMimeType){g.overrideMimeType("text/xml")}}else{if(window.ActiveXObject){g=new ActiveXObject("Microsoft.XMLHTTP")}}g.onreadystatechange=this.func.prependArg(this);return g}};e.Connection=function(g){this.service=g;this.jid="";this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._idleTimeout=null;this._disconnectTimeout=null;this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*10000);this._sasl_success_handler=null;this._sasl_failure_handler=null;this._sasl_challenge_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var h in e._connectionPlugins){if(e._connectionPlugins.hasOwnProperty(h)){var j=e._connectionPlugins[h];var i=function(){};i.prototype=j;this[h]=new i();this[h].init(this)}}};e.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.sid=null;this.streamId=null;this.do_session=false;this.do_bind=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.authenticated=false;this.disconnecting=false;this.connected=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*10000)},pause:function(){this.paused=true},resume:function(){this.paused=false},getUniqueId:function(g){if(typeof(g)=="string"||typeof(g)=="number"){return ++this._uniqueId+":"+g}else{return ++this._uniqueId+""}},connect:function(h,i,l,k,j){this.jid=h;this.pass=i;this.connect_callback=l;this.disconnecting=false;this.connected=false;this.authenticated=false;this.errors=0;this.wait=k||this.wait;this.hold=j||this.hold;this.domain=e.getDomainFromJid(this.jid);var g=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":e.NS.BOSH});this._changeConnectStatus(e.Status.CONNECTING,null);this._requests.push(new e.Request(g.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),g.tree().getAttribute("rid")));this._throttledRequestHandler()},attach:function(i,g,j,m,l,k,h){this.jid=i;this.sid=g;this.rid=j;this.connect_callback=m;this.domain=e.getDomainFromJid(this.jid);this.authenticated=true;this.connected=true;this.wait=l||this.wait;this.hold=k||this.hold;this.window=h||this.window;this._changeConnectStatus(e.Status.ATTACHED,null)},xmlInput:function(g){return},xmlOutput:function(g){return},rawInput:function(g){return},rawOutput:function(g){return},send:function(h){if(h===null){return}if(typeof(h.sort)==="function"){for(var g=0;g<h.length;g++){this._queueData(h[g])}}else{if(typeof(h.tree)==="function"){this._queueData(h.tree())}else{this._queueData(h)}}this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(j,n,g,k){var l=null;var i=this;if(typeof(j.tree)==="function"){j=j.tree()}var m=j.getAttribute("id");if(!m){m=this.getUniqueId("sendIQ");j.setAttribute("id",m)}var h=this.addHandler(function(p){if(l){i.deleteTimedHandler(l)}var o=p.getAttribute("type");if(o==="result"){if(n){n(p)}}else{if(o==="error"){if(g){g(p)}}else{throw {name:"StropheError",message:"Got bad IQ type of "+o}}}},null,"iq",null,m);if(k){l=this.addTimedHandler(k,function(){i.deleteHandler(h);if(g){g(null)}return false})}this.send(j);return m},_queueData:function(g){if(g===null||!g.tagName||!g.childNodes){throw {name:"StropheError",message:"Cannot queue non-DOMElement."}}this._data.push(g)},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(i,h){var g=new e.TimedHandler(i,h);this.addTimeds.push(g);return g},deleteTimedHandler:function(g){this.removeTimeds.push(g)},addHandler:function(l,k,i,j,n,m,h){var g=new e.Handler(l,k,i,j,n,m,h);this.addHandlers.push(g);return g},deleteHandler:function(g){this.removeHandlers.push(g)},disconnect:function(g){this._changeConnectStatus(e.Status.DISCONNECTING,g);e.info("Disconnect was called because: "+g);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3000,this._onDisconnectTimeout.bind(this));this._sendTerminate()}},_changeConnectStatus:function(g,m){for(var h in e._connectionPlugins){if(e._connectionPlugins.hasOwnProperty(h)){var j=this[h];if(j.statusChanged){try{j.statusChanged(g,m)}catch(i){e.error(""+h+" plugin caused an exception changing status: "+i)}}}}if(this.connect_callback){try{this.connect_callback(g,m)}catch(l){e.error("User connection callback caused an exception: "+l)}}},_buildBody:function(){var g=c("body",{rid:this.rid++,xmlns:e.NS.HTTPBIND});if(this.sid!==null){g.attrs({sid:this.sid})}return g},_removeRequest:function(h){e.debug("removing request");var g;for(g=this._requests.length-1;g>=0;g--){if(h==this._requests[g]){this._requests.splice(g,1)}}h.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(g){var h=this._requests[g];if(h.dead===null){h.dead=new Date()}this._processRequest(g)},_processRequest:function(j){var o=this._requests[j];var r=-1;try{if(o.xhr.readyState==4){r=o.xhr.status}}catch(m){e.error("caught an error in _requests["+j+"], reqStatus: "+r)}if(typeof(r)=="undefined"){r=-1}var h=o.age();var g=(!isNaN(h)&&h>Math.floor(e.TIMEOUT*this.wait));var k=(o.dead!==null&&o.timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait));var q=(o.xhr.readyState==4&&(r<1||r>=500));if(g||k||q){if(k){e.error("Request "+this._requests[j].id+" timed out (secondary), restarting")}o.abort=true;o.xhr.abort();o.xhr.onreadystatechange=function(){};this._requests[j]=new e.Request(o.xmlData,o.origFunc,o.rid,o.sends);o=this._requests[j]}if(o.xhr.readyState===0){e.debug("request id "+o.id+"."+o.sends+" posting");o.date=new Date();try{o.xhr.open("POST",this.service,true)}catch(n){e.error("XHR open failed.");if(!this.connected){this._changeConnectStatus(e.Status.CONNFAIL,"bad-service")}this.disconnect();return}var p=function(){o.xhr.send(o.data)};if(o.sends>1){var l=Math.pow(o.sends,3)*1000;setTimeout(p,l)}else{p()}o.sends++;this.xmlOutput(o.xmlData);this.rawOutput(o.data)}else{e.debug("_processRequest: "+(j===0?"first":"second")+" request has readyState of "+o.xhr.readyState)}},_throttledRequestHandler:function(){if(!this._requests){e.debug("_throttledRequestHandler called with undefined requests")}else{e.debug("_throttledRequestHandler called with "+this._requests.length+" requests")}if(!this._requests||this._requests.length===0){return}if(this._requests.length>0){this._processRequest(0)}if(this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window-1){this._processRequest(1)}},_onRequestStateChange:function(j,i){e.debug("request id "+i.id+"."+i.sends+" state changed to "+i.xhr.readyState);if(i.abort){i.abort=false;return}var h;if(i.xhr.readyState==4){h=0;try{h=i.xhr.status}catch(k){}if(typeof(h)=="undefined"){h=0}if(this.disconnecting){if(h>=400){this._hitError(h);return}}var g=(this._requests[0]==i);var l=(this._requests[1]==i);if((h>0&&h<500)||i.sends>5){this._removeRequest(i);e.debug("request id "+i.id+" should now be removed")}if(h==200){if(l||(g&&this._requests.length>0&&this._requests[0].age()>Math.floor(e.SECONDARY_TIMEOUT*this.wait))){this._restartRequest(0)}e.debug("request id "+i.id+"."+i.sends+" got 200");j(i);this.errors=0}else{e.error("request id "+i.id+"."+i.sends+" error "+h+" happened");if(h===0||(h>=400&&h<600)||h>=12000){this._hitError(h);if(h>=400&&h<500){this._changeConnectStatus(e.Status.DISCONNECTING,null);this._doDisconnect()}}}if(!((h>0&&h<10000)||i.sends>5)){this._throttledRequestHandler()}}},_hitError:function(g){this.errors++;e.warn("request errored, status: "+g+", number of errors: "+this.errors);if(this.errors>4){this._onDisconnectTimeout()}},_doDisconnect:function(){e.info("_doDisconnect was called");this.authenticated=false;this.disconnecting=false;this.sid=null;this.streamId=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(e.Status.DISCONNECTED,null);this.connected=false}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[]},_dataRecv:function(o){try{var g=o.getResponse()}catch(m){if(m!="parsererror"){throw m}this.disconnect("strophe-parsererror")}if(g===null){return}this.xmlInput(g);this.rawInput(e.serialize(g));var l,j;while(this.removeHandlers.length>0){j=this.removeHandlers.pop();l=this.handlers.indexOf(j);if(l>=0){this.handlers.splice(l,1)}}while(this.addHandlers.length>0){this.handlers.push(this.addHandlers.pop())}if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect();return}var h=g.getAttribute("type");var n,k;if(h!==null&&h=="terminate"){n=g.getAttribute("condition");k=g.getElementsByTagName("conflict");if(n!==null){if(n=="remote-stream-error"&&k.length>0){n="conflict"}this._changeConnectStatus(e.Status.CONNFAIL,n)}else{this._changeConnectStatus(e.Status.CONNFAIL,"unknown")}this.disconnect();return}var p=this;e.forEachChild(g,null,function(t){var r,s;s=p.handlers;p.handlers=[];for(r=0;r<s.length;r++){var q=s[r];if(q.isMatch(t)&&(p.authenticated||!q.user)){if(q.run(t)){p.handlers.push(q)}}else{p.handlers.push(q)}}})},_sendTerminate:function(){e.info("_sendTerminate was called");var g=this._buildBody().attrs({type:"terminate"});if(this.authenticated){g.c("presence",{xmlns:e.NS.CLIENT,type:"unavailable"})}this.disconnecting=true;var h=new e.Request(g.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),g.tree().getAttribute("rid"));this._requests.push(h);this._throttledRequestHandler()},_connect_cb:function(v){e.info("_connect_cb was called");this.connected=true;var h=v.getResponse();if(!h){return}this.xmlInput(h);this.rawInput(e.serialize(h));var m=h.getAttribute("type");var u,o;if(m!==null&&m=="terminate"){u=h.getAttribute("condition");o=h.getElementsByTagName("conflict");if(u!==null){if(u=="remote-stream-error"&&o.length>0){u="conflict"}this._changeConnectStatus(e.Status.CONNFAIL,u)}else{this._changeConnectStatus(e.Status.CONNFAIL,"unknown")}return}if(!this.sid){this.sid=h.getAttribute("sid")}if(!this.stream_id){this.stream_id=h.getAttribute("authid")}var j=h.getAttribute("requests");if(j){this.window=parseInt(j,10)}var g=h.getAttribute("hold");if(g){this.hold=parseInt(g,10)}var q=h.getAttribute("wait");if(q){this.wait=parseInt(q,10)}var w=false;var l=false;var t=false;var x=h.getElementsByTagName("mechanism");var n,s,p,k;if(x.length>0){for(n=0;n<x.length;n++){s=e.getText(x[n]);if(s=="DIGEST-MD5"){l=true}else{if(s=="PLAIN"){w=true}else{if(s=="ANONYMOUS"){t=true}}}}}else{var r=this._buildBody();this._requests.push(new e.Request(r.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),r.tree().getAttribute("rid")));this._throttledRequestHandler();return}if(e.getNodeFromJid(this.jid)===null&&t){this._changeConnectStatus(e.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("auth",{xmlns:e.NS.SASL,mechanism:"ANONYMOUS"}).tree())}else{if(e.getNodeFromJid(this.jid)===null){this._changeConnectStatus(e.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect()}else{if(l){this._changeConnectStatus(e.Status.AUTHENTICATING,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("auth",{xmlns:e.NS.SASL,mechanism:"DIGEST-MD5"}).tree())}else{if(w){p=e.getBareJidFromJid(this.jid);p=p+"\u0000";p=p+e.getNodeFromJid(this.jid);p=p+"\u0000";p=p+this.pass;this._changeConnectStatus(e.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);k=Base64.encode(p);this.send(c("auth",{xmlns:e.NS.SASL,mechanism:"PLAIN"}).t(k).tree())}else{this._changeConnectStatus(e.Status.AUTHENTICATING,null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:e.NS.AUTH}).c("username",{}).t(e.getNodeFromJid(this.jid)).tree())}}}}},_sasl_challenge1_cb:function(k){var h=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;var q=Base64.decode(e.getText(k));var r=MD5.hexdigest(Math.random()*1234567890);var n="";var s=null;var o="";var g="";var m;this.deleteHandler(this._sasl_failure_handler);while(q.match(h)){m=q.match(h);q=q.replace(m[0],"");m[2]=m[2].replace(/^"(.+)"$/,"$1");switch(m[1]){case"realm":n=m[2];break;case"nonce":o=m[2];break;case"qop":g=m[2];break;case"host":s=m[2];break}}var l="xmpp/"+this.domain;if(s!==null){l=l+"/"+s}var j=MD5.hash(e.getNodeFromJid(this.jid)+":"+n+":"+this.pass)+":"+o+":"+r;var i="AUTHENTICATE:"+l;var p="";p+="username="+this._quote(e.getNodeFromJid(this.jid))+",";p+="realm="+this._quote(n)+",";p+="nonce="+this._quote(o)+",";p+="cnonce="+this._quote(r)+",";p+='nc="00000001",';p+='qop="auth",';p+="digest-uri="+this._quote(l)+",";p+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(j)+":"+o+":00000001:"+r+":auth:"+MD5.hexdigest(i)))+",";p+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("response",{xmlns:e.NS.SASL}).t(Base64.encode(p)).tree());return false},_quote:function(g){return'"'+g.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(g){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(c("response",{xmlns:e.NS.SASL}).tree());return false},_auth1_cb:function(g){var h=d({type:"set",id:"_auth_2"}).c("query",{xmlns:e.NS.AUTH}).c("username",{}).t(e.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!e.getResourceFromJid(this.jid)){this.jid=e.getBareJidFromJid(this.jid)+"/strophe"}h.up().c("resource",{}).t(e.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(h.tree());return false},_sasl_success_cb:function(g){e.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this._sendRestart();return false},_sasl_auth1_cb:function(h){var g,k;for(g=0;g<h.childNodes.length;g++){k=h.childNodes[g];if(k.nodeName=="bind"){this.do_bind=true}if(k.nodeName=="session"){this.do_session=true}}if(!this.do_bind){this._changeConnectStatus(e.Status.AUTHFAIL,null);return false}else{this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var j=e.getResourceFromJid(this.jid);if(j){this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:e.NS.BIND}).c("resource",{}).t(j).tree())}else{this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:e.NS.BIND}).tree())}}return false},_sasl_bind_cb:function(g){if(g.getAttribute("type")=="error"){e.info("SASL binding failed.");this._changeConnectStatus(e.Status.AUTHFAIL,null);return false}var i=g.getElementsByTagName("bind");var h;if(i.length>0){h=i[0].getElementsByTagName("jid");if(h.length>0){this.jid=e.getText(h[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:e.NS.SESSION}).tree())}else{this.authenticated=true;this._changeConnectStatus(e.Status.CONNECTED,null)}}}else{e.info("SASL binding failed.");this._changeConnectStatus(e.Status.AUTHFAIL,null);return false}},_sasl_session_cb:function(g){if(g.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(e.Status.CONNECTED,null)}else{if(g.getAttribute("type")=="error"){e.info("Session creation failed.");this._changeConnectStatus(e.Status.AUTHFAIL,null);return false}}return false},_sasl_failure_cb:function(g){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._changeConnectStatus(e.Status.AUTHFAIL,null);return false},_auth2_cb:function(g){if(g.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(e.Status.CONNECTED,null)}else{if(g.getAttribute("type")=="error"){this._changeConnectStatus(e.Status.AUTHFAIL,null);this.disconnect()}}return false},_addSysTimedHandler:function(i,h){var g=new e.TimedHandler(i,h);g.user=false;this.addTimeds.push(g);return g},_addSysHandler:function(k,j,h,i,l){var g=new e.Handler(k,j,h,i,l);g.user=false;this.addHandlers.push(g);return g},_onDisconnectTimeout:function(){e.info("_onDisconnectTimeout was called");var g;while(this._requests.length>0){g=this._requests.pop();g.abort=true;g.xhr.abort();g.xhr.onreadystatechange=function(){}}this._doDisconnect();return false},_onIdle:function(){var j,l,n,k;while(this.removeTimeds.length>0){l=this.removeTimeds.pop();j=this.timedHandlers.indexOf(l);if(j>=0){this.timedHandlers.splice(j,1)}}while(this.addTimeds.length>0){this.timedHandlers.push(this.addTimeds.pop())}var h=new Date().getTime();k=[];for(j=0;j<this.timedHandlers.length;j++){l=this.timedHandlers[j];if(this.authenticated||!l.user){n=l.lastCalled+l.period;if(n-h<=0){if(l.run()){k.push(l)}}else{k.push(l)}}}this.timedHandlers=k;var g,m;if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){e.info("no requests during idle cycle, sending blank request");this._data.push(null)}if(this._requests.length<2&&this._data.length>0&&!this.paused){g=this._buildBody();for(j=0;j<this._data.length;j++){if(this._data[j]!==null){if(this._data[j]==="restart"){g.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":e.NS.BOSH})}else{g.cnode(this._data[j]).up()}}}delete this._data;this._data=[];this._requests.push(new e.Request(g.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),g.tree().getAttribute("rid")));this._processRequest(this._requests.length-1)}if(this._requests.length>0){m=this._requests[0].age();if(this._requests[0].dead!==null){if(this._requests[0].timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait)){this._throttledRequestHandler()}}if(m>Math.floor(e.TIMEOUT*this.wait)){e.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(e.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler()}}clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}};if(f){f(e,c,a,d,b)}})(function(){window.Strophe=arguments[0];window.$build=arguments[1];window.$msg=arguments[2];window.$iq=arguments[3];window.$pres=arguments[4]});(function(c){var b=c.setTimeout,d=c.document,a=0;c.jXHR=function(){var f,h,o,i,n=null;function m(){try{i.parentNode.removeChild(i)}catch(p){}}function l(){h=false;f="";m();i=null;j(0)}function g(q){try{n.onerror.call(n,q,f)}catch(p){}}function k(){if((this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded")||h){return}this.onload=this.onreadystatechange=null;h=true;if(n.readyState!==4){g("handleScriptLoad: Script failed to load ["+f+"].")}m()}function e(q){var p=null;if(window.DOMParser){var r=new DOMParser();p=r.parseFromString(q,"text/xml")}else{p=new ActiveXObject("Microsoft.XMLDOM");p.async="false";p.loadXML(q)}return p}function j(p,q){q=q||[];n.readyState=p;if(p==4){n.responseText=q[0].reply;n.responseXML=e(q[0].reply)}if(typeof n.onreadystatechange==="function"){n.onreadystatechange.apply(n,q)}}n={onerror:null,onreadystatechange:null,readyState:0,status:200,responseBody:null,responseText:null,responseXML:null,open:function(r,p){l();var q="cb"+(a++);(function(s){c.jXHR[s]=function(){try{j.call(n,4,arguments)}catch(t){n.readyState=-1;g("Script failed to run ["+f+"].")}c.jXHR[s]=null}})(q);f=p+"?callback=?jXHR&data=";f=f.replace(/=\?jXHR/,"=jXHR."+q);j(1)},send:function(p){f=f+encodeURIComponent(p);b(function(){i=d.createElement("script");i.setAttribute("type","text/javascript");i.onload=i.onreadystatechange=function(){k.call(i)};i.setAttribute("src",f);d.getElementsByTagName("head")[0].appendChild(i)},0);j(2)},abort:function(){},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}};l();return n}})(window);Strophe.addConnectionPlugin("jxhr",{init:function(a){if(jXHR){Strophe.Request.prototype._newXHR=function(){var b=new jXHR();b.onreadystatechange=this.func.prependArg(this);return b}}else{Strophe.error("jXHR plugin loaded, but jXHR not found.  Falling back to native XHR implementation.")}}});$(function(){if($("#chatBtn4").length>0){var b=getCookieVal("popUpNo");if(b<1){var a=60000;setTimeout(function(){JZIM.chatPopUp()},a);setCookieVal("popUpNo",1,1)}}$("#chatBtn").live("click",function(){JZIM.chatPopUp()});$("#chatBtn2").live("click",function(){JZIM.chatPopUp()});$("#chatBtn3").live("click",function(){JZIM.chatPopUp()});$("#chatBtn4").live("click",function(){JZIM.chatPopUp()})});
	
	module.exports = JZIM;
});